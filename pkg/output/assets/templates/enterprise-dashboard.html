<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SD-WAN Network Triage - {{.FileName}}</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Enterprise Dashboard Styles -->
    <style>{{.CSS}}</style>
</head>
<body>
    <!-- ========================================================================
         TOP NAVIGATION BAR
         ======================================================================== -->
    <header class="dashboard-header">
        <div class="header-container">
            <!-- Top Bar -->
            <div class="header-top">
                <!-- Brand -->
                <div class="header-brand">
                    <div class="brand-logo">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    <div>
                        <h1 class="brand-title">
                            SD-WAN Network Triage
                            <span class="brand-subtitle">v{{.Version}} - Enterprise Dashboard</span>
                        </h1>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="header-actions">
                    <!-- Search -->
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="globalSearch" placeholder="Search IPs, devices, events...">
                    </div>
                    
                    <!-- Export Button -->
                    <button class="header-button" onclick="window.print()">
                        <i class="fas fa-download"></i>
                        <span>Export PDF</span>
                    </button>
                    
                    <!-- Refresh Button -->
                    <button class="header-button primary" onclick="location.reload()">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh</span>
                    </button>
                </div>
            </div>
            
            <!-- Navigation Menu -->
            <nav class="header-nav">
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#dashboard" class="nav-link active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt nav-icon"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#security" class="nav-link" data-section="security">
                            <i class="fas fa-shield-alt nav-icon"></i>
                            <span>Security</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#performance" class="nav-link" data-section="performance">
                            <i class="fas fa-chart-line nav-icon"></i>
                            <span>Performance</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#traffic" class="nav-link" data-section="traffic">
                            <i class="fas fa-exchange-alt nav-icon"></i>
                            <span>Traffic</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#protocols" class="nav-link" data-section="protocols">
                            <i class="fas fa-layer-group nav-icon"></i>
                            <span>Protocols</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#tunnels" class="nav-link" data-section="tunnels">
                            <i class="fas fa-network-wired nav-icon"></i>
                            <span>Tunnels & SD-WAN</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#visualizations" class="nav-link" data-section="visualizations">
                            <i class="fas fa-project-diagram nav-icon"></i>
                            <span>Visualizations</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#devices" class="nav-link" data-section="devices">
                            <i class="fas fa-laptop nav-icon"></i>
                            <span>Devices</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    
    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <ul class="breadcrumb-list">
            <li class="breadcrumb-item">
                <a href="#" class="breadcrumb-link">Home</a>
            </li>
            <li class="breadcrumb-item" id="currentSection">Dashboard</li>
        </ul>
    </div>
    
    <!-- ========================================================================
         MAIN DASHBOARD CONTAINER
         ======================================================================== -->
    <main class="dashboard-container">
        
        <!-- ====================================================================
             EXECUTIVE SUMMARY - KPI TILES
             ==================================================================== -->
        <section id="dashboard" class="dashboard-section">
            <div class="kpi-grid">
                <!-- Network Health KPI -->
                <div class="kpi-card {{if eq .HealthStatus "good"}}success{{else if eq .HealthStatus "warning"}}warning{{else}}critical{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <span class="kpi-badge">
                            {{if eq .HealthStatus "good"}}Healthy{{else if eq .HealthStatus "warning"}}Warning{{else}}Critical{{end}}
                        </span>
                    </div>
                    <div class="kpi-value">{{.HealthStatus | title}}</div>
                    <div class="kpi-label">Network Health Status</div>
                    <div class="kpi-trend">
                        <i class="fas fa-info-circle"></i>
                        <span>Based on {{.TotalFindings}} findings</span>
                    </div>
                </div>
                
                <!-- CRITICAL: Failed Handshakes KPI -->
                <div class="kpi-card {{if gt .TCPHandshakeStats.FailedCount 0}}critical{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-handshake-slash"></i>
                        </div>
                        {{if gt .TCPHandshakeStats.FailedCount 0}}
                        <span class="kpi-badge">!</span>
                        {{end}}
                    </div>
                    <div class="kpi-value">{{.TCPHandshakeStats.FailedCount}}</div>
                    <div class="kpi-label">Failed TCP Handshakes</div>
                    <div class="kpi-trend {{if gt .TCPHandshakeStats.FailedCount 0}}down{{end}}">
                        {{if gt .TCPHandshakeStats.FailedCount 0}}
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Unreachable services or firewall blocks</span>
                        {{else}}
                        <i class="fas fa-check-circle"></i>
                        <span>All connections successful</span>
                        {{end}}
                    </div>
                </div>
                
                <!-- Security Threats KPI -->
                <div class="kpi-card {{if gt .Stats.DDoSAttacks 0}}critical{{else if or (gt .Stats.PortScans 0) (gt .Stats.IOCMatches 0)}}warning{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        {{if or (gt .Stats.DDoSAttacks 0) (gt .Stats.PortScans 0) (gt .Stats.IOCMatches 0) (gt .Stats.BGPIndicators 0)}}
                        <span class="kpi-badge">!</span>
                        {{end}}
                    </div>
                    <div class="kpi-value">{{add .Stats.DDoSAttacks .Stats.PortScans .Stats.IOCMatches}}</div>
                    <div class="kpi-label">Security Threats</div>
                    <div class="kpi-trend">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>DDoS: {{.Stats.DDoSAttacks}} | Scans: {{.Stats.PortScans}} | IOCs: {{.Stats.IOCMatches}} | BGP: {{.Stats.BGPIndicators}}</span>
                    </div>
                </div>
                
                <!-- Performance Issues KPI -->
                <div class="kpi-card {{if gt .Stats.TCPRetransmissions 100}}warning{{else if gt .Stats.HighRTTFlows 10}}warning{{else}}info{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.TCPRetransmissions}}</div>
                    <div class="kpi-label">TCP Retransmissions</div>
                    <div class="kpi-trend">
                        <i class="fas fa-clock"></i>
                        <span>High RTT: {{.Stats.HighRTTFlows}} | HTTP Errors: {{.Stats.HTTPErrors}}</span>
                    </div>
                </div>
                
                <!-- Tunnels & Encapsulation KPI -->
                <div class="kpi-card {{if gt .Stats.TunnelsDetected 0}}info{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-network-wired"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.TunnelsDetected}}</div>
                    <div class="kpi-label">Tunnels Detected</div>
                    <div class="kpi-trend">
                        <i class="fas fa-info-circle"></i>
                        <span>VXLAN, GRE, IPsec, etc.</span>
                    </div>
                </div>
                
                <!-- SD-WAN Vendors KPI -->
                <div class="kpi-card {{if gt .Stats.SDWANVendors 0}}info{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-sitemap"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.SDWANVendors}}</div>
                    <div class="kpi-label">SD-WAN Vendors</div>
                    <div class="kpi-trend">
                        <i class="fas fa-fingerprint"></i>
                        <span>Detected vendor signatures</span>
                    </div>
                </div>
                
                <!-- VoIP Calls KPI -->
                <div class="kpi-card {{if gt .Stats.VoIPCalls 0}}info{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-phone-volume"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.VoIPCalls}}</div>
                    <div class="kpi-label">VoIP Calls</div>
                    <div class="kpi-trend">
                        <i class="fas fa-info-circle"></i>
                        <span>SIP/RTP sessions detected</span>
                    </div>
                </div>
                
                <!-- DNS Queries KPI -->
                <div class="kpi-card {{if gt .Stats.DNSAnomalies 0}}warning{{else}}info{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.DNSQueries}}</div>
                    <div class="kpi-label">DNS Queries</div>
                    <div class="kpi-trend {{if gt .Stats.DNSAnomalies 0}}down{{end}}">
                        {{if gt .Stats.DNSAnomalies 0}}
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>{{.Stats.DNSAnomalies}} anomalies detected</span>
                        {{else}}
                        <i class="fas fa-check-circle"></i>
                        <span>No anomalies detected</span>
                        {{end}}
                    </div>
                </div>
                
                <!-- Devices Detected KPI -->
                <div class="kpi-card success">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-laptop"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.DevicesDetected}}</div>
                    <div class="kpi-label">Devices Identified</div>
                    <div class="kpi-trend">
                        <i class="fas fa-fingerprint"></i>
                        <span>ARP Conflicts: {{.Stats.ARPConflicts}}</span>
                    </div>
                </div>
            </div>
            
            <!-- ================================================================
                 EXECUTIVE SUMMARY CARD
                 ================================================================ -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-clipboard-list card-title-icon"></i>
                        Executive Summary
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-button" onclick="toggleSection('executive-summary')">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body" id="executive-summary">
                    <div class="dashboard-grid" style="grid-template-columns: 2fr 1fr; gap: var(--space-xl);">
                        <!-- Summary Content -->
                        <div>
                            <h3 class="mb-md">Analysis Overview</h3>
                            <p class="text-muted mb-lg">
                                Analyzed <strong>{{.FileName}}</strong> containing <strong>{{.PacketCount}} packets</strong> 
                                on <strong>{{.GeneratedAt}}</strong>.
                            </p>
                            
                            {{if .ExecutiveSummaryExplanation}}
                            <div class="mb-lg">
                                {{.ExecutiveSummaryExplanation}}
                            </div>
                            {{end}}
                            
                            <!-- Key Findings -->
                            <h4 class="mb-md">Key Findings</h4>
                            <div class="d-grid gap-md mb-lg">
                                {{if gt .Stats.DDoSAttacks 0}}
                                <div class="status-badge critical">
                                    <span class="status-dot"></span>
                                    <span>{{.Stats.DDoSAttacks}} DDoS Attack(s) Detected</span>
                                </div>
                                {{end}}
                                
                                {{if gt .Stats.PortScans 0}}
                                <div class="status-badge warning">
                                    <span class="status-dot"></span>
                                    <span>{{.Stats.PortScans}} Port Scan(s) Detected</span>
                                </div>
                                {{end}}
                                
                                {{if gt .Stats.TCPRetransmissions 100}}
                                <div class="status-badge warning">
                                    <span class="status-dot"></span>
                                    <span>High TCP Retransmission Rate ({{.Stats.TCPRetransmissions}})</span>
                                </div>
                                {{end}}
                                
                                {{if gt .Stats.DNSAnomalies 0}}
                                <div class="status-badge warning">
                                    <span class="status-dot"></span>
                                    <span>{{.Stats.DNSAnomalies}} DNS Anomalies Found</span>
                                </div>
                                {{end}}
                                
                                {{if and (eq .Stats.DDoSAttacks 0) (eq .Stats.PortScans 0) (lt .Stats.TCPRetransmissions 100)}}
                                <div class="status-badge healthy">
                                    <span class="status-dot"></span>
                                    <span>No Critical Issues Detected</span>
                                </div>
                                {{end}}
                            </div>
                        </div>
                        
                        <!-- Risk Assessment -->
                        <div>
                            <div class="card" style="background: var(--color-surface); border: none;">
                                <div class="card-body">
                                    <h4 class="mb-md">Risk Assessment</h4>
                                    <div class="text-center mb-lg">
                                        <div class="kpi-value" style="font-size: var(--font-size-4xl); color: {{if eq .RiskLevel "low"}}var(--color-success){{else if eq .RiskLevel "medium"}}var(--color-warning){{else}}var(--color-critical){{end}};">
                                            {{.RiskScore}}
                                        </div>
                                        <div class="kpi-label">Risk Score</div>
                                        <span class="status-badge {{if eq .RiskLevel "low"}}healthy{{else if eq .RiskLevel "medium"}}warning{{else}}critical{{end}}">
                                            <span class="status-dot"></span>
                                            {{.RiskLevel | title}} Risk
                                        </span>
                                    </div>
                                    
                                    {{if .RecommendedActions}}
                                    <h5 class="mb-sm">Recommended Actions</h5>
                                    <ul style="padding-left: var(--space-lg); margin: 0; font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                        {{range .RecommendedActions}}
                                        <li style="margin-bottom: var(--space-sm);">{{.}}</li>
                                        {{end}}
                                    </ul>
                                    {{end}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <i class="fas fa-clock"></i> Last updated: {{.GeneratedAt}}
                </div>
            </div>
        </section>
        
        <!-- ====================================================================
             SECURITY ANALYSIS SECTION
             ==================================================================== -->
        <section id="security" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-shield-alt" style="color: var(--color-primary);"></i>
                Security Analysis
            </h2>
            
            <!-- Security Overview Widget Grid -->
            <div class="widget-grid mb-xl">
                <!-- DDoS Attacks Widget -->
                {{if gt .Stats.DDoSAttacks 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-bomb" style="color: var(--color-critical);"></i>
                            DDoS Attacks ({{.Stats.DDoSAttacks}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .DDoSFindings}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Source IP</th>
                                        <th>Target IP</th>
                                        <th>Packet Count</th>
                                        <th>Severity</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .DDoSFindings}}
                                    <tr>
                                        <td><code>{{.Type}}</code></td>
                                        <td><code>{{.SourceIP}}</code></td>
                                        <td><code>{{.TargetIP}}</code></td>
                                        <td>{{.PacketCount}}</td>
                                        <td>
                                            <span class="status-badge critical">
                                                <span class="status-dot"></span>
                                                High
                                            </span>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No DDoS attacks detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- Port Scans Widget -->
                {{if gt .Stats.PortScans 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-search" style="color: var(--color-warning);"></i>
                            Port Scans ({{.Stats.PortScans}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .PortScanFindings}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Source IP</th>
                                        <th>Target IP</th>
                                        <th>Ports Scanned</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .PortScanFindings}}
                                    <tr>
                                        <td><code>{{.Type}}</code></td>
                                        <td><code>{{.SourceIP}}</code></td>
                                        <td><code>{{.TargetIP}}</code></td>
                                        <td>{{.PortsScanned}}</td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No port scans detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- IOC Matches Widget -->
                {{if gt .Stats.IOCMatches 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-crosshairs" style="color: var(--color-critical);"></i>
                            IOC Matches ({{.Stats.IOCMatches}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .IOCFindings}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Matched Value</th>
                                        <th>Type</th>
                                        <th>Source IP</th>
                                        <th>Confidence</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .IOCFindings}}
                                    <tr>
                                        <td><code>{{.MatchedValue}}</code></td>
                                        <td>{{.IOCType}}</td>
                                        <td><code>{{.SourceIP}}</code></td>
                                        <td>
                                            <span class="status-badge {{if eq .Confidence "High"}}critical{{else}}warning{{end}}">
                                                <span class="status-dot"></span>
                                                {{.Confidence}}
                                            </span>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No IOC matches detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- BGP Indicators Widget -->
                {{if gt .Stats.BGPIndicators 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-route" style="color: var(--color-warning);"></i>
                            BGP Hijack Indicators ({{.Stats.BGPIndicators}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .BGPIndicators}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>IP Address</th>
                                        <th>Expected ASN</th>
                                        <th>Observed ASN</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .BGPIndicators}}
                                    <tr>
                                        <td><code>{{.IPAddress}}</code></td>
                                        <td>AS{{.ExpectedASN}} ({{.ExpectedASName}})</td>
                                        <td>AS{{.ObservedASN}} ({{.ObservedASName}})</td>
                                        <td>
                                            <span class="status-badge {{if .IsAnomaly}}critical{{else}}warning{{end}}">
                                                <span class="status-dot"></span>
                                                {{if .IsAnomaly}}Anomaly{{else}}Suspicious{{end}}
                                            </span>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No BGP indicators detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- TLS Security Issues Widget -->
                {{if gt .Stats.TLSWeaknesses 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-lock-open" style="color: var(--color-warning);"></i>
                            TLS Security Issues ({{.Stats.TLSWeaknesses}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .TLSSecurityFindings}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Server IP</th>
                                        <th>Issue Type</th>
                                        <th>Details</th>
                                        <th>Severity</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .TLSSecurityFindings}}
                                    <tr>
                                        <td><code>{{.ServerIP}}</code></td>
                                        <td>{{.IssueType}}</td>
                                        <td>{{.Details}}</td>
                                        <td>
                                            <span class="status-badge {{if eq .Severity "High"}}critical{{else}}warning{{end}}">
                                                <span class="status-dot"></span>
                                                {{.Severity}}
                                            </span>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No TLS security issues detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
            </div>
            
            <!-- DNS Anomalies Card -->
            {{if gt .Stats.DNSAnomalies 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-exclamation-triangle card-title-icon"></i>
                        DNS Anomalies ({{.Stats.DNSAnomalies}})
                    </h3>
                </div>
                <div class="card-body">
                    {{if .DNSAnomalies}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Query</th>
                                    <th>Answer IP</th>
                                    <th>Server IP</th>
                                    <th>Reason</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .DNSAnomalies}}
                                <tr>
                                    <td><code>{{.Query}}</code></td>
                                    <td><code>{{.AnswerIP}}</code></td>
                                    <td><code>{{.ServerIP}}</code></td>
                                    <td>{{.Reason}}</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No DNS anomalies detected.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            <!-- TLS Security Findings -->
            {{if gt .Stats.TLSWeaknesses 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-lock-open card-title-icon"></i>
                        TLS Security Issues ({{.Stats.TLSWeaknesses}})
                    </h3>
                </div>
                <div class="card-body">
                    {{if .TLSSecurityFindings}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Server IP</th>
                                    <th>Issue Type</th>
                                    <th>Details</th>
                                    <th>Severity</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .TLSSecurityFindings}}
                                <tr>
                                    <td><code>{{.ServerIP}}</code></td>
                                    <td>{{.IssueType}}</td>
                                    <td>{{.Details}}</td>
                                    <td>
                                        <span class="status-badge {{if eq .Severity "High"}}critical{{else}}warning{{end}}">
                                            <span class="status-dot"></span>
                                            {{.Severity}}
                                        </span>
                                    </td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No TLS security issues detected.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             PERFORMANCE ANALYSIS SECTION
             ==================================================================== -->
        <section id="performance" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-chart-line" style="color: var(--color-primary);"></i>
                Performance Analysis
            </h2>
            
            <!-- TCP Handshake Analysis Card (CRITICAL) -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-handshake card-title-icon"></i>
                        TCP Connection Analysis - Per-Flow Breakdown
                    </h3>
                    <div class="card-actions">
                        <span class="status-badge {{if gt .TCPHandshakeStats.FailedCount 0}}critical{{else}}healthy{{end}}">
                            <span class="status-dot"></span>
                            {{.TCPHandshakeStats.SuccessfulCount}} Success / {{.TCPHandshakeStats.FailedCount}} Failed
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Summary Stats Row -->
                    <div class="dashboard-grid" style="grid-template-columns: repeat(4, 1fr); gap: var(--space-md); margin-bottom: var(--space-xl);">
                        <div style="text-align: center; padding: var(--space-md); background: var(--color-surface); border-radius: var(--radius-md); border-left: 4px solid var(--color-info);">
                            <div style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--color-info);">{{.TCPHandshakeStats.TotalSYN}}</div>
                            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Total SYN</div>
                        </div>
                        <div style="text-align: center; padding: var(--space-md); background: var(--color-surface); border-radius: var(--radius-md); border-left: 4px solid var(--color-success);">
                            <div style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--color-success);">{{.TCPHandshakeStats.TotalSYNACK}}</div>
                            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Total SYN-ACK</div>
                        </div>
                        <div style="text-align: center; padding: var(--space-md); background: var(--color-surface); border-radius: var(--radius-md); border-left: 4px solid var(--color-success);">
                            <div style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--color-success);">{{.TCPHandshakeStats.SuccessfulCount}}</div>
                            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Successful</div>
                        </div>
                        <div style="text-align: center; padding: var(--space-md); background: {{if gt .TCPHandshakeStats.FailedCount 0}}rgba(225, 112, 85, 0.1){{else}}var(--color-surface){{end}}; border-radius: var(--radius-md); border-left: 4px solid {{if gt .TCPHandshakeStats.FailedCount 0}}var(--color-critical){{else}}var(--color-success){{end}};">
                            <div style="font-size: var(--font-size-2xl); font-weight: 700; color: {{if gt .TCPHandshakeStats.FailedCount 0}}var(--color-critical){{else}}var(--color-success){{end}};">{{.TCPHandshakeStats.FailedCount}}</div>
                            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Failed</div>
                        </div>
                    </div>
                    
                    <!-- Per-Flow Detailed Table -->
                    {{if .TCPHandshakeCorrelatedFlows}}
                    <div class="mb-md">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-md);">
                            <h4 style="margin: 0;"><i class="fas fa-list"></i> Per-Flow Details ({{len .TCPHandshakeCorrelatedFlows}} flows)</h4>
                            <input type="text" id="tcp-flow-search" placeholder="Filter by IP address..." 
                                   style="padding: var(--space-sm) var(--space-md); border: 1px solid var(--color-border); border-radius: var(--radius-md); font-size: var(--font-size-sm); width: 250px;"
                                   onkeyup="filterTCPFlows(this.value)">
                        </div>
                        <div class="data-table-container" style="max-height: 500px; overflow-y: auto;">
                            <table class="data-table" id="tcp-flow-table">
                                <thead style="position: sticky; top: 0; background: var(--color-background); z-index: 10;">
                                    <tr>
                                        <th style="cursor: pointer;" onclick="sortTCPTable(0)">Source IP:Port <i class="fas fa-sort"></i></th>
                                        <th style="cursor: pointer;" onclick="sortTCPTable(1)">Destination IP:Port <i class="fas fa-sort"></i></th>
                                        <th style="cursor: pointer;" onclick="sortTCPTable(2)">Status <i class="fas fa-sort"></i></th>
                                        <th style="cursor: pointer;" onclick="sortTCPTable(3)">SYN Sent <i class="fas fa-sort"></i></th>
                                        <th style="cursor: pointer;" onclick="sortTCPTable(4)">SYN-ACK Recv <i class="fas fa-sort"></i></th>
                                        <th>Wireshark Filter</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range $index, $flow := .TCPHandshakeCorrelatedFlows}}
                                    <tr class="tcp-flow-row {{if eq $flow.Status "Complete"}}status-row-success{{else if eq $flow.Status "Failed"}}status-row-failed{{else}}status-row-partial{{end}}">
                                        <td><code>{{$flow.SrcIP}}:{{$flow.SrcPort}}</code></td>
                                        <td><code>{{$flow.DstIP}}:{{$flow.DstPort}}</code></td>
                                        <td>
                                            <span class="tcp-status-badge {{if eq $flow.Status "Complete"}}tcp-status-success{{else if eq $flow.Status "Failed"}}tcp-status-failed{{else}}tcp-status-partial{{end}}">
                                                {{if eq $flow.Status "Complete"}}<i class="fas fa-check-circle"></i>{{else if eq $flow.Status "Failed"}}<i class="fas fa-times-circle"></i>{{else}}<i class="fas fa-clock"></i>{{end}}
                                                {{$flow.Status}}
                                            </span>
                                        </td>
                                        <td style="text-align: center;">{{$flow.SynCount}}</td>
                                        <td style="text-align: center;">{{$flow.SynAckCount}}</td>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: var(--space-xs);">
                                                <code class="wireshark-filter" style="font-size: var(--font-size-xs); flex: 1; overflow: hidden; text-overflow: ellipsis;">ip.addr=={{$flow.SrcIP}} && ip.addr=={{$flow.DstIP}} && tcp.port=={{$flow.DstPort}}</code>
                                                <button class="copy-filter-btn" onclick="copyToClipboard('ip.addr=={{$flow.SrcIP}} && ip.addr=={{$flow.DstIP}} && tcp.port=={{$flow.DstPort}}', this)" title="Copy filter">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {{else}}
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <i class="fas fa-info-circle" style="font-size: var(--font-size-2xl); margin-bottom: var(--space-md);"></i>
                        <p>No TCP handshake flows recorded in this capture.</p>
                    </div>
                    {{end}}
                    
                    {{if gt .TCPHandshakeStats.FailedCount 0}}
                    <div style="background: rgba(225, 112, 85, 0.1); border-left: 4px solid var(--color-critical); padding: var(--space-lg); border-radius: var(--radius-md); margin-top: var(--space-lg);">
                        <h4 style="margin: 0 0 var(--space-sm) 0; color: var(--color-critical);">
                            <i class="fas fa-exclamation-circle"></i> Failed Handshake Analysis
                        </h4>
                        <p style="margin: 0 0 var(--space-md) 0; color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            <strong>{{.TCPHandshakeStats.FailedCount}}</strong> connection attempts failed to complete the TCP handshake. 
                            This typically indicates:
                        </p>
                        <ul style="margin: 0; padding-left: var(--space-xl); color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            <li>Services are unreachable or down</li>
                            <li>Firewall blocking connections</li>
                            <li>Network routing issues</li>
                            <li>Server overload or resource exhaustion</li>
                        </ul>
                    </div>
                    
                    {{if .FailedHandshakes}}
                    <h4 class="mb-md">Failed Handshake Details (Top 10)</h4>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source IP:Port</th>
                                    <th>Destination IP:Port</th>
                                    <th>Timestamp</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range $index, $flow := .FailedHandshakes}}
                                {{if lt $index 10}}
                                <tr>
                                    <td><code>{{$flow.SrcIP}}:{{$flow.SrcPort}}</code></td>
                                    <td><code>{{$flow.DstIP}}:{{$flow.DstPort}}</code></td>
                                    <td>{{formatUnixTimeShort $flow.Timestamp}}</td>
                                    <td>
                                        <span class="status-badge critical">
                                            <span class="status-dot"></span>
                                            No Response
                                        </span>
                                    </td>
                                </tr>
                                {{end}}
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{end}}
                    {{else}}
                    <div style="background: rgba(0, 184, 148, 0.1); border-left: 4px solid var(--color-success); padding: var(--space-lg); border-radius: var(--radius-md);">
                        <h4 style="margin: 0 0 var(--space-sm) 0; color: var(--color-success);">
                            <i class="fas fa-check-circle"></i> All Connections Successful
                        </h4>
                        <p style="margin: 0; color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            All TCP connection attempts successfully completed the three-way handshake. No unreachable services detected.
                        </p>
                    </div>
                    {{end}}
                </div>
            </div>
            
            <!-- TCP Handshake Analysis (v2.7.0 Style) -->
            {{if .TCPHandshakeFlows}}
            <details open>
                <summary><i class="fas fa-exchange-alt"></i> TCP Handshake Analysis ({{len .TCPHandshakeFlows}} flows)</summary>
                <div class="handshake-analysis-container">
                    <div class="handshake-intro">
                        <p>TCP handshake events grouped by flow for correlation analysis. Click on each flow to expand/collapse details.</p>
                        <div class="handshake-legend">
                            <span class="legend-item"><span class="legend-color legend-syn"></span> <i class="fas fa-arrow-right" style="color: #3b82f6;"></i> SYN (Client initiated)</span>
                            <span class="legend-item"><span class="legend-color legend-synack"></span> <i class="fas fa-arrow-left" style="color: #f97316;"></i> SYN-ACK (Server responded)</span>
                            <span class="legend-item"><span class="legend-color legend-complete"></span> <i class="fas fa-check" style="color: #10b981;"></i> Complete (Successful)</span>
                            <span class="legend-item"><span class="legend-color legend-failed"></span> <i class="fas fa-times" style="color: #ef4444;"></i> Failed (Handshake failed)</span>
                        </div>
                    </div>
                    
                    {{range $index, $flow := .TCPHandshakeFlows}}
                    {{if lt $index 50}}
                    <details class="handshake-flow-details">
                        <summary class="handshake-flow-summary">
                            <span class="flow-id"><i class="fas fa-stream"></i> {{$flow.SrcIP}}:{{$flow.SrcPort}} &rarr; {{$flow.DstIP}}:{{$flow.DstPort}}{{if $flow.IsIPv6}} <span class="badge badge-primary">IPv6</span>{{end}}</span>
                            {{if eq $flow.StateColor "success"}}
                            <span class="flow-status status-complete"><i class="fas fa-check-circle"></i> Complete</span>
                            {{else if eq $flow.StateColor "danger"}}
                            <span class="flow-status status-failed"><i class="fas fa-times-circle"></i> Failed</span>
                            {{else}}
                            <span class="flow-status status-pending"><i class="fas fa-clock"></i> {{$flow.State}}</span>
                            {{end}}
                        </summary>
                        <div class="handshake-flow-content">
                            <div class="handshake-events">
                            {{if eq $flow.StateColor "success"}}
                                <div class="event event-syn">
                                    <span class="event-icon"><i class="fas fa-arrow-right"></i></span>
                                    <span class="event-type">SYN</span>
                                    <span class="event-time">Client initiates connection</span>
                                    <span class="event-desc"></span>
                                </div>
                                <div class="event event-synack">
                                    <span class="event-icon"><i class="fas fa-arrow-left"></i></span>
                                    <span class="event-type">SYN-ACK</span>
                                    <span class="event-time">Server acknowledges</span>
                                    <span class="event-desc"></span>
                                </div>
                                <div class="event event-complete">
                                    <span class="event-icon"><i class="fas fa-check"></i></span>
                                    <span class="event-type">ACK</span>
                                    <span class="event-time">Connection established</span>
                                    <span class="event-desc">{{if ne $flow.TotalHandshakeMs 0.0}}{{printf "%.2f" $flow.TotalHandshakeMs}} ms{{end}}</span>
                                </div>
                            {{else if eq $flow.StateColor "danger"}}
                                <div class="event event-syn">
                                    <span class="event-icon"><i class="fas fa-arrow-right"></i></span>
                                    <span class="event-type">SYN</span>
                                    <span class="event-time">Client initiates connection</span>
                                    <span class="event-desc"></span>
                                </div>
                                <div class="event event-failed">
                                    <span class="event-icon"><i class="fas fa-times"></i></span>
                                    <span class="event-type">FAILED</span>
                                    <span class="event-time">{{if $flow.FailureReason}}{{$flow.FailureReason}}{{else}}Connection failed{{end}}</span>
                                    <span class="event-desc"></span>
                                </div>
                            {{else if eq $flow.StateColor "info"}}
                                <div class="event event-syn">
                                    <span class="event-icon"><i class="fas fa-arrow-right"></i></span>
                                    <span class="event-type">SYN</span>
                                    <span class="event-time">Client initiates connection (waiting for response)</span>
                                    <span class="event-desc"></span>
                                </div>
                            {{else if eq $flow.StateColor "warning"}}
                                <div class="event event-syn">
                                    <span class="event-icon"><i class="fas fa-arrow-right"></i></span>
                                    <span class="event-type">SYN</span>
                                    <span class="event-time">Client initiates connection</span>
                                    <span class="event-desc"></span>
                                </div>
                                <div class="event event-synack">
                                    <span class="event-icon"><i class="fas fa-arrow-left"></i></span>
                                    <span class="event-type">SYN-ACK</span>
                                    <span class="event-time">Server acknowledges (waiting for client ACK)</span>
                                    <span class="event-desc"></span>
                                </div>
                            {{end}}
                            </div>
                            <div class="handshake-explanation">
                                <h4><i class="fas fa-info-circle"></i> Handshake Explanation</h4>
                                {{if eq $flow.StateColor "success"}}
                                <p><strong>SYN:</strong> Client ({{$flow.SrcIP}}) initiates connection to server ({{$flow.DstIP}}) on port {{$flow.DstPort}}.</p>
                                <p><strong>SYN-ACK:</strong> Server acknowledges and agrees to establish connection.</p>
                                <p><strong>ACK:</strong> Client confirms. Connection is now established.</p>
                                {{else if eq $flow.StateColor "danger"}}
                                <p><strong>SYN:</strong> Client ({{$flow.SrcIP}}) attempted to connect to server ({{$flow.DstIP}}) on port {{$flow.DstPort}}.</p>
                                <div class="failure-note">
                                    <strong>Failure:</strong> {{if $flow.FailureReason}}{{$flow.FailureReason}}{{else}}The handshake did not complete successfully.{{end}}
                                </div>
                                <p><strong>Troubleshooting:</strong> Check if the server is reachable, verify firewall rules, and ensure the service is running on port {{$flow.DstPort}}.</p>
                                {{else if eq $flow.StateColor "info"}}
                                <p><strong>SYN:</strong> Client ({{$flow.SrcIP}}) initiated connection to server ({{$flow.DstIP}}) on port {{$flow.DstPort}}.</p>
                                <div class="pending-note">
                                    <strong>Pending:</strong> Waiting for server SYN-ACK response. This may indicate network latency or server unavailability.
                                </div>
                                {{else if eq $flow.StateColor "warning"}}
                                <p><strong>SYN:</strong> Client ({{$flow.SrcIP}}) initiated connection to server ({{$flow.DstIP}}) on port {{$flow.DstPort}}.</p>
                                <p><strong>SYN-ACK:</strong> Server acknowledged the connection request.</p>
                                <div class="pending-note">
                                    <strong>Pending:</strong> Waiting for client ACK to complete the handshake.
                                </div>
                                {{end}}
                                
                                <!-- Wireshark Filters inside Handshake Explanation -->
                                <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                                    <h5 style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; font-size: 0.875rem; color: var(--text-primary);">
                                        <i class="fas fa-filter" style="color: var(--primary);"></i>
                                        Wireshark Filters (Copy & Paste)
                                    </h5>
                                    <div style="margin-bottom: 10px;">
                                        <label style="display: block; font-size: 0.75rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">
                                            Directional Filter (Source  Destination):
                                        </label>
                                        <code style="display: block; padding: 10px 12px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 6px; font-size: 12px; word-break: break-all; font-family: 'Courier New', monospace; color: var(--text-primary);">{{$flow.WiresharkFilter}}</code>
                                    </div>
                                    <div>
                                        <label style="display: block; font-size: 0.75rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">
                                            Bidirectional Filter (Both Directions):
                                        </label>
                                        <code style="display: block; padding: 10px 12px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 6px; font-size: 12px; word-break: break-all; font-family: 'Courier New', monospace; color: var(--text-primary);">{{$flow.WiresharkFilterBidi}}</code>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .TCPHandshakeFlows) 50}}
                    <p style="text-align: center; padding: 16px; color: var(--text-secondary); font-size: 0.875rem;">
                        <i class="fas fa-info-circle"></i> Showing first 50 of {{len .TCPHandshakeFlows}} TCP handshake flows.
                    </p>
                    {{end}}
                </div>
            </details>
            {{end}}
            
            
            
            <!-- Performance Metrics Grid -->
            <div class="widget-grid mb-xl">
                <!-- TCP Retransmissions Widget -->
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-redo" style="color: var(--color-warning);"></i>
                            TCP Retransmissions
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl); margin-bottom: var(--space-md);">
                            {{.Stats.TCPRetransmissions}}
                        </div>
                        <p class="text-muted mb-md">Total retransmission events detected</p>
                        {{if gt .Stats.TCPRetransmissions 100}}
                        <div class="status-badge warning">
                            <span class="status-dot"></span>
                            High retransmission rate - investigate network quality
                        </div>
                        {{else}}
                        <div class="status-badge healthy">
                            <span class="status-dot"></span>
                            Normal retransmission rate
                        </div>
                        {{end}}
                    </div>
                </div>
                
                <!-- High RTT Flows Widget -->
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-clock" style="color: var(--color-info);"></i>
                            High Latency Flows
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl); margin-bottom: var(--space-md);">
                            {{.Stats.HighRTTFlows}}
                        </div>
                        <p class="text-muted mb-md">Flows with elevated round-trip time</p>
                        {{if gt .Stats.HighRTTFlows 10}}
                        <div class="status-badge warning">
                            <span class="status-dot"></span>
                            Multiple high-latency connections detected
                        </div>
                        {{else}}
                        <div class="status-badge healthy">
                            <span class="status-dot"></span>
                            Latency within acceptable range
                        </div>
                        {{end}}
                    </div>
                </div>
            </div>
            
            <!-- TCP Retransmissions Detail Table (Collapsible) -->
            {{if gt .Stats.TCPRetransmissions 0}}
            <details>
                <summary><i class="fas fa-redo"></i> Retransmission Details ({{.Stats.TCPRetransmissions}})</summary>
                <div>
                    {{if .TCPRetransmissions}}
                    <table class="data-table" id="retrans-table">
                        <thead>
                            <tr>
                                <th>Source IP:Port</th>
                                <th>Destination IP:Port</th>
                                <th>Count</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range .TCPRetransmissions}}
                            <tr>
                                <td><code>{{.SrcIP}}:{{.SrcPort}}</code></td>
                                <td><code>{{.DstIP}}:{{.DstPort}}</code></td>
                                <td>{{.Count}}</td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                    {{else}}
                    <p class="text-muted">No retransmission details available.</p>
                    {{end}}
                </div>
            </details>
            {{end}}
            
            <!-- High RTT Flows Detail Table -->
            {{if gt .Stats.HighRTTFlows 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-stopwatch card-title-icon"></i>
                        High Latency Flow Details
                    </h3>
                </div>
                <div class="card-body">
                    {{if .HighRTTFlows}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source IP:Port</th>
                                    <th>Destination IP:Port</th>
                                    <th>Average RTT (ms)</th>
                                    <th>Max RTT (ms)</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .HighRTTFlows}}
                                <tr>
                                    <td><code>{{.SrcIP}}:{{.SrcPort}}</code></td>
                                    <td><code>{{.DstIP}}:{{.DstPort}}</code></td>
                                    <td>{{printf "%.2f" .AvgRTT}}</td>
                                    <td>{{printf "%.2f" .MaxRTT}}</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No high RTT flow details available.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             TRAFFIC ANALYSIS SECTION
             ==================================================================== -->
        <section id="traffic" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-exchange-alt" style="color: var(--color-primary);"></i>
                Traffic Analysis
            </h2>
            
            <!-- Top Traffic Flows -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-bar card-title-icon"></i>
                        Top Traffic Flows
                    </h3>
                </div>
                <div class="card-body">
                    {{if .TopFlows}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source IP:Port</th>
                                    <th>Destination IP:Port</th>
                                    <th>Protocol</th>
                                    <th>Total Bytes</th>
                                    <th>Percentage</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .TopFlows}}
                                <tr>
                                    <td><code>{{.SrcIP}}:{{.SrcPort}}</code></td>
                                    <td><code>{{.DstIP}}:{{.DstPort}}</code></td>
                                    <td>{{.Protocol}}</td>
                                    <td>{{.BytesFormatted}}</td>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: var(--space-sm);">
                                            <div style="flex: 1; height: 8px; background: var(--color-border); border-radius: var(--radius-full); overflow: hidden;">
                                                <div style="width: {{printf "%.1f" .Percentage}}%; height: 100%; background: var(--color-primary);"></div>
                                            </div>
                                            <span style="min-width: 50px; text-align: right;">{{printf "%.1f" .Percentage}}%</span>
                                        </div>
                                    </td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No traffic flow data available.</p>
                    {{end}}
                </div>
            </div>
            
            <!-- Protocol Distribution -->
            {{if .ProtocolStats}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-layer-group card-title-icon"></i>
                        Protocol Distribution
                    </h3>
                </div>
                <div class="card-body">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Protocol</th>
                                    <th>Total Bytes</th>
                                    <th>Percentage</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .ProtocolStats}}
                                <tr>
                                    <td><strong>{{.Protocol}}</strong></td>
                                    <td>{{.Bytes}}</td>
                                    <td>{{printf "%.1f" .Percent}}%</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             PROTOCOLS SECTION
             ==================================================================== -->
        <section id="protocols" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-layer-group" style="color: var(--color-primary);"></i>
                Protocol Analysis
            </h2>
            
            <!-- Protocol Overview Widgets -->
            <div class="widget-grid mb-xl">
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-globe"></i>
                            DNS Queries
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl);">{{.Stats.DNSQueries}}</div>
                        <p class="text-muted">Total DNS queries processed</p>
                    </div>
                </div>
                
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-bolt"></i>
                            HTTP/2 Flows
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl);">{{.Stats.HTTP2Flows}}</div>
                        <p class="text-muted">Modern HTTP/2 connections</p>
                    </div>
                </div>
                
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-rocket"></i>
                            QUIC Flows
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl);">{{.Stats.QUICFlows}}</div>
                        <p class="text-muted">QUIC protocol connections</p>
                    </div>
                </div>
            </div>
            
            <!-- DNS Request/Response Analysis (v2.7.0 Style) -->
            {{if .DNSDetails}}
            <details open>
                <summary><i class="fas fa-globe"></i> DNS Request/Response Analysis ({{len .DNSDetails}})</summary>
                <div class="dns-analysis-container">
                    <div class="dns-intro">
                        <p>DNS queries and responses correlated with response times. Click on each query to expand details.</p>
                        <div class="dns-legend">
                            <span class="legend-item"><span class="legend-color legend-dns-query"></span> Query (Request)</span>
                            <span class="legend-item"><span class="legend-color legend-dns-response"></span> Response</span>
                            <span class="legend-item"><span class="legend-color legend-dns-error"></span> Error/No Response</span>
                        </div>
                    </div>
                    
                    {{range $index, $dns := .DNSDetails}}
                    {{if lt $index 50}}
                    <details class="dns-flow-details {{if $dns.IsAnomalous}}dns-anomalous{{end}}">
                        <summary class="dns-flow-summary">
                            <span class="dns-query-name"><i class="fas fa-search"></i> {{$dns.QueryName}}</span>
                            <span class="dns-meta">
                                <span class="dns-type badge">{{$dns.QueryType}}</span>
                                {{if $dns.HasResponse}}
                                <span class="dns-status badge badge-success"><i class="fas fa-check-circle"></i> {{$dns.ResponseCodeName}}</span>
                                {{else}}
                                <span class="dns-status badge badge-danger"><i class="fas fa-times-circle"></i> No Response</span>
                                {{end}}
                                {{if $dns.HasResponse}}<span class="dns-response-time">{{$dns.ResponseTimeMs}}</span>{{end}}
                            </span>
                        </summary>
                        <div class="dns-flow-content">
                            <div class="dns-events">
                                <div class="dns-event dns-event-query">
                                    <span class="dns-event-icon"><i class="fas fa-arrow-right"></i></span>
                                    <span class="dns-event-type">QUERY</span>
                                    <span class="dns-event-time">{{$dns.SourceIP}}  DNS Server</span>
                                    <span class="dns-event-detail">Type: {{$dns.QueryType}}</span>
                                </div>
                                {{if $dns.HasResponse}}
                                <div class="dns-event dns-event-response">
                                    <span class="dns-event-icon"><i class="fas fa-arrow-left"></i></span>
                                    <span class="dns-event-type">RESPONSE</span>
                                    <span class="dns-event-time">{{$dns.ResponseTimeMs}}</span>
                                    <span class="dns-event-detail">Code: {{$dns.ResponseCode}} ({{$dns.ResponseCodeName}})</span>
                                </div>
                                {{else}}
                                <div class="dns-event dns-event-error">
                                    <span class="dns-event-icon"><i class="fas fa-times"></i></span>
                                    <span class="dns-event-type">NO RESPONSE</span>
                                    <span class="dns-event-time">Timeout</span>
                                    <span class="dns-event-detail">DNS query did not receive a response</span>
                                </div>
                                {{end}}
                            </div>
                            
                            {{if $dns.AnswerIPs}}
                            <div class="dns-answers">
                                <h4><i class="fas fa-reply"></i> DNS Answers</h4>
                                <div class="dns-answer-row">
                                    <span class="dns-answer-label">IP Addresses:</span>
                                    <span class="dns-answer-value"><code>{{$dns.AnswerIPs}}</code></span>
                                </div>
                            </div>
                            {{end}}
                            
                            <div class="dns-explanation">
                                <h4><i class="fas fa-info-circle"></i> DNS Resolution Details</h4>
                                <p><strong>Client:</strong> {{$dns.SourceIP}} queried for {{$dns.QueryName}}</p>
                                <p><strong>Query Type:</strong> {{$dns.QueryType}} - 
                                    {{if eq $dns.QueryType "A"}}IPv4 address lookup{{else if eq $dns.QueryType "AAAA"}}IPv6 address lookup{{else if eq $dns.QueryType "CNAME"}}Canonical name lookup{{else if eq $dns.QueryType "MX"}}Mail exchange lookup{{else if eq $dns.QueryType "TXT"}}Text record lookup{{else if eq $dns.QueryType "PTR"}}Reverse DNS lookup{{else}}DNS record lookup{{end}}
                                </p>
                                {{if $dns.HasResponse}}
                                <p><strong>Response Time:</strong> {{$dns.ResponseTimeMs}}</p>
                                {{end}}
                                {{if $dns.IsAnomalous}}
                                <div class="dns-anomaly-note">
                                    <strong> Anomaly Detected:</strong> This DNS query shows unusual behavior that may indicate DNS tunneling, data exfiltration, or misconfiguration.
                                </div>
                                {{end}}
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .DNSDetails) 50}}
                    <p style="text-align: center; padding: 16px; color: var(--text-secondary); font-size: 0.875rem;">
                        <i class="fas fa-info-circle"></i> Showing first 50 of {{len .DNSDetails}} DNS queries.
                    </p>
                    {{end}}
                </div>
            </details>
            {{else}}
            <div class="card mb-xl">
                <div class="card-body">
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <i class="fas fa-info-circle" style="font-size: var(--font-size-3xl); margin-bottom: var(--space-md);"></i>
                        <p>No DNS queries recorded in this capture.</p>
                    </div>
                </div>
            </div>
            {{end}}
            
            <!-- HTTP/2 Flow Details -->
            {{if .HTTP2Flows}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-bolt card-title-icon"></i>
                        HTTP/2 Flows ({{len .HTTP2Flows}})
                    </h3>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-md">Modern HTTP/2 connections detected in the capture.</p>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source IP</th>
                                    <th>Source Port</th>
                                    <th>Destination IP</th>
                                    <th>Destination Port</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range $index, $flow := .HTTP2Flows}}
                                {{if lt $index 50}}
                                <tr>
                                    <td><code>{{$flow.SrcIP}}</code></td>
                                    <td>{{$flow.SrcPort}}</td>
                                    <td><code>{{$flow.DstIP}}</code></td>
                                    <td>{{$flow.DstPort}}</td>
                                </tr>
                                {{end}}
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{if gt (len .HTTP2Flows) 50}}
                    <p class="text-muted mt-md"><i class="fas fa-info-circle"></i> Showing first 50 of {{len .HTTP2Flows}} HTTP/2 flows.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            <!-- QUIC Flow Details -->
            {{if .QUICFlows}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-rocket card-title-icon"></i>
                        QUIC Flows ({{len .QUICFlows}})
                    </h3>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-md">QUIC protocol connections (HTTP/3) detected in the capture.</p>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source IP</th>
                                    <th>Source Port</th>
                                    <th>Destination IP</th>
                                    <th>Destination Port</th>
                                    <th>Server Name (SNI)</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range $index, $flow := .QUICFlows}}
                                {{if lt $index 50}}
                                <tr>
                                    <td><code>{{$flow.SrcIP}}</code></td>
                                    <td>{{$flow.SrcPort}}</td>
                                    <td><code>{{$flow.DstIP}}</code></td>
                                    <td>{{$flow.DstPort}}</td>
                                    <td>{{if $flow.ServerName}}<code>{{$flow.ServerName}}</code>{{else}}<span class="text-muted">-</span>{{end}}</td>
                                </tr>
                                {{end}}
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{if gt (len .QUICFlows) 50}}
                    <p class="text-muted mt-md"><i class="fas fa-info-circle"></i> Showing first 50 of {{len .QUICFlows}} QUIC flows.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            {{if .ProtocolGuide}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-book card-title-icon"></i>
                        Protocol Reference Guide
                    </h3>
                </div>
                <div class="card-body">
                    {{.ProtocolGuide}}
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             TUNNELS & SD-WAN SECTION
             ==================================================================== -->
        <section id="tunnels" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-network-wired" style="color: var(--color-primary);"></i>
                Tunnels & SD-WAN Analysis
            </h2>
            
            <!-- Tunnel Detection Card -->
            {{if gt .Stats.TunnelsDetected 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-tunnel card-title-icon"></i>
                        Detected Tunnels ({{.Stats.TunnelsDetected}})
                    </h3>
                </div>
                <div class="card-body">
                    {{if .TunnelFindings}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tunnel Type</th>
                                    <th>Source IP</th>
                                    <th>Destination IP</th>
                                    <th>Encapsulated Protocol</th>
                                    <th>Packet Count</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .TunnelFindings}}
                                <tr>
                                    <td>
                                        <span class="status-badge info">
                                            <span class="status-dot"></span>
                                            {{.Type}}
                                        </span>
                                    </td>
                                    <td><code>{{.OuterSrcIP}}</code></td>
                                    <td><code>{{.OuterDstIP}}</code></td>
                                    <td>{{.InnerProtocol}}</td>
                                    <td>{{.Count}}</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No tunnel details available.</p>
                    {{end}}
                </div>
            </div>
            {{else}}
            <div class="card mb-xl">
                <div class="card-body">
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <i class="fas fa-info-circle" style="font-size: var(--font-size-3xl); margin-bottom: var(--space-md);"></i>
                        <p>No tunnels detected in this capture.</p>
                    </div>
                </div>
            </div>
            {{end}}
            
            <!-- SD-WAN Vendors Card -->
            {{if gt .Stats.SDWANVendors 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-sitemap card-title-icon"></i>
                        SD-WAN Vendors Detected ({{.Stats.SDWANVendors}})
                    </h3>
                </div>
                <div class="card-body">
                    {{if .SDWANVendors}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Vendor</th>
                                    <th>Detected By</th>
                                    <th>Packet Count</th>
                                    <th>Confidence</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .SDWANVendors}}
                                <tr>
                                    <td><strong>{{.Name}}</strong></td>
                                    <td>{{.DetectedBy}}</td>
                                    <td>{{.PacketCount}} packets</td>
                                    <td>
                                        <span class="status-badge {{if eq .Confidence "High"}}healthy{{else}}warning{{end}}">
                                            <span class="status-dot"></span>
                                            {{.Confidence}}
                                        </span>
                                    </td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No SD-WAN vendor details available.</p>
                    {{end}}
                </div>
            </div>
            {{else}}
            <div class="card mb-xl">
                <div class="card-body">
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <i class="fas fa-info-circle" style="font-size: var(--font-size-3xl); margin-bottom: var(--space-md);"></i>
                        <p>No SD-WAN vendor signatures detected.</p>
                    </div>
                </div>
            </div>
            {{end}}
            
            <!-- VoIP Analysis Card -->
            {{if gt .Stats.VoIPCalls 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-phone-volume card-title-icon"></i>
                        VoIP Call Analysis ({{.Stats.VoIPCalls}} Calls)
                    </h3>
                </div>
                <div class="card-body">
                    {{if .VoIPAnalysis}}
                    <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-lg); margin-bottom: var(--space-xl);">
                        <div style="text-align: center; padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-lg);">
                            <div style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--color-info); margin-bottom: var(--space-sm);">
                                {{.VoIPAnalysis.TotalCalls}}
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                Total SIP Calls
                            </div>
                        </div>
                        
                        <div style="text-align: center; padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-lg);">
                            <div style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--color-warning); margin-bottom: var(--space-sm);">
                                {{printf "%.2f" .VoIPAnalysis.AvgJitter}} ms
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                Average Jitter
                            </div>
                        </div>
                        
                        <div style="text-align: center; padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-lg);">
                            <div style="font-size: var(--font-size-3xl); font-weight: 700; color: {{if gt .VoIPAnalysis.PacketLoss 5.0}}var(--color-critical){{else}}var(--color-success){{end}}; margin-bottom: var(--space-sm);">
                                {{printf "%.2f" .VoIPAnalysis.PacketLoss}}%
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                Packet Loss
                            </div>
                        </div>
                        
                        <div style="text-align: center; padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-lg);">
                            <div style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--color-info); margin-bottom: var(--space-sm);">
                                {{.VoIPAnalysis.CodecsUsed}}
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                Codecs Detected
                            </div>
                        </div>
                    </div>
                    
                    {{if gt .VoIPAnalysis.PacketLoss 5.0}}
                    <div style="background: rgba(225, 112, 85, 0.1); border-left: 4px solid var(--color-critical); padding: var(--space-lg); border-radius: var(--radius-md);">
                        <h4 style="margin: 0 0 var(--space-sm) 0; color: var(--color-critical);">
                            <i class="fas fa-exclamation-triangle"></i> High Packet Loss Detected
                        </h4>
                        <p style="margin: 0; color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            VoIP packet loss of {{printf "%.2f" .VoIPAnalysis.PacketLoss}}% exceeds acceptable threshold (5%). This may cause poor call quality.
                        </p>
                    </div>
                    {{end}}
                    {{else}}
                    <p class="text-muted">No VoIP analysis details available.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            <!-- GeoIP Summary Card -->
            {{if .GeoLocations}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-globe-americas card-title-icon"></i>
                        Geographic Distribution
                    </h3>
                </div>
                <div class="card-body">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Country</th>
                                    <th>IP Count</th>
                                    <th colspan="2">Details</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .GeoLocations}}
                                <tr>
                                    <td><strong>{{.Country}}</strong></td>
                                    <td>{{.Count}}</td>
                                    <td colspan="2">-</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             VISUALIZATIONS SECTION
             ==================================================================== -->
        <section id="visualizations" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-project-diagram" style="color: var(--color-primary);"></i>
                Network Visualizations
            </h2>
            
            <!-- Network Topology -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-network-wired card-title-icon"></i>
                        Network Topology
                    </h3>
                    <div class="card-actions">
                        <button class="card-action-button" onclick="resetTopology()">
                            <i class="fas fa-sync-alt"></i> Reset
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="network-diagram" class="chart-container" style="min-height: 600px; background: #ffffff; border: 1px solid var(--color-border); border-radius: var(--radius-md); position: relative;"></div>
                </div>
            </div>
            
            <!-- Timeline Visualization -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-timeline card-title-icon"></i>
                        Event Timeline
                    </h3>
                </div>
                <div class="card-body">
                    <div id="timeline" class="chart-container"></div>
                </div>
            </div>
            
            <!-- Sankey Diagram -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-stream card-title-icon"></i>
                        Traffic Flow Diagram
                    </h3>
                </div>
                <div class="card-body">
                    <div id="sankey-diagram" class="chart-container"></div>
                </div>
            </div>
            
            <!-- RTT Histogram -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-bar card-title-icon"></i>
                        RTT Distribution
                    </h3>
                </div>
                <div class="card-body">
                    <div id="rtt-histogram" class="chart-container"></div>
                </div>
            </div>
        </section>
        
        <!-- ====================================================================
             DEVICES SECTION
             ==================================================================== -->
        <section id="devices" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-laptop" style="color: var(--color-primary);"></i>
                Device Fingerprinting
            </h2>
            
            {{if .DeviceFingerprints}}
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-fingerprint card-title-icon"></i>
                        Detected Devices ({{.Stats.DevicesDetected}})
                    </h3>
                </div>
                <div class="card-body">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>IP Address</th>
                                    <th>OS Type</th>
                                    <th>Operating System</th>
                                    <th>Confidence</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .DeviceFingerprints}}
                                <tr>
                                    <td><code>{{.IP}}</code></td>
                                    <td>{{.OSType}}</td>
                                    <td>{{.OSName}}</td>
                                    <td>
                                        <span class="status-badge {{if eq .Confidence "High"}}healthy{{else if eq .Confidence "Medium"}}warning{{else}}unknown{{end}}">
                                            <span class="status-dot"></span>
                                            {{.Confidence}}
                                        </span>
                                    </td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {{else}}
            <div class="card">
                <div class="card-body">
                    <p class="text-muted text-center">No devices fingerprinted.</p>
                </div>
            </div>
            {{end}}
        </section>
        
    </main>
    
    <!-- ========================================================================
         JAVASCRIPT & VISUALIZATIONS
         ======================================================================== -->
    <script>
        // Visualization Data
        const networkData = {{.NetworkDataJSON}};
        const timelineData = {{.TimelineDataJSON}};
        const sankeyData = {{.SankeyDataJSON}};
        const rttHistogramData = {{.RTTHistogramJSON}};
        
        // Navigation handling
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // Show corresponding section
                const section = this.dataset.section;
                document.querySelectorAll('.dashboard-section').forEach(s => s.style.display = 'none');
                document.getElementById(section).style.display = 'block';
                
                // Update breadcrumb
                document.getElementById('currentSection').textContent = this.textContent.trim();
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
        
        // Global search functionality
        document.getElementById('globalSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            // Search through all tables
            document.querySelectorAll('.data-table tbody tr').forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
        
        // Toggle section visibility
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const button = event.target.closest('button');
            const icon = button.querySelector('i');
            
            if (section.style.display === 'none') {
                section.style.display = 'block';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                section.style.display = 'none';
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }
        
        // Export table to CSV
        function exportTableToCSV(tableId, filename) {
            const table = document.getElementById(tableId);
            let csv = [];
            
            // Get headers
            const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent);
            csv.push(headers.join(','));
            
            // Get rows
            table.querySelectorAll('tbody tr').forEach(row => {
                const cells = Array.from(row.querySelectorAll('td')).map(td => {
                    let text = td.textContent.trim();
                    // Escape commas and quotes
                    if (text.includes(',') || text.includes('"')) {
                        text = '"' + text.replace(/"/g, '""') + '"';
                    }
                    return text;
                });
                csv.push(cells.join(','));
            });
            
            // Download
            const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        // Reset topology visualization
        function resetTopology() {
            // This will be implemented with the visualization code
            if (typeof createNetworkDiagram === 'function') {
                const container = document.getElementById('network-diagram');
                container.innerHTML = '';
                createNetworkDiagram(container, networkData);
            }
        }
        
        // TCP Flow Table - Filter by IP address
        function filterTCPFlows(searchText) {
            const table = document.getElementById('tcp-flow-table');
            if (!table) return;
            
            const rows = table.querySelectorAll('tbody tr.tcp-flow-row');
            const search = searchText.toLowerCase().trim();
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }
        
        // TCP Flow Table - Sort by column
        let tcpSortDirection = {};
        function sortTCPTable(columnIndex) {
            const table = document.getElementById('tcp-flow-table');
            if (!table) return;
            
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr.tcp-flow-row'));
            
            // Toggle sort direction
            tcpSortDirection[columnIndex] = !tcpSortDirection[columnIndex];
            const ascending = tcpSortDirection[columnIndex];
            
            rows.sort((a, b) => {
                let aVal = a.cells[columnIndex].textContent.trim();
                let bVal = b.cells[columnIndex].textContent.trim();
                
                // Numeric sort for SYN/SYN-ACK columns
                if (columnIndex === 3 || columnIndex === 4) {
                    aVal = parseInt(aVal) || 0;
                    bVal = parseInt(bVal) || 0;
                    return ascending ? aVal - bVal : bVal - aVal;
                }
                
                // String sort for other columns
                return ascending ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
            });
            
            // Re-append sorted rows
            rows.forEach(row => tbody.appendChild(row));
            
            // Update sort indicators
            const headers = table.querySelectorAll('thead th');
            headers.forEach((th, i) => {
                const icon = th.querySelector('i.fa-sort, i.fa-sort-up, i.fa-sort-down');
                if (icon) {
                    if (i === columnIndex) {
                        icon.className = ascending ? 'fas fa-sort-up' : 'fas fa-sort-down';
                    } else {
                        icon.className = 'fas fa-sort';
                    }
                }
            });
        }
        
        // Copy to clipboard with visual feedback
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const icon = button.querySelector('i');
                const originalClass = icon.className;
                icon.className = 'fas fa-check';
                button.style.background = '#00B894';
                button.style.color = 'white';
                button.style.borderColor = '#00B894';
                
                setTimeout(() => {
                    icon.className = originalClass;
                    button.style.background = '';
                    button.style.color = '';
                    button.style.borderColor = '';
                }, 1500);
            }).catch(err => {
                console.error('Failed to copy:', err);
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            });
        }
        
        // Initialize visualizations when section is shown
        function initializeVisualizations() {
            try {
                if (networkData && networkData.nodes && networkData.nodes.length > 0) {
                    createNetworkDiagram(document.getElementById('network-diagram'), networkData);
                }
                
                if (timelineData && timelineData.length > 0) {
                    createTimeline(document.getElementById('timeline'), timelineData);
                }
                
                if (sankeyData && sankeyData.nodes && sankeyData.nodes.length > 0) {
                    createSankeyDiagram(document.getElementById('sankey-diagram'), sankeyData);
                }
                
                if (rttHistogramData && rttHistogramData.length > 0) {
                    createRTTHistogram(document.getElementById('rtt-histogram'), rttHistogramData);
                }
            } catch (error) {
                console.error('Error initializing visualizations:', error);
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize visualizations after a short delay to ensure DOM is ready
            setTimeout(initializeVisualizations, 100);
        });
    </script>
    
    <!-- Visualization Functions -->
    <script>{{.JS}}</script>
</body>
</html>
