<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SD-WAN Network Triage - {{.FileName}}</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Enterprise Dashboard Styles -->
    <style>{{.CSS}}</style>
</head>
<body>
    <!-- ========================================================================
         TOP NAVIGATION BAR
         ======================================================================== -->
    <header class="dashboard-header">
        <div class="header-container">
            <!-- Top Bar -->
            <div class="header-top">
                <!-- Brand -->
                <div class="header-brand">
                    <div class="brand-logo">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    <div>
                        <h1 class="brand-title">
                            SD-WAN Network Triage
                            <span class="brand-subtitle">v{{.Version}} - Enterprise Dashboard</span>
                        </h1>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="header-actions">
                    <!-- Search -->
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="globalSearch" placeholder="Search IPs, devices, events...">
                    </div>
                    
                    <!-- Export Button -->
                    <button class="header-button" onclick="window.print()">
                        <i class="fas fa-download"></i>
                        <span>Export PDF</span>
                    </button>
                    
                    <!-- Refresh Button -->
                    <button class="header-button primary" onclick="location.reload()">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh</span>
                    </button>
                </div>
            </div>
            
            <!-- Navigation Menu -->
            <nav class="header-nav">
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#dashboard" class="nav-link active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt nav-icon"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#security" class="nav-link" data-section="security">
                            <i class="fas fa-shield-alt nav-icon"></i>
                            <span>Security</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#performance" class="nav-link" data-section="performance">
                            <i class="fas fa-chart-line nav-icon"></i>
                            <span>Performance</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#traffic" class="nav-link" data-section="traffic">
                            <i class="fas fa-exchange-alt nav-icon"></i>
                            <span>Traffic</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#protocols" class="nav-link" data-section="protocols">
                            <i class="fas fa-layer-group nav-icon"></i>
                            <span>Protocols</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#tunnels" class="nav-link" data-section="tunnels">
                            <i class="fas fa-network-wired nav-icon"></i>
                            <span>Tunnels & SD-WAN</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#visualizations" class="nav-link" data-section="visualizations">
                            <i class="fas fa-project-diagram nav-icon"></i>
                            <span>Visualizations</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#devices" class="nav-link" data-section="devices">
                            <i class="fas fa-laptop nav-icon"></i>
                            <span>Devices</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    
    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <ul class="breadcrumb-list">
            <li class="breadcrumb-item">
                <a href="#" class="breadcrumb-link">Home</a>
            </li>
            <li class="breadcrumb-item" id="currentSection">Dashboard</li>
        </ul>
    </div>
    
    <!-- ========================================================================
         MAIN DASHBOARD CONTAINER
         ======================================================================== -->
    <main class="dashboard-container">
        
        <!-- ====================================================================
             EXECUTIVE SUMMARY - KPI TILES
             ==================================================================== -->
        <section id="dashboard" class="dashboard-section">
            <div class="kpi-grid">
                <!-- Network Health KPI -->
                <div class="kpi-card {{if eq .HealthStatus "good"}}success{{else if eq .HealthStatus "warning"}}warning{{else}}critical{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <span class="kpi-badge">
                            {{if eq .HealthStatus "good"}}Healthy{{else if eq .HealthStatus "warning"}}Warning{{else}}Critical{{end}}
                        </span>
                    </div>
                    <div class="kpi-value">{{.HealthStatus | title}}</div>
                    <div class="kpi-label">Network Health Status</div>
                    <div class="kpi-trend">
                        <i class="fas fa-info-circle"></i>
                        <span>Based on {{.TotalFindings}} findings</span>
                    </div>
                </div>
                
                <!-- CRITICAL: Failed Handshakes KPI -->
                <div class="kpi-card {{if gt .TCPHandshakeStats.FailedCount 0}}critical{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-handshake-slash"></i>
                        </div>
                        {{if gt .TCPHandshakeStats.FailedCount 0}}
                        <span class="kpi-badge">!</span>
                        {{end}}
                    </div>
                    <div class="kpi-value">{{.TCPHandshakeStats.FailedCount}}</div>
                    <div class="kpi-label">Failed TCP Handshakes</div>
                    <div class="kpi-trend {{if gt .TCPHandshakeStats.FailedCount 0}}down{{end}}">
                        {{if gt .TCPHandshakeStats.FailedCount 0}}
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Unreachable services or firewall blocks</span>
                        {{else}}
                        <i class="fas fa-check-circle"></i>
                        <span>All connections successful</span>
                        {{end}}
                    </div>
                </div>
                
                <!-- Security Threats KPI -->
                <div class="kpi-card {{if gt .Stats.DDoSAttacks 0}}critical{{else if or (gt .Stats.PortScans 0) (gt .Stats.IOCMatches 0)}}warning{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        {{if or (gt .Stats.DDoSAttacks 0) (gt .Stats.PortScans 0) (gt .Stats.IOCMatches 0) (gt .Stats.BGPIndicators 0)}}
                        <span class="kpi-badge">!</span>
                        {{end}}
                    </div>
                    <div class="kpi-value">{{add .Stats.DDoSAttacks .Stats.PortScans .Stats.IOCMatches}}</div>
                    <div class="kpi-label">Security Threats</div>
                    <div class="kpi-trend">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>DDoS: {{.Stats.DDoSAttacks}} | Scans: {{.Stats.PortScans}} | IOCs: {{.Stats.IOCMatches}} | BGP: {{.Stats.BGPIndicators}}</span>
                    </div>
                </div>
                
                <!-- Performance Issues KPI -->
                <div class="kpi-card {{if gt .Stats.TCPRetransmissions 100}}warning{{else if gt .Stats.HighRTTFlows 10}}warning{{else}}info{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.TCPRetransmissions}}</div>
                    <div class="kpi-label">TCP Retransmissions</div>
                    <div class="kpi-trend">
                        <i class="fas fa-clock"></i>
                        <span>High RTT: {{.Stats.HighRTTFlows}} | HTTP Errors: {{.Stats.HTTPErrors}}</span>
                    </div>
                </div>
                
                <!-- Tunnels & Encapsulation KPI -->
                <div class="kpi-card {{if gt .Stats.TunnelsDetected 0}}info{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-network-wired"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.TunnelsDetected}}</div>
                    <div class="kpi-label">Tunnels Detected</div>
                    <div class="kpi-trend">
                        <i class="fas fa-info-circle"></i>
                        <span>VXLAN, GRE, IPsec, etc.</span>
                    </div>
                </div>
                
                <!-- SD-WAN Vendors KPI -->
                <div class="kpi-card {{if gt .Stats.SDWANVendors 0}}info{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-sitemap"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.SDWANVendors}}</div>
                    <div class="kpi-label">SD-WAN Vendors</div>
                    <div class="kpi-trend">
                        <i class="fas fa-fingerprint"></i>
                        <span>Detected vendor signatures</span>
                    </div>
                </div>
                
                <!-- VoIP Calls KPI -->
                <div class="kpi-card {{if gt .Stats.VoIPCalls 0}}info{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-phone-volume"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.VoIPCalls}}</div>
                    <div class="kpi-label">VoIP Calls</div>
                    <div class="kpi-trend">
                        <i class="fas fa-info-circle"></i>
                        <span>SIP/RTP sessions detected</span>
                    </div>
                </div>
                
                <!-- DNS Queries KPI -->
                <div class="kpi-card {{if gt .Stats.DNSAnomalies 0}}warning{{else}}info{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.DNSQueries}}</div>
                    <div class="kpi-label">DNS Queries</div>
                    <div class="kpi-trend {{if gt .Stats.DNSAnomalies 0}}down{{end}}">
                        {{if gt .Stats.DNSAnomalies 0}}
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>{{.Stats.DNSAnomalies}} anomalies detected</span>
                        {{else}}
                        <i class="fas fa-check-circle"></i>
                        <span>No anomalies detected</span>
                        {{end}}
                    </div>
                </div>
                
                <!-- Devices Detected KPI -->
                <div class="kpi-card success">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-laptop"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.DevicesDetected}}</div>
                    <div class="kpi-label">Devices Identified</div>
                    <div class="kpi-trend">
                        <i class="fas fa-fingerprint"></i>
                        <span>ARP Conflicts: {{.Stats.ARPConflicts}}</span>
                    </div>
                </div>
            </div>
            
            <!-- ================================================================
                 EXECUTIVE SUMMARY CARD
                 ================================================================ -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-clipboard-list card-title-icon"></i>
                        Executive Summary
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-button" onclick="toggleSection('executive-summary')">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body" id="executive-summary">
                    <div class="dashboard-grid" style="grid-template-columns: 2fr 1fr; gap: var(--space-xl);">
                        <!-- Summary Content -->
                        <div>
                            <h3 class="mb-md">Analysis Overview</h3>
                            <p class="text-muted mb-lg">
                                Analyzed <strong>{{.FileName}}</strong> containing <strong>{{.PacketCount}} packets</strong> 
                                on <strong>{{.GeneratedAt}}</strong>.
                            </p>
                            
                            {{if .ExecutiveSummaryExplanation}}
                            <div class="mb-lg">
                                {{.ExecutiveSummaryExplanation}}
                            </div>
                            {{end}}
                            
                            <!-- Key Findings -->
                            <h4 class="mb-md">Key Findings</h4>
                            <div class="d-grid gap-md mb-lg">
                                {{if gt .Stats.DDoSAttacks 0}}
                                <div class="status-badge critical">
                                    <span class="status-dot"></span>
                                    <span>{{.Stats.DDoSAttacks}} DDoS Attack(s) Detected</span>
                                </div>
                                {{end}}
                                
                                {{if gt .Stats.PortScans 0}}
                                <div class="status-badge warning">
                                    <span class="status-dot"></span>
                                    <span>{{.Stats.PortScans}} Port Scan(s) Detected</span>
                                </div>
                                {{end}}
                                
                                {{if gt .Stats.TCPRetransmissions 100}}
                                <div class="status-badge warning">
                                    <span class="status-dot"></span>
                                    <span>High TCP Retransmission Rate ({{.Stats.TCPRetransmissions}})</span>
                                </div>
                                {{end}}
                                
                                {{if gt .Stats.DNSAnomalies 0}}
                                <div class="status-badge warning">
                                    <span class="status-dot"></span>
                                    <span>{{.Stats.DNSAnomalies}} DNS Anomalies Found</span>
                                </div>
                                {{end}}
                                
                                {{if and (eq .Stats.DDoSAttacks 0) (eq .Stats.PortScans 0) (lt .Stats.TCPRetransmissions 100)}}
                                <div class="status-badge healthy">
                                    <span class="status-dot"></span>
                                    <span>No Critical Issues Detected</span>
                                </div>
                                {{end}}
                            </div>
                        </div>
                        
                        <!-- Risk Assessment -->
                        <div>
                            <div class="card" style="background: var(--color-surface); border: none;">
                                <div class="card-body">
                                    <h4 class="mb-md">Risk Assessment</h4>
                                    <div class="text-center mb-lg">
                                        <div class="kpi-value" style="font-size: var(--font-size-4xl); color: {{if eq .RiskLevel "low"}}var(--color-success){{else if eq .RiskLevel "medium"}}var(--color-warning){{else}}var(--color-critical){{end}};">
                                            {{.RiskScore}}
                                        </div>
                                        <div class="kpi-label">Risk Score</div>
                                        <span class="status-badge {{if eq .RiskLevel "low"}}healthy{{else if eq .RiskLevel "medium"}}warning{{else}}critical{{end}}">
                                            <span class="status-dot"></span>
                                            {{.RiskLevel | title}} Risk
                                        </span>
                                    </div>
                                    
                                    {{if .RecommendedActions}}
                                    <h5 class="mb-sm">Recommended Actions</h5>
                                    <ul style="padding-left: var(--space-lg); margin: 0; font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                        {{range .RecommendedActions}}
                                        <li style="margin-bottom: var(--space-sm);">{{.}}</li>
                                        {{end}}
                                    </ul>
                                    {{end}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <i class="fas fa-clock"></i> Last updated: {{.GeneratedAt}}
                </div>
            </div>
        </section>
        
        <!-- ====================================================================
             SECURITY ANALYSIS SECTION
             ==================================================================== -->
        <section id="security" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-shield-alt" style="color: var(--color-primary);"></i>
                Security Analysis
            </h2>
            
            <!-- Security Overview Widget Grid -->
            <div class="widget-grid mb-xl">
                <!-- DDoS Attacks Widget -->
                {{if gt .Stats.DDoSAttacks 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-bomb" style="color: var(--color-critical);"></i>
                            DDoS Attacks ({{.Stats.DDoSAttacks}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .DDoSFindings}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Source IP</th>
                                        <th>Target IP</th>
                                        <th>Packet Count</th>
                                        <th>Severity</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .DDoSFindings}}
                                    <tr>
                                        <td><code>{{.Type}}</code></td>
                                        <td><code>{{.SourceIP}}</code></td>
                                        <td><code>{{.TargetIP}}</code></td>
                                        <td>{{.PacketCount}}</td>
                                        <td>
                                            <span class="status-badge critical">
                                                <span class="status-dot"></span>
                                                High
                                            </span>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No DDoS attacks detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- Port Scans Widget -->
                {{if gt .Stats.PortScans 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-search" style="color: var(--color-warning);"></i>
                            Port Scans ({{.Stats.PortScans}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .PortScanFindings}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Source IP</th>
                                        <th>Target IP</th>
                                        <th>Ports Scanned</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .PortScanFindings}}
                                    <tr>
                                        <td><code>{{.Type}}</code></td>
                                        <td><code>{{.SourceIP}}</code></td>
                                        <td><code>{{.TargetIP}}</code></td>
                                        <td>{{.PortsScanned}}</td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No port scans detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- IOC Matches Widget -->
                {{if gt .Stats.IOCMatches 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-crosshairs" style="color: var(--color-critical);"></i>
                            IOC Matches ({{.Stats.IOCMatches}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .IOCFindings}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Matched Value</th>
                                        <th>Type</th>
                                        <th>Source IP</th>
                                        <th>Confidence</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .IOCFindings}}
                                    <tr>
                                        <td><code>{{.MatchedValue}}</code></td>
                                        <td>{{.IOCType}}</td>
                                        <td><code>{{.SourceIP}}</code></td>
                                        <td>
                                            <span class="status-badge {{if eq .Confidence "High"}}critical{{else}}warning{{end}}">
                                                <span class="status-dot"></span>
                                                {{.Confidence}}
                                            </span>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No IOC matches detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- BGP Indicators Widget -->
                {{if gt .Stats.BGPIndicators 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-route" style="color: var(--color-warning);"></i>
                            BGP Hijack Indicators ({{.Stats.BGPIndicators}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .BGPIndicators}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>IP Address</th>
                                        <th>Expected ASN</th>
                                        <th>Observed ASN</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .BGPIndicators}}
                                    <tr>
                                        <td><code>{{.IPAddress}}</code></td>
                                        <td>AS{{.ExpectedASN}} ({{.ExpectedASName}})</td>
                                        <td>AS{{.ObservedASN}} ({{.ObservedASName}})</td>
                                        <td>
                                            <span class="status-badge {{if .IsAnomaly}}critical{{else}}warning{{end}}">
                                                <span class="status-dot"></span>
                                                {{if .IsAnomaly}}Anomaly{{else}}Suspicious{{end}}
                                            </span>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No BGP indicators detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- TLS Security Issues Widget -->
                {{if gt .Stats.TLSWeaknesses 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-lock-open" style="color: var(--color-warning);"></i>
                            TLS Security Issues ({{.Stats.TLSWeaknesses}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .TLSSecurityFindings}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Server IP</th>
                                        <th>Issue Type</th>
                                        <th>Details</th>
                                        <th>Severity</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .TLSSecurityFindings}}
                                    <tr>
                                        <td><code>{{.ServerIP}}</code></td>
                                        <td>{{.IssueType}}</td>
                                        <td>{{.Details}}</td>
                                        <td>
                                            <span class="status-badge {{if eq .Severity "High"}}critical{{else}}warning{{end}}">
                                                <span class="status-dot"></span>
                                                {{.Severity}}
                                            </span>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No TLS security issues detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
            </div>
            
            <!-- DNS Anomalies Card -->
            {{if gt .Stats.DNSAnomalies 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-exclamation-triangle card-title-icon"></i>
                        DNS Anomalies ({{.Stats.DNSAnomalies}})
                    </h3>
                </div>
                <div class="card-body">
                    {{if .DNSAnomalies}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Query</th>
                                    <th>Answer IP</th>
                                    <th>Server IP</th>
                                    <th>Reason</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .DNSAnomalies}}
                                <tr>
                                    <td><code>{{.Query}}</code></td>
                                    <td><code>{{.AnswerIP}}</code></td>
                                    <td><code>{{.ServerIP}}</code></td>
                                    <td>{{.Reason}}</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No DNS anomalies detected.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            <!-- TLS Security Findings -->
            {{if gt .Stats.TLSWeaknesses 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-lock-open card-title-icon"></i>
                        TLS Security Issues ({{.Stats.TLSWeaknesses}})
                    </h3>
                </div>
                <div class="card-body">
                    {{if .TLSSecurityFindings}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Server IP</th>
                                    <th>Issue Type</th>
                                    <th>Details</th>
                                    <th>Severity</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .TLSSecurityFindings}}
                                <tr>
                                    <td><code>{{.ServerIP}}</code></td>
                                    <td>{{.IssueType}}</td>
                                    <td>{{.Details}}</td>
                                    <td>
                                        <span class="status-badge {{if eq .Severity "High"}}critical{{else}}warning{{end}}">
                                            <span class="status-dot"></span>
                                            {{.Severity}}
                                        </span>
                                    </td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No TLS security issues detected.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             PERFORMANCE ANALYSIS SECTION
             ==================================================================== -->
        <section id="performance" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-chart-line" style="color: var(--color-primary);"></i>
                Performance Analysis
            </h2>
            
            <!-- TCP Handshake Analysis Card (CRITICAL) -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-handshake card-title-icon"></i>
                        TCP Connection Analysis - Per-Flow Breakdown
                    </h3>
                    <div class="card-actions">
                        <span class="status-badge {{if gt .TCPHandshakeStats.FailedCount 0}}critical{{else}}healthy{{end}}">
                            <span class="status-dot"></span>
                            {{.TCPHandshakeStats.SuccessfulCount}} Success / {{.TCPHandshakeStats.FailedCount}} Failed
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Summary Stats Row -->
                    <div class="dashboard-grid" style="grid-template-columns: repeat(4, 1fr); gap: var(--space-md); margin-bottom: var(--space-xl);">
                        <div style="text-align: center; padding: var(--space-md); background: var(--color-surface); border-radius: var(--radius-md); border-left: 4px solid var(--color-info);">
                            <div style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--color-info);">{{.TCPHandshakeStats.TotalSYN}}</div>
                            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Total SYN</div>
                        </div>
                        <div style="text-align: center; padding: var(--space-md); background: var(--color-surface); border-radius: var(--radius-md); border-left: 4px solid var(--color-success);">
                            <div style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--color-success);">{{.TCPHandshakeStats.TotalSYNACK}}</div>
                            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Total SYN-ACK</div>
                        </div>
                        <div style="text-align: center; padding: var(--space-md); background: var(--color-surface); border-radius: var(--radius-md); border-left: 4px solid var(--color-success);">
                            <div style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--color-success);">{{.TCPHandshakeStats.SuccessfulCount}}</div>
                            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Successful</div>
                        </div>
                        <div style="text-align: center; padding: var(--space-md); background: {{if gt .TCPHandshakeStats.FailedCount 0}}rgba(225, 112, 85, 0.1){{else}}var(--color-surface){{end}}; border-radius: var(--radius-md); border-left: 4px solid {{if gt .TCPHandshakeStats.FailedCount 0}}var(--color-critical){{else}}var(--color-success){{end}};">
                            <div style="font-size: var(--font-size-2xl); font-weight: 700; color: {{if gt .TCPHandshakeStats.FailedCount 0}}var(--color-critical){{else}}var(--color-success){{end}};">{{.TCPHandshakeStats.FailedCount}}</div>
                            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Failed</div>
                        </div>
                    </div>
                    
                    <!-- Per-Flow Detailed Table -->
                    {{if .TCPHandshakeCorrelatedFlows}}
                    <div class="mb-md">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-md);">
                            <h4 style="margin: 0;"><i class="fas fa-list"></i> Per-Flow Details ({{len .TCPHandshakeCorrelatedFlows}} flows)</h4>
                            <input type="text" id="tcp-flow-search" placeholder="Filter by IP address..." 
                                   style="padding: var(--space-sm) var(--space-md); border: 1px solid var(--color-border); border-radius: var(--radius-md); font-size: var(--font-size-sm); width: 250px;"
                                   onkeyup="filterTCPFlows(this.value)">
                        </div>
                        <div class="data-table-container" style="max-height: 500px; overflow-y: auto;">
                            <table class="data-table" id="tcp-flow-table">
                                <thead style="position: sticky; top: 0; background: var(--color-background); z-index: 10;">
                                    <tr>
                                        <th style="cursor: pointer;" onclick="sortTCPTable(0)">Source IP:Port <i class="fas fa-sort"></i></th>
                                        <th style="cursor: pointer;" onclick="sortTCPTable(1)">Destination IP:Port <i class="fas fa-sort"></i></th>
                                        <th style="cursor: pointer;" onclick="sortTCPTable(2)">Status <i class="fas fa-sort"></i></th>
                                        <th style="cursor: pointer;" onclick="sortTCPTable(3)">SYN Sent <i class="fas fa-sort"></i></th>
                                        <th style="cursor: pointer;" onclick="sortTCPTable(4)">SYN-ACK Recv <i class="fas fa-sort"></i></th>
                                        <th>Wireshark Filter</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range $index, $flow := .TCPHandshakeCorrelatedFlows}}
                                    <tr class="tcp-flow-row {{if eq $flow.Status "Complete"}}status-row-success{{else if eq $flow.Status "Failed"}}status-row-failed{{else}}status-row-partial{{end}}">
                                        <td><code>{{$flow.SrcIP}}:{{$flow.SrcPort}}</code></td>
                                        <td><code>{{$flow.DstIP}}:{{$flow.DstPort}}</code></td>
                                        <td>
                                            <span class="tcp-status-badge {{if eq $flow.Status "Complete"}}tcp-status-success{{else if eq $flow.Status "Failed"}}tcp-status-failed{{else}}tcp-status-partial{{end}}">
                                                {{if eq $flow.Status "Complete"}}<i class="fas fa-check-circle"></i>{{else if eq $flow.Status "Failed"}}<i class="fas fa-times-circle"></i>{{else}}<i class="fas fa-clock"></i>{{end}}
                                                {{$flow.Status}}
                                            </span>
                                        </td>
                                        <td style="text-align: center;">{{$flow.SynCount}}</td>
                                        <td style="text-align: center;">{{$flow.SynAckCount}}</td>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: var(--space-xs);">
                                                <code class="wireshark-filter" style="font-size: var(--font-size-xs); flex: 1; overflow: hidden; text-overflow: ellipsis;">ip.addr=={{$flow.SrcIP}} && ip.addr=={{$flow.DstIP}} && tcp.port=={{$flow.DstPort}}</code>
                                                <button class="copy-filter-btn" onclick="copyToClipboard('ip.addr=={{$flow.SrcIP}} && ip.addr=={{$flow.DstIP}} && tcp.port=={{$flow.DstPort}}', this)" title="Copy filter">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {{else}}
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <i class="fas fa-info-circle" style="font-size: var(--font-size-2xl); margin-bottom: var(--space-md);"></i>
                        <p>No TCP handshake flows recorded in this capture.</p>
                    </div>
                    {{end}}
                    
                    {{if gt .TCPHandshakeStats.FailedCount 0}}
                    <div style="background: rgba(225, 112, 85, 0.1); border-left: 4px solid var(--color-critical); padding: var(--space-lg); border-radius: var(--radius-md); margin-top: var(--space-lg);">
                        <h4 style="margin: 0 0 var(--space-sm) 0; color: var(--color-critical);">
                            <i class="fas fa-exclamation-circle"></i> Failed Handshake Analysis
                        </h4>
                        <p style="margin: 0 0 var(--space-md) 0; color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            <strong>{{.TCPHandshakeStats.FailedCount}}</strong> connection attempts failed to complete the TCP handshake. 
                            This typically indicates:
                        </p>
                        <ul style="margin: 0; padding-left: var(--space-xl); color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            <li>Services are unreachable or down</li>
                            <li>Firewall blocking connections</li>
                            <li>Network routing issues</li>
                            <li>Server overload or resource exhaustion</li>
                        </ul>
                    </div>
                    
                    {{if .FailedHandshakes}}
                    <h4 class="mb-md">Failed Handshake Details (Top 10)</h4>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source IP:Port</th>
                                    <th>Destination IP:Port</th>
                                    <th>Timestamp</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range $index, $flow := .FailedHandshakes}}
                                {{if lt $index 10}}
                                <tr>
                                    <td><code>{{$flow.SrcIP}}:{{$flow.SrcPort}}</code></td>
                                    <td><code>{{$flow.DstIP}}:{{$flow.DstPort}}</code></td>
                                    <td>{{formatUnixTimeShort $flow.Timestamp}}</td>
                                    <td>
                                        <span class="status-badge critical">
                                            <span class="status-dot"></span>
                                            No Response
                                        </span>
                                    </td>
                                </tr>
                                {{end}}
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{end}}
                    {{else}}
                    <div style="background: rgba(0, 184, 148, 0.1); border-left: 4px solid var(--color-success); padding: var(--space-lg); border-radius: var(--radius-md);">
                        <h4 style="margin: 0 0 var(--space-sm) 0; color: var(--color-success);">
                            <i class="fas fa-check-circle"></i> All Connections Successful
                        </h4>
                        <p style="margin: 0; color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            All TCP connection attempts successfully completed the three-way handshake. No unreachable services detected.
                        </p>
                    </div>
                    {{end}}
                </div>
            </div>
            
            <!-- TCP Handshake Analysis - Complete Redesign with Inline Styles -->
            {{if .TCPHandshakeFlows}}
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-exchange-alt"></i>
                        TCP Handshake Analysis
                        <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{len .TCPHandshakeFlows}} flows</span>
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Three-way handshake analysis showing connection establishment between clients and servers</p>
                </div>
                
                <!-- Educational Introduction for Junior Engineers -->
                <div style="background: #f0f9ff; border-bottom: 1px solid #bae6fd; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #0ea5e9; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #0c4a6e; font-size: 1rem;">What is a TCP Handshake?</h4>
                            <p style="margin: 0 0 12px 0; color: #475569; font-size: 0.875rem; line-height: 1.6;">
                                Before two computers can exchange data over TCP, they must establish a connection using a <strong>three-way handshake</strong>. 
                                This ensures both sides are ready to communicate and agree on initial sequence numbers.
                            </p>
                            <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; font-size: 0.8125rem; color: #64748b;">
                                <span style="background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px;">Step 1: SYN</span>
                                <span></span>
                                <span style="background: #ffedd5; color: #c2410c; padding: 2px 8px; border-radius: 4px;">Step 2: SYN-ACK</span>
                                <span></span>
                                <span style="background: #d1fae5; color: #047857; padding: 2px 8px; border-radius: 4px;">Step 3: ACK</span>
                                <span></span>
                                <span style="background: #f0fdf4; color: #166534; padding: 2px 8px; border-radius: 4px; border: 1px solid #86efac;">Connection Ready!</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Color-Coded Legend -->
                <div style="background: #fafafa; border-bottom: 1px solid #e5e7eb; padding: 16px 24px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 24px; align-items: center;">
                        <span style="font-weight: 600; color: #374151; font-size: 0.875rem;">Legend:</span>
                        <!-- SYN - Blue -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-right" style="color: #3b82f6; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #1e40af; font-weight: 500;">SYN</span>
                            <span style="font-size: 0.75rem; color: #64748b;">Client initiates</span>
                        </div>
                        <!-- SYN-ACK - Orange -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #ffedd5; border: 3px solid #f97316; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-left" style="color: #f97316; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #c2410c; font-weight: 500;">SYN-ACK</span>
                            <span style="font-size: 0.75rem; color: #64748b;">Server responds</span>
                        </div>
                        <!-- Complete - Green -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #d1fae5; border: 3px solid #10b981; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="color: #10b981; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #047857; font-weight: 500;">Complete</span>
                            <span style="font-size: 0.75rem; color: #64748b;">Handshake successful</span>
                        </div>
                        <!-- Failed - Red -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #fee2e2; border: 3px solid #ef4444; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-times" style="color: #ef4444; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #b91c1c; font-weight: 500;">Failed</span>
                            <span style="font-size: 0.75rem; color: #64748b;">Handshake failed</span>
                        </div>
                    </div>
                </div>
                
                <!-- Flow List -->
                <div style="padding: 16px 24px;">
                    {{range $index, $flow := .TCPHandshakeFlows}}
                    {{if lt $index 50}}
                    <details style="margin-bottom: 12px; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; {{if eq $flow.StateColor "danger"}}border-color: #fca5a5; background: #fef2f2;{{else if eq $flow.StateColor "success"}}border-color: #86efac;{{end}}">
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; background: {{if eq $flow.StateColor "success"}}#f0fdf4{{else if eq $flow.StateColor "danger"}}#fef2f2{{else if eq $flow.StateColor "warning"}}#fffbeb{{else}}#f8fafc{{end}}; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-network-wired" style="color: {{if eq $flow.StateColor "success"}}#10b981{{else if eq $flow.StateColor "danger"}}#ef4444{{else if eq $flow.StateColor "warning"}}#f59e0b{{else}}#3b82f6{{end}};"></i>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$flow.SrcIP}}:{{$flow.SrcPort}}
                                </span>
                                <span style="color: #9ca3af; font-weight: bold;"></span>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$flow.DstIP}}:{{$flow.DstPort}}
                                </span>
                                {{if $flow.IsIPv6}}<span style="background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px; font-size: 0.6875rem; font-weight: 600;">IPv6</span>{{end}}
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                {{if ne $flow.TotalHandshakeMs 0.0}}
                                <span style="color: #6b7280; font-size: 0.75rem;">{{printf "%.2f" $flow.TotalHandshakeMs}} ms</span>
                                {{end}}
                                {{if eq $flow.StateColor "success"}}
                                <span style="background: #d1fae5; color: #047857; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-check-circle"></i> Complete
                                </span>
                                {{else if eq $flow.StateColor "danger"}}
                                <span style="background: #fee2e2; color: #b91c1c; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-times-circle"></i> Failed
                                </span>
                                {{else if eq $flow.StateColor "warning"}}
                                <span style="background: #fef3c7; color: #b45309; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-clock"></i> Pending
                                </span>
                                {{else}}
                                <span style="background: #dbeafe; color: #1e40af; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-hourglass-half"></i> {{$flow.State}}
                                </span>
                                {{end}}
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- Visual Flow Timeline -->
                            <div style="margin-bottom: 20px;">
                                <h4 style="margin: 0 0 16px 0; font-size: 0.9375rem; color: #374151; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-stream" style="color: #6366f1;"></i>
                                    Handshake Timeline
                                </h4>
                                
                                {{if eq $flow.StateColor "success"}}
                                <!-- Successful Handshake - All 3 Steps -->
                                <div style="display: flex; flex-direction: column; gap: 0;">
                                    <!-- Step 1: SYN -->
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-right" style="color: #3b82f6;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: linear-gradient(to bottom, #3b82f6, #f97316); min-height: 20px;"></div>
                                        </div>
                                        <div style="flex: 1; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #1e40af; font-size: 0.875rem;">1. SYN</span>
                                                <span style="font-size: 0.75rem; color: #3b82f6; background: white; padding: 2px 8px; border-radius: 4px;">Client  Server</span>
                                            </div>
                                            <p style="margin: 0; color: #1e40af; font-size: 0.8125rem;">Client requests connection to server</p>
                                        </div>
                                    </div>
                                    <!-- Step 2: SYN-ACK -->
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #ffedd5; border: 3px solid #f97316; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-left" style="color: #f97316;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: linear-gradient(to bottom, #f97316, #10b981); min-height: 20px;"></div>
                                        </div>
                                        <div style="flex: 1; background: #ffedd5; border-left: 4px solid #f97316; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #c2410c; font-size: 0.875rem;">2. SYN-ACK</span>
                                                <span style="font-size: 0.75rem; color: #ea580c; background: white; padding: 2px 8px; border-radius: 4px;">Server  Client</span>
                                            </div>
                                            <p style="margin: 0; color: #c2410c; font-size: 0.8125rem;">Server acknowledges and accepts connection</p>
                                        </div>
                                    </div>
                                    <!-- Step 3: ACK (Complete) -->
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #d1fae5; border: 3px solid #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-check" style="color: #10b981;"></i>
                                            </div>
                                        </div>
                                        <div style="flex: 1; background: #d1fae5; border-left: 4px solid #10b981; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #047857; font-size: 0.875rem;">3. ACK (Complete)</span>
                                                <span style="font-size: 0.75rem; color: #059669; background: white; padding: 2px 8px; border-radius: 4px;">Client  Server</span>
                                            </div>
                                            <p style="margin: 0; color: #047857; font-size: 0.8125rem;">Client confirms. Connection established! {{if ne $flow.TotalHandshakeMs 0.0}}<strong>({{printf "%.2f" $flow.TotalHandshakeMs}} ms total)</strong>{{end}}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                {{else if eq $flow.StateColor "danger"}}
                                <!-- Failed Handshake -->
                                <div style="display: flex; flex-direction: column; gap: 0;">
                                    <!-- Step 1: SYN -->
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-right" style="color: #3b82f6;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: linear-gradient(to bottom, #3b82f6, #ef4444); min-height: 20px;"></div>
                                        </div>
                                        <div style="flex: 1; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #1e40af; font-size: 0.875rem;">1. SYN</span>
                                                <span style="font-size: 0.75rem; color: #3b82f6; background: white; padding: 2px 8px; border-radius: 4px;">Client  Server</span>
                                            </div>
                                            <p style="margin: 0; color: #1e40af; font-size: 0.8125rem;">Client attempted to connect</p>
                                        </div>
                                    </div>
                                    <!-- Failed Step -->
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #fee2e2; border: 3px solid #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-times" style="color: #ef4444;"></i>
                                            </div>
                                        </div>
                                        <div style="flex: 1; background: #fee2e2; border-left: 4px solid #ef4444; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #b91c1c; font-size: 0.875rem;">FAILED</span>
                                                <span style="font-size: 0.75rem; color: #dc2626; background: white; padding: 2px 8px; border-radius: 4px;">Connection Failed</span>
                                            </div>
                                            <p style="margin: 0; color: #b91c1c; font-size: 0.8125rem;">{{if $flow.FailureReason}}{{$flow.FailureReason}}{{else}}Handshake did not complete{{end}}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                {{else if eq $flow.StateColor "warning"}}
                                <!-- Pending (SYN-ACK received, waiting for ACK) -->
                                <div style="display: flex; flex-direction: column; gap: 0;">
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-right" style="color: #3b82f6;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: linear-gradient(to bottom, #3b82f6, #f97316); min-height: 20px;"></div>
                                        </div>
                                        <div style="flex: 1; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <span style="font-weight: 700; color: #1e40af; font-size: 0.875rem;">1. SYN</span>
                                            <p style="margin: 4px 0 0 0; color: #1e40af; font-size: 0.8125rem;">Client initiated connection</p>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #ffedd5; border: 3px solid #f97316; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-left" style="color: #f97316;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: #d1d5db; min-height: 20px; border-left: 2px dashed #9ca3af;"></div>
                                        </div>
                                        <div style="flex: 1; background: #ffedd5; border-left: 4px solid #f97316; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <span style="font-weight: 700; color: #c2410c; font-size: 0.875rem;">2. SYN-ACK</span>
                                            <p style="margin: 4px 0 0 0; color: #c2410c; font-size: 0.8125rem;">Server acknowledged</p>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #f3f4f6; border: 3px dashed #9ca3af; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-clock" style="color: #9ca3af;"></i>
                                            </div>
                                        </div>
                                        <div style="flex: 1; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                                            <span style="font-weight: 700; color: #b45309; font-size: 0.875rem;">3. ACK (Waiting...)</span>
                                            <p style="margin: 4px 0 0 0; color: #b45309; font-size: 0.8125rem;">Waiting for client to complete handshake</p>
                                        </div>
                                    </div>
                                </div>
                                
                                {{else}}
                                <!-- SYN Sent (waiting for SYN-ACK) -->
                                <div style="display: flex; flex-direction: column; gap: 0;">
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-right" style="color: #3b82f6;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: #d1d5db; min-height: 20px; border-left: 2px dashed #9ca3af;"></div>
                                        </div>
                                        <div style="flex: 1; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <span style="font-weight: 700; color: #1e40af; font-size: 0.875rem;">1. SYN</span>
                                            <p style="margin: 4px 0 0 0; color: #1e40af; font-size: 0.8125rem;">Client initiated connection</p>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #f3f4f6; border: 3px dashed #9ca3af; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-clock" style="color: #9ca3af;"></i>
                                            </div>
                                        </div>
                                        <div style="flex: 1; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                                            <span style="font-weight: 700; color: #b45309; font-size: 0.875rem;">2. SYN-ACK (Waiting...)</span>
                                            <p style="margin: 4px 0 0 0; color: #b45309; font-size: 0.8125rem;">Waiting for server response</p>
                                        </div>
                                    </div>
                                </div>
                                {{end}}
                            </div>
                            
                            <!-- Explanation Section -->
                            <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #475569; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-lightbulb" style="color: #eab308;"></i>
                                    What This Means
                                </h4>
                                {{if eq $flow.StateColor "success"}}
                                <p style="margin: 0 0 8px 0; font-size: 0.8125rem; color: #64748b; line-height: 1.6;">
                                    <strong style="color: #047857;"> Successful Connection:</strong> The client at <code style="background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem;">{{$flow.SrcIP}}</code> 
                                    successfully established a TCP connection to the server at <code style="background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem;">{{$flow.DstIP}}:{{$flow.DstPort}}</code>.
                                </p>
                                <p style="margin: 0; font-size: 0.8125rem; color: #64748b; line-height: 1.6;">
                                    The three-way handshake completed normally, and data transfer can now occur over this connection.
                                </p>
                                {{else if eq $flow.StateColor "danger"}}
                                <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 6px; padding: 12px; margin-bottom: 12px;">
                                    <p style="margin: 0; font-size: 0.8125rem; color: #b91c1c; font-weight: 500;">
                                        <i class="fas fa-exclamation-triangle"></i> <strong>Connection Failed:</strong> {{if $flow.FailureReason}}{{$flow.FailureReason}}{{else}}The handshake did not complete.{{end}}
                                    </p>
                                </div>
                                <p style="margin: 0 0 8px 0; font-size: 0.8125rem; color: #64748b; line-height: 1.6;">
                                    <strong>Troubleshooting Steps:</strong>
                                </p>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #64748b; line-height: 1.8;">
                                    <li>Verify the server at <code style="background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem;">{{$flow.DstIP}}</code> is reachable</li>
                                    <li>Check if port <code style="background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem;">{{$flow.DstPort}}</code> is open and the service is running</li>
                                    <li>Review firewall rules that may be blocking the connection</li>
                                    <li>Check for network connectivity issues between client and server</li>
                                </ul>
                                {{else}}
                                <p style="margin: 0; font-size: 0.8125rem; color: #64748b; line-height: 1.6;">
                                    <strong style="color: #b45309;"> Incomplete Handshake:</strong> The connection attempt is still in progress or was captured mid-handshake. 
                                    This may indicate network latency or the capture ended before the handshake completed.
                                </p>
                                {{end}}
                            </div>
                            
                            <!-- Wireshark Filters -->
                            <div style="background: #faf5ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #7c3aed; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-filter"></i>
                                    Wireshark Filters
                                    <span style="font-size: 0.6875rem; color: #a78bfa; font-weight: 400;">(Copy & paste into Wireshark)</span>
                                </h4>
                                <div style="margin-bottom: 12px;">
                                    <label style="display: block; font-size: 0.6875rem; font-weight: 600; color: #8b5cf6; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">
                                        This Flow Only:
                                    </label>
                                    <code style="display: block; padding: 10px 12px; background: #ffffff; border: 1px solid #ddd6fe; border-radius: 6px; font-size: 0.75rem; word-break: break-all; font-family: 'Courier New', monospace; color: #5b21b6;">{{$flow.WiresharkFilter}}</code>
                                </div>
                                <div>
                                    <label style="display: block; font-size: 0.6875rem; font-weight: 600; color: #8b5cf6; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">
                                        Both Directions:
                                    </label>
                                    <code style="display: block; padding: 10px 12px; background: #ffffff; border: 1px solid #ddd6fe; border-radius: 6px; font-size: 0.75rem; word-break: break-all; font-family: 'Courier New', monospace; color: #5b21b6;">{{$flow.WiresharkFilterBidi}}</code>
                                </div>
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .TCPHandshakeFlows) 50}}
                    <div style="text-align: center; padding: 16px; color: #6b7280; font-size: 0.875rem; background: #f9fafb; border-radius: 8px; margin-top: 12px;">
                        <i class="fas fa-info-circle"></i> Showing first 50 of {{len .TCPHandshakeFlows}} TCP handshake flows.
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            
            
            <!-- Performance Metrics Grid -->
            <div class="widget-grid mb-xl">
                <!-- TCP Retransmissions Widget -->
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-redo" style="color: var(--color-warning);"></i>
                            TCP Retransmissions
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl); margin-bottom: var(--space-md);">
                            {{.Stats.TCPRetransmissions}}
                        </div>
                        <p class="text-muted mb-md">Total retransmission events detected</p>
                        {{if gt .Stats.TCPRetransmissions 100}}
                        <div class="status-badge warning">
                            <span class="status-dot"></span>
                            High retransmission rate - investigate network quality
                        </div>
                        {{else}}
                        <div class="status-badge healthy">
                            <span class="status-dot"></span>
                            Normal retransmission rate
                        </div>
                        {{end}}
                    </div>
                </div>
                
                <!-- High RTT Flows Widget -->
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-clock" style="color: var(--color-info);"></i>
                            High Latency Flows
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl); margin-bottom: var(--space-md);">
                            {{.Stats.HighRTTFlows}}
                        </div>
                        <p class="text-muted mb-md">Flows with elevated round-trip time</p>
                        {{if gt .Stats.HighRTTFlows 10}}
                        <div class="status-badge warning">
                            <span class="status-dot"></span>
                            Multiple high-latency connections detected
                        </div>
                        {{else}}
                        <div class="status-badge healthy">
                            <span class="status-dot"></span>
                            Latency within acceptable range
                        </div>
                        {{end}}
                    </div>
                </div>
            </div>
            
            <!-- TCP Retransmissions Detail Table (Collapsible) -->
            {{if gt .Stats.TCPRetransmissions 0}}
            <details>
                <summary><i class="fas fa-redo"></i> Retransmission Details ({{.Stats.TCPRetransmissions}})</summary>
                <div>
                    {{if .TCPRetransmissions}}
                    <table class="data-table" id="retrans-table">
                        <thead>
                            <tr>
                                <th>Source IP:Port</th>
                                <th>Destination IP:Port</th>
                                <th>Count</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range .TCPRetransmissions}}
                            <tr>
                                <td><code>{{.SrcIP}}:{{.SrcPort}}</code></td>
                                <td><code>{{.DstIP}}:{{.DstPort}}</code></td>
                                <td>{{.Count}}</td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                    {{else}}
                    <p class="text-muted">No retransmission details available.</p>
                    {{end}}
                </div>
            </details>
            {{end}}
            
            <!-- High RTT Flows Detail Table -->
            {{if gt .Stats.HighRTTFlows 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-stopwatch card-title-icon"></i>
                        High Latency Flow Details
                    </h3>
                </div>
                <div class="card-body">
                    {{if .HighRTTFlows}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source IP:Port</th>
                                    <th>Destination IP:Port</th>
                                    <th>Average RTT (ms)</th>
                                    <th>Max RTT (ms)</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .HighRTTFlows}}
                                <tr>
                                    <td><code>{{.SrcIP}}:{{.SrcPort}}</code></td>
                                    <td><code>{{.DstIP}}:{{.DstPort}}</code></td>
                                    <td>{{printf "%.2f" .AvgRTT}}</td>
                                    <td>{{printf "%.2f" .MaxRTT}}</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No high RTT flow details available.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             TRAFFIC ANALYSIS SECTION
             ==================================================================== -->
        <section id="traffic" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-exchange-alt" style="color: var(--color-primary);"></i>
                Traffic Analysis
            </h2>
            
            <!-- Top Traffic Flows -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-bar card-title-icon"></i>
                        Top Traffic Flows
                    </h3>
                </div>
                <div class="card-body">
                    {{if .TopFlows}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source IP:Port</th>
                                    <th>Destination IP:Port</th>
                                    <th>Protocol</th>
                                    <th>Total Bytes</th>
                                    <th>Percentage</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .TopFlows}}
                                <tr>
                                    <td><code>{{.SrcIP}}:{{.SrcPort}}</code></td>
                                    <td><code>{{.DstIP}}:{{.DstPort}}</code></td>
                                    <td>{{.Protocol}}</td>
                                    <td>{{.BytesFormatted}}</td>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: var(--space-sm);">
                                            <div style="flex: 1; height: 8px; background: var(--color-border); border-radius: var(--radius-full); overflow: hidden;">
                                                <div style="width: {{printf "%.1f" .Percentage}}%; height: 100%; background: var(--color-primary);"></div>
                                            </div>
                                            <span style="min-width: 50px; text-align: right;">{{printf "%.1f" .Percentage}}%</span>
                                        </div>
                                    </td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No traffic flow data available.</p>
                    {{end}}
                </div>
            </div>
            
            <!-- Protocol Distribution -->
            {{if .ProtocolStats}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-layer-group card-title-icon"></i>
                        Protocol Distribution
                    </h3>
                </div>
                <div class="card-body">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Protocol</th>
                                    <th>Total Bytes</th>
                                    <th>Percentage</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .ProtocolStats}}
                                <tr>
                                    <td><strong>{{.Protocol}}</strong></td>
                                    <td>{{.Bytes}}</td>
                                    <td>{{printf "%.1f" .Percent}}%</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             PROTOCOLS SECTION
             ==================================================================== -->
        <section id="protocols" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-layer-group" style="color: var(--color-primary);"></i>
                Protocol Analysis
            </h2>
            
            <!-- Protocol Overview Widgets -->
            <div class="widget-grid mb-xl">
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-globe"></i>
                            DNS Queries
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl);">{{.Stats.DNSQueries}}</div>
                        <p class="text-muted">Total DNS queries processed</p>
                    </div>
                </div>
                
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-bolt"></i>
                            HTTP/2 Flows
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl);">{{.Stats.HTTP2Flows}}</div>
                        <p class="text-muted">Modern HTTP/2 connections</p>
                    </div>
                </div>
                
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-rocket"></i>
                            QUIC Flows
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl);">{{.Stats.QUICFlows}}</div>
                        <p class="text-muted">QUIC protocol connections</p>
                    </div>
                </div>
            </div>
            
            <!-- DNS Request/Response Analysis - Complete Redesign with Inline Styles -->
            {{if .DNSDetails}}
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-globe"></i>
                        DNS Request/Response Analysis
                        <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{len .DNSDetails}} queries</span>
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Domain Name System queries and responses with timing analysis</p>
                </div>
                
                <!-- Educational Introduction -->
                <div style="background: #ecfdf5; border-bottom: 1px solid #a7f3d0; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #10b981; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #065f46; font-size: 1rem;">What is DNS?</h4>
                            <p style="margin: 0 0 12px 0; color: #047857; font-size: 0.875rem; line-height: 1.6;">
                                DNS (Domain Name System) translates human-readable domain names (like <code style="background: #d1fae5; padding: 2px 6px; border-radius: 4px;">google.com</code>) 
                                into IP addresses that computers use to communicate. Every website visit starts with a DNS query.
                            </p>
                            <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; font-size: 0.8125rem; color: #064e3b;">
                                <span style="background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px;">Query</span>
                                <span></span>
                                <span style="background: #d1fae5; color: #047857; padding: 2px 8px; border-radius: 4px;">Response</span>
                                <span></span>
                                <span style="background: #f0fdf4; color: #166534; padding: 2px 8px; border-radius: 4px; border: 1px solid #86efac;">IP Address Resolved!</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Color-Coded Legend -->
                <div style="background: #fafafa; border-bottom: 1px solid #e5e7eb; padding: 16px 24px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 24px; align-items: center;">
                        <span style="font-weight: 600; color: #374151; font-size: 0.875rem;">Legend:</span>
                        <!-- Query - Blue -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-right" style="color: #3b82f6; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #1e40af; font-weight: 500;">Query</span>
                            <span style="font-size: 0.75rem; color: #64748b;">Client request</span>
                        </div>
                        <!-- Response - Green -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #d1fae5; border: 3px solid #10b981; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-left" style="color: #10b981; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #047857; font-weight: 500;">Response</span>
                            <span style="font-size: 0.75rem; color: #64748b;">Server answer</span>
                        </div>
                        <!-- Error - Red -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #fee2e2; border: 3px solid #ef4444; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-times" style="color: #ef4444; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #b91c1c; font-weight: 500;">Error/Timeout</span>
                            <span style="font-size: 0.75rem; color: #64748b;">No response</span>
                        </div>
                    </div>
                </div>
                
                <!-- DNS Query List -->
                <div style="padding: 16px 24px;">
                    {{range $index, $dns := .DNSDetails}}
                    {{if lt $index 50}}
                    <details style="margin-bottom: 12px; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; {{if $dns.IsAnomalous}}border-color: #fca5a5; background: #fef2f2;{{else if $dns.HasResponse}}border-color: #86efac;{{else}}border-color: #fca5a5;{{end}}">
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; background: {{if $dns.IsAnomalous}}#fef2f2{{else if $dns.HasResponse}}#f0fdf4{{else}}#fef2f2{{end}}; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-globe" style="color: {{if $dns.HasResponse}}#10b981{{else}}#ef4444{{end}};"></i>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$dns.QueryName}}
                                </span>
                                <span style="background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px; font-size: 0.6875rem; font-weight: 600;">{{$dns.QueryType}}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                {{if $dns.HasResponse}}
                                <span style="color: #6b7280; font-size: 0.75rem;">{{$dns.ResponseTimeMs}}</span>
                                <span style="background: #d1fae5; color: #047857; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-check-circle"></i> {{$dns.ResponseCodeName}}
                                </span>
                                {{else}}
                                <span style="background: #fee2e2; color: #b91c1c; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-times-circle"></i> No Response
                                </span>
                                {{end}}
                                {{if $dns.IsAnomalous}}
                                <span style="background: #fef3c7; color: #b45309; padding: 4px 8px; border-radius: 4px; font-size: 0.6875rem; font-weight: 600;">
                                    <i class="fas fa-exclamation-triangle"></i> Anomaly
                                </span>
                                {{end}}
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- DNS Flow Timeline -->
                            <div style="margin-bottom: 20px;">
                                <h4 style="margin: 0 0 16px 0; font-size: 0.9375rem; color: #374151; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-stream" style="color: #10b981;"></i>
                                    DNS Resolution Timeline
                                </h4>
                                
                                <div style="display: flex; flex-direction: column; gap: 0;">
                                    <!-- Query Step -->
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-right" style="color: #3b82f6;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: linear-gradient(to bottom, #3b82f6, {{if $dns.HasResponse}}#10b981{{else}}#ef4444{{end}}); min-height: 20px;"></div>
                                        </div>
                                        <div style="flex: 1; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #1e40af; font-size: 0.875rem;">DNS QUERY</span>
                                                <span style="font-size: 0.75rem; color: #3b82f6; background: white; padding: 2px 8px; border-radius: 4px;">Client  DNS Server</span>
                                            </div>
                                            <p style="margin: 0; color: #1e40af; font-size: 0.8125rem;">
                                                <code style="background: white; padding: 2px 6px; border-radius: 4px;">{{$dns.SourceIP}}</code> queries for 
                                                <code style="background: white; padding: 2px 6px; border-radius: 4px;">{{$dns.QueryName}}</code> (Type: {{$dns.QueryType}})
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <!-- Response Step -->
                                    {{if $dns.HasResponse}}
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #d1fae5; border: 3px solid #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-left" style="color: #10b981;"></i>
                                            </div>
                                        </div>
                                        <div style="flex: 1; background: #d1fae5; border-left: 4px solid #10b981; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #047857; font-size: 0.875rem;">DNS RESPONSE</span>
                                                <span style="font-size: 0.75rem; color: #059669; background: white; padding: 2px 8px; border-radius: 4px;">DNS Server  Client</span>
                                            </div>
                                            <p style="margin: 0; color: #047857; font-size: 0.8125rem;">
                                                Response Code: <strong>{{$dns.ResponseCode}} ({{$dns.ResponseCodeName}})</strong> 
                                                {{if $dns.AnswerIPs}}- Resolved to: <code style="background: white; padding: 2px 6px; border-radius: 4px;">{{$dns.AnswerIPs}}</code>{{end}}
                                                <strong>({{$dns.ResponseTimeMs}})</strong>
                                            </p>
                                        </div>
                                    </div>
                                    {{else}}
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #fee2e2; border: 3px solid #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-times" style="color: #ef4444;"></i>
                                            </div>
                                        </div>
                                        <div style="flex: 1; background: #fee2e2; border-left: 4px solid #ef4444; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #b91c1c; font-size: 0.875rem;">NO RESPONSE</span>
                                                <span style="font-size: 0.75rem; color: #dc2626; background: white; padding: 2px 8px; border-radius: 4px;">Timeout</span>
                                            </div>
                                            <p style="margin: 0; color: #b91c1c; font-size: 0.8125rem;">DNS query did not receive a response from the server</p>
                                        </div>
                                    </div>
                                    {{end}}
                                </div>
                            </div>
                            
                            <!-- Explanation Section -->
                            <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #475569; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-lightbulb" style="color: #eab308;"></i>
                                    What This Means
                                </h4>
                                <p style="margin: 0 0 8px 0; font-size: 0.8125rem; color: #64748b; line-height: 1.6;">
                                    <strong>Query Type:</strong> {{$dns.QueryType}} - 
                                    {{if eq $dns.QueryType "A"}}Looking up the IPv4 address for this domain{{else if eq $dns.QueryType "AAAA"}}Looking up the IPv6 address for this domain{{else if eq $dns.QueryType "CNAME"}}Looking up the canonical (real) name for this alias{{else if eq $dns.QueryType "MX"}}Looking up the mail server for this domain{{else if eq $dns.QueryType "TXT"}}Looking up text records (often used for verification){{else if eq $dns.QueryType "PTR"}}Reverse lookup - finding the domain name for an IP{{else}}Looking up DNS records for this domain{{end}}
                                </p>
                                {{if $dns.HasResponse}}
                                <p style="margin: 0; font-size: 0.8125rem; color: #64748b; line-height: 1.6;">
                                    <strong style="color: #047857;"> Resolution Successful:</strong> The DNS server responded in {{$dns.ResponseTimeMs}}.
                                    {{if $dns.AnswerIPs}}The domain resolves to IP address(es): <code style="background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem;">{{$dns.AnswerIPs}}</code>{{end}}
                                </p>
                                {{else}}
                                <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 6px; padding: 12px; margin-top: 8px;">
                                    <p style="margin: 0; font-size: 0.8125rem; color: #b91c1c; font-weight: 500;">
                                        <i class="fas fa-exclamation-triangle"></i> <strong>Resolution Failed:</strong> No response received from DNS server.
                                    </p>
                                    <p style="margin: 8px 0 0 0; font-size: 0.8125rem; color: #64748b;">
                                        Possible causes: DNS server unreachable, network issues, or the domain doesn't exist.
                                    </p>
                                </div>
                                {{end}}
                                {{if $dns.IsAnomalous}}
                                <div style="background: #fef3c7; border: 1px solid #fcd34d; border-radius: 6px; padding: 12px; margin-top: 12px;">
                                    <p style="margin: 0; font-size: 0.8125rem; color: #b45309; font-weight: 500;">
                                        <i class="fas fa-exclamation-triangle"></i> <strong>Anomaly Detected:</strong> This DNS query shows unusual behavior.
                                    </p>
                                    <p style="margin: 8px 0 0 0; font-size: 0.8125rem; color: #92400e;">
                                        This may indicate DNS tunneling, data exfiltration, or misconfiguration. Investigate further.
                                    </p>
                                </div>
                                {{end}}
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .DNSDetails) 50}}
                    <div style="text-align: center; padding: 16px; color: #6b7280; font-size: 0.875rem; background: #f9fafb; border-radius: 8px; margin-top: 12px;">
                        <i class="fas fa-info-circle"></i> Showing first 50 of {{len .DNSDetails}} DNS queries.
                    </div>
                    {{end}}
                </div>
            </div>
            {{else}}
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden;">
                <div style="text-align: center; padding: 40px; color: #6b7280;">
                    <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 12px; color: #9ca3af;"></i>
                    <p style="margin: 0; font-size: 0.875rem;">No DNS queries recorded in this capture.</p>
                </div>
            </div>
            {{end}}
            
            <!-- HTTP/2 Flow Details -->
            {{if .HTTP2Flows}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-bolt card-title-icon"></i>
                        HTTP/2 Flows ({{len .HTTP2Flows}})
                    </h3>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-md">Modern HTTP/2 connections detected in the capture.</p>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source IP</th>
                                    <th>Source Port</th>
                                    <th>Destination IP</th>
                                    <th>Destination Port</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range $index, $flow := .HTTP2Flows}}
                                {{if lt $index 50}}
                                <tr>
                                    <td><code>{{$flow.SrcIP}}</code></td>
                                    <td>{{$flow.SrcPort}}</td>
                                    <td><code>{{$flow.DstIP}}</code></td>
                                    <td>{{$flow.DstPort}}</td>
                                </tr>
                                {{end}}
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{if gt (len .HTTP2Flows) 50}}
                    <p class="text-muted mt-md"><i class="fas fa-info-circle"></i> Showing first 50 of {{len .HTTP2Flows}} HTTP/2 flows.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            <!-- QUIC Flow Details -->
            {{if .QUICFlows}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-rocket card-title-icon"></i>
                        QUIC Flows ({{len .QUICFlows}})
                    </h3>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-md">QUIC protocol connections (HTTP/3) detected in the capture.</p>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source IP</th>
                                    <th>Source Port</th>
                                    <th>Destination IP</th>
                                    <th>Destination Port</th>
                                    <th>Server Name (SNI)</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range $index, $flow := .QUICFlows}}
                                {{if lt $index 50}}
                                <tr>
                                    <td><code>{{$flow.SrcIP}}</code></td>
                                    <td>{{$flow.SrcPort}}</td>
                                    <td><code>{{$flow.DstIP}}</code></td>
                                    <td>{{$flow.DstPort}}</td>
                                    <td>{{if $flow.ServerName}}<code>{{$flow.ServerName}}</code>{{else}}<span class="text-muted">-</span>{{end}}</td>
                                </tr>
                                {{end}}
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{if gt (len .QUICFlows) 50}}
                    <p class="text-muted mt-md"><i class="fas fa-info-circle"></i> Showing first 50 of {{len .QUICFlows}} QUIC flows.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            {{if .ProtocolGuide}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-book card-title-icon"></i>
                        Protocol Reference Guide
                    </h3>
                </div>
                <div class="card-body">
                    {{.ProtocolGuide}}
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             TUNNELS & SD-WAN SECTION
             ==================================================================== -->
        <section id="tunnels" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-network-wired" style="color: var(--color-primary);"></i>
                Tunnels & SD-WAN Analysis
            </h2>
            
            <!-- Tunnel Detection Card -->
            {{if gt .Stats.TunnelsDetected 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-tunnel card-title-icon"></i>
                        Detected Tunnels ({{.Stats.TunnelsDetected}})
                    </h3>
                </div>
                <div class="card-body">
                    {{if .TunnelFindings}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tunnel Type</th>
                                    <th>Source IP</th>
                                    <th>Destination IP</th>
                                    <th>Encapsulated Protocol</th>
                                    <th>Packet Count</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .TunnelFindings}}
                                <tr>
                                    <td>
                                        <span class="status-badge info">
                                            <span class="status-dot"></span>
                                            {{.Type}}
                                        </span>
                                    </td>
                                    <td><code>{{.OuterSrcIP}}</code></td>
                                    <td><code>{{.OuterDstIP}}</code></td>
                                    <td>{{.InnerProtocol}}</td>
                                    <td>{{.Count}}</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No tunnel details available.</p>
                    {{end}}
                </div>
            </div>
            {{else}}
            <div class="card mb-xl">
                <div class="card-body">
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <i class="fas fa-info-circle" style="font-size: var(--font-size-3xl); margin-bottom: var(--space-md);"></i>
                        <p>No tunnels detected in this capture.</p>
                    </div>
                </div>
            </div>
            {{end}}
            
            <!-- SD-WAN Vendors Card -->
            {{if gt .Stats.SDWANVendors 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-sitemap card-title-icon"></i>
                        SD-WAN Vendors Detected ({{.Stats.SDWANVendors}})
                    </h3>
                </div>
                <div class="card-body">
                    {{if .SDWANVendors}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Vendor</th>
                                    <th>Detected By</th>
                                    <th>Packet Count</th>
                                    <th>Confidence</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .SDWANVendors}}
                                <tr>
                                    <td><strong>{{.Name}}</strong></td>
                                    <td>{{.DetectedBy}}</td>
                                    <td>{{.PacketCount}} packets</td>
                                    <td>
                                        <span class="status-badge {{if eq .Confidence "High"}}healthy{{else}}warning{{end}}">
                                            <span class="status-dot"></span>
                                            {{.Confidence}}
                                        </span>
                                    </td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No SD-WAN vendor details available.</p>
                    {{end}}
                </div>
            </div>
            {{else}}
            <div class="card mb-xl">
                <div class="card-body">
                    <div style="text-align: center; padding: var(--space-xl); color: var(--color-text-muted);">
                        <i class="fas fa-info-circle" style="font-size: var(--font-size-3xl); margin-bottom: var(--space-md);"></i>
                        <p>No SD-WAN vendor signatures detected.</p>
                    </div>
                </div>
            </div>
            {{end}}
            
            <!-- VoIP Analysis Card -->
            {{if gt .Stats.VoIPCalls 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-phone-volume card-title-icon"></i>
                        VoIP Call Analysis ({{.Stats.VoIPCalls}} Calls)
                    </h3>
                </div>
                <div class="card-body">
                    {{if .VoIPAnalysis}}
                    <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-lg); margin-bottom: var(--space-xl);">
                        <div style="text-align: center; padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-lg);">
                            <div style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--color-info); margin-bottom: var(--space-sm);">
                                {{.VoIPAnalysis.TotalCalls}}
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                Total SIP Calls
                            </div>
                        </div>
                        
                        <div style="text-align: center; padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-lg);">
                            <div style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--color-warning); margin-bottom: var(--space-sm);">
                                {{printf "%.2f" .VoIPAnalysis.AvgJitter}} ms
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                Average Jitter
                            </div>
                        </div>
                        
                        <div style="text-align: center; padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-lg);">
                            <div style="font-size: var(--font-size-3xl); font-weight: 700; color: {{if gt .VoIPAnalysis.PacketLoss 5.0}}var(--color-critical){{else}}var(--color-success){{end}}; margin-bottom: var(--space-sm);">
                                {{printf "%.2f" .VoIPAnalysis.PacketLoss}}%
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                Packet Loss
                            </div>
                        </div>
                        
                        <div style="text-align: center; padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-lg);">
                            <div style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--color-info); margin-bottom: var(--space-sm);">
                                {{.VoIPAnalysis.CodecsUsed}}
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                Codecs Detected
                            </div>
                        </div>
                    </div>
                    
                    {{if gt .VoIPAnalysis.PacketLoss 5.0}}
                    <div style="background: rgba(225, 112, 85, 0.1); border-left: 4px solid var(--color-critical); padding: var(--space-lg); border-radius: var(--radius-md);">
                        <h4 style="margin: 0 0 var(--space-sm) 0; color: var(--color-critical);">
                            <i class="fas fa-exclamation-triangle"></i> High Packet Loss Detected
                        </h4>
                        <p style="margin: 0; color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            VoIP packet loss of {{printf "%.2f" .VoIPAnalysis.PacketLoss}}% exceeds acceptable threshold (5%). This may cause poor call quality.
                        </p>
                    </div>
                    {{end}}
                    {{else}}
                    <p class="text-muted">No VoIP analysis details available.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            <!-- GeoIP Summary Card -->
            {{if .GeoLocations}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-globe-americas card-title-icon"></i>
                        Geographic Distribution
                    </h3>
                </div>
                <div class="card-body">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Country</th>
                                    <th>IP Count</th>
                                    <th colspan="2">Details</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .GeoLocations}}
                                <tr>
                                    <td><strong>{{.Country}}</strong></td>
                                    <td>{{.Count}}</td>
                                    <td colspan="2">-</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             VISUALIZATIONS SECTION
             ==================================================================== -->
        <section id="visualizations" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-project-diagram" style="color: var(--color-primary);"></i>
                Network Visualizations
            </h2>
            
            <!-- Network Topology -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-network-wired card-title-icon"></i>
                        Network Topology
                    </h3>
                    <div class="card-actions">
                        <button class="card-action-button" onclick="resetTopology()">
                            <i class="fas fa-sync-alt"></i> Reset
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="network-diagram" class="chart-container" style="min-height: 600px; background: #ffffff; border: 1px solid var(--color-border); border-radius: var(--radius-md); position: relative;"></div>
                </div>
            </div>
            
            <!-- Timeline Visualization -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-timeline card-title-icon"></i>
                        Event Timeline
                    </h3>
                </div>
                <div class="card-body">
                    <div id="timeline" class="chart-container"></div>
                </div>
            </div>
            
            <!-- Sankey Diagram -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-stream card-title-icon"></i>
                        Traffic Flow Diagram
                    </h3>
                </div>
                <div class="card-body">
                    <div id="sankey-diagram" class="chart-container"></div>
                </div>
            </div>
            
            <!-- RTT Histogram -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-bar card-title-icon"></i>
                        RTT Distribution
                    </h3>
                </div>
                <div class="card-body">
                    <div id="rtt-histogram" class="chart-container"></div>
                </div>
            </div>
        </section>
        
        <!-- ====================================================================
             DEVICES SECTION
             ==================================================================== -->
        <section id="devices" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-laptop" style="color: var(--color-primary);"></i>
                Device Fingerprinting
            </h2>
            
            {{if .DeviceFingerprints}}
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-fingerprint card-title-icon"></i>
                        Detected Devices ({{.Stats.DevicesDetected}})
                    </h3>
                </div>
                <div class="card-body">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>IP Address</th>
                                    <th>OS Type</th>
                                    <th>Operating System</th>
                                    <th>Confidence</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .DeviceFingerprints}}
                                <tr>
                                    <td><code>{{.IP}}</code></td>
                                    <td>{{.OSType}}</td>
                                    <td>{{.OSName}}</td>
                                    <td>
                                        <span class="status-badge {{if eq .Confidence "High"}}healthy{{else if eq .Confidence "Medium"}}warning{{else}}unknown{{end}}">
                                            <span class="status-dot"></span>
                                            {{.Confidence}}
                                        </span>
                                    </td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {{else}}
            <div class="card">
                <div class="card-body">
                    <p class="text-muted text-center">No devices fingerprinted.</p>
                </div>
            </div>
            {{end}}
        </section>
        
    </main>
    
    <!-- ========================================================================
         JAVASCRIPT & VISUALIZATIONS
         ======================================================================== -->
    <script>
        // Visualization Data
        const networkData = {{.NetworkDataJSON}};
        const timelineData = {{.TimelineDataJSON}};
        const sankeyData = {{.SankeyDataJSON}};
        const rttHistogramData = {{.RTTHistogramJSON}};
        
        // Navigation handling
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // Show corresponding section
                const section = this.dataset.section;
                document.querySelectorAll('.dashboard-section').forEach(s => s.style.display = 'none');
                document.getElementById(section).style.display = 'block';
                
                // Update breadcrumb
                document.getElementById('currentSection').textContent = this.textContent.trim();
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
        
        // Global search functionality
        document.getElementById('globalSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            // Search through all tables
            document.querySelectorAll('.data-table tbody tr').forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
        
        // Toggle section visibility
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const button = event.target.closest('button');
            const icon = button.querySelector('i');
            
            if (section.style.display === 'none') {
                section.style.display = 'block';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                section.style.display = 'none';
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }
        
        // Export table to CSV
        function exportTableToCSV(tableId, filename) {
            const table = document.getElementById(tableId);
            let csv = [];
            
            // Get headers
            const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent);
            csv.push(headers.join(','));
            
            // Get rows
            table.querySelectorAll('tbody tr').forEach(row => {
                const cells = Array.from(row.querySelectorAll('td')).map(td => {
                    let text = td.textContent.trim();
                    // Escape commas and quotes
                    if (text.includes(',') || text.includes('"')) {
                        text = '"' + text.replace(/"/g, '""') + '"';
                    }
                    return text;
                });
                csv.push(cells.join(','));
            });
            
            // Download
            const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        // Reset topology visualization
        function resetTopology() {
            // This will be implemented with the visualization code
            if (typeof createNetworkDiagram === 'function') {
                const container = document.getElementById('network-diagram');
                container.innerHTML = '';
                createNetworkDiagram(container, networkData);
            }
        }
        
        // TCP Flow Table - Filter by IP address
        function filterTCPFlows(searchText) {
            const table = document.getElementById('tcp-flow-table');
            if (!table) return;
            
            const rows = table.querySelectorAll('tbody tr.tcp-flow-row');
            const search = searchText.toLowerCase().trim();
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }
        
        // TCP Flow Table - Sort by column
        let tcpSortDirection = {};
        function sortTCPTable(columnIndex) {
            const table = document.getElementById('tcp-flow-table');
            if (!table) return;
            
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr.tcp-flow-row'));
            
            // Toggle sort direction
            tcpSortDirection[columnIndex] = !tcpSortDirection[columnIndex];
            const ascending = tcpSortDirection[columnIndex];
            
            rows.sort((a, b) => {
                let aVal = a.cells[columnIndex].textContent.trim();
                let bVal = b.cells[columnIndex].textContent.trim();
                
                // Numeric sort for SYN/SYN-ACK columns
                if (columnIndex === 3 || columnIndex === 4) {
                    aVal = parseInt(aVal) || 0;
                    bVal = parseInt(bVal) || 0;
                    return ascending ? aVal - bVal : bVal - aVal;
                }
                
                // String sort for other columns
                return ascending ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
            });
            
            // Re-append sorted rows
            rows.forEach(row => tbody.appendChild(row));
            
            // Update sort indicators
            const headers = table.querySelectorAll('thead th');
            headers.forEach((th, i) => {
                const icon = th.querySelector('i.fa-sort, i.fa-sort-up, i.fa-sort-down');
                if (icon) {
                    if (i === columnIndex) {
                        icon.className = ascending ? 'fas fa-sort-up' : 'fas fa-sort-down';
                    } else {
                        icon.className = 'fas fa-sort';
                    }
                }
            });
        }
        
        // Copy to clipboard with visual feedback
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const icon = button.querySelector('i');
                const originalClass = icon.className;
                icon.className = 'fas fa-check';
                button.style.background = '#00B894';
                button.style.color = 'white';
                button.style.borderColor = '#00B894';
                
                setTimeout(() => {
                    icon.className = originalClass;
                    button.style.background = '';
                    button.style.color = '';
                    button.style.borderColor = '';
                }, 1500);
            }).catch(err => {
                console.error('Failed to copy:', err);
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            });
        }
        
        // Initialize visualizations when section is shown
        function initializeVisualizations() {
            try {
                if (networkData && networkData.nodes && networkData.nodes.length > 0) {
                    createNetworkDiagram(document.getElementById('network-diagram'), networkData);
                }
                
                if (timelineData && timelineData.length > 0) {
                    createTimeline(document.getElementById('timeline'), timelineData);
                }
                
                if (sankeyData && sankeyData.nodes && sankeyData.nodes.length > 0) {
                    createSankeyDiagram(document.getElementById('sankey-diagram'), sankeyData);
                }
                
                if (rttHistogramData && rttHistogramData.length > 0) {
                    createRTTHistogram(document.getElementById('rtt-histogram'), rttHistogramData);
                }
            } catch (error) {
                console.error('Error initializing visualizations:', error);
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize visualizations after a short delay to ensure DOM is ready
            setTimeout(initializeVisualizations, 100);
        });
    </script>
    
    <!-- Visualization Functions -->
    <script>{{.JS}}</script>
</body>
</html>
