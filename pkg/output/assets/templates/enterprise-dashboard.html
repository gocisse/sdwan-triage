<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SD-WAN Network Triage - {{.FileName}}</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Enterprise Dashboard Styles -->
    <style>{{.CSS}}</style>
</head>
<body>
    <!-- ========================================================================
         TOP NAVIGATION BAR
         ======================================================================== -->
    <header class="dashboard-header">
        <div class="header-container">
            <!-- Top Bar -->
            <div class="header-top">
                <!-- Brand -->
                <div class="header-brand">
                    <div class="brand-logo">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    <div>
                        <h1 class="brand-title">
                            SD-WAN Network Triage
                            <span class="brand-subtitle">v{{.Version}} - Enterprise Dashboard</span>
                        </h1>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="header-actions">
                    <!-- Search -->
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="globalSearch" placeholder="Search IPs, devices, events...">
                    </div>
                    
                    <!-- Export Button -->
                    <button class="header-button" onclick="window.print()">
                        <i class="fas fa-download"></i>
                        <span>Export PDF</span>
                    </button>
                    
                    <!-- Refresh Button -->
                    <button class="header-button primary" onclick="location.reload()">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh</span>
                    </button>
                </div>
            </div>
            
            <!-- Navigation Menu -->
            <nav class="header-nav">
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#dashboard" class="nav-link active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt nav-icon"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#security" class="nav-link" data-section="security">
                            <i class="fas fa-shield-alt nav-icon"></i>
                            <span>Security</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#performance" class="nav-link" data-section="performance">
                            <i class="fas fa-chart-line nav-icon"></i>
                            <span>Performance</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#traffic" class="nav-link" data-section="traffic">
                            <i class="fas fa-exchange-alt nav-icon"></i>
                            <span>Traffic</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#protocols" class="nav-link" data-section="protocols">
                            <i class="fas fa-layer-group nav-icon"></i>
                            <span>Protocols</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#tunnels" class="nav-link" data-section="tunnels">
                            <i class="fas fa-network-wired nav-icon"></i>
                            <span>Tunnels & SD-WAN</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#visualizations" class="nav-link" data-section="visualizations">
                            <i class="fas fa-project-diagram nav-icon"></i>
                            <span>Visualizations</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#devices" class="nav-link" data-section="devices">
                            <i class="fas fa-laptop nav-icon"></i>
                            <span>Devices</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    
    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <ul class="breadcrumb-list">
            <li class="breadcrumb-item">
                <a href="#" class="breadcrumb-link">Home</a>
            </li>
            <li class="breadcrumb-item" id="currentSection">Dashboard</li>
        </ul>
    </div>
    
    <!-- ========================================================================
         MAIN DASHBOARD CONTAINER
         ======================================================================== -->
    <main class="dashboard-container">
        
        <!-- ====================================================================
             EXECUTIVE SUMMARY - KPI TILES
             ==================================================================== -->
        <section id="dashboard" class="dashboard-section">
            <div class="kpi-grid">
                <!-- Network Health KPI -->
                <div class="kpi-card {{if eq .HealthStatus "good"}}success{{else if eq .HealthStatus "warning"}}warning{{else}}critical{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <span class="kpi-badge">
                            {{if eq .HealthStatus "good"}}Healthy{{else if eq .HealthStatus "warning"}}Warning{{else}}Critical{{end}}
                        </span>
                    </div>
                    <div class="kpi-value">{{.HealthStatus | title}}</div>
                    <div class="kpi-label">Network Health Status</div>
                    <div class="kpi-trend">
                        <i class="fas fa-info-circle"></i>
                        <span>Based on {{.TotalFindings}} findings</span>
                    </div>
                </div>
                
                <!-- CRITICAL: Failed Handshakes KPI -->
                <div class="kpi-card {{if gt .TCPHandshakeStats.FailedCount 0}}critical{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-handshake-slash"></i>
                        </div>
                        {{if gt .TCPHandshakeStats.FailedCount 0}}
                        <span class="kpi-badge">!</span>
                        {{end}}
                    </div>
                    <div class="kpi-value">{{.TCPHandshakeStats.FailedCount}}</div>
                    <div class="kpi-label">Failed TCP Handshakes</div>
                    <div class="kpi-trend {{if gt .TCPHandshakeStats.FailedCount 0}}down{{end}}">
                        {{if gt .TCPHandshakeStats.FailedCount 0}}
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Unreachable services or firewall blocks</span>
                        {{else}}
                        <i class="fas fa-check-circle"></i>
                        <span>All connections successful</span>
                        {{end}}
                    </div>
                </div>
                
                <!-- Security Threats KPI -->
                <div class="kpi-card {{if gt .Stats.DDoSAttacks 0}}critical{{else if or (gt .Stats.PortScans 0) (gt .Stats.IOCMatches 0)}}warning{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        {{if or (gt .Stats.DDoSAttacks 0) (gt .Stats.PortScans 0) (gt .Stats.IOCMatches 0) (gt .Stats.BGPIndicators 0)}}
                        <span class="kpi-badge">!</span>
                        {{end}}
                    </div>
                    <div class="kpi-value">{{add .Stats.DDoSAttacks .Stats.PortScans .Stats.IOCMatches}}</div>
                    <div class="kpi-label">Security Threats</div>
                    <div class="kpi-trend">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>DDoS: {{.Stats.DDoSAttacks}} | Scans: {{.Stats.PortScans}} | IOCs: {{.Stats.IOCMatches}} | BGP: {{.Stats.BGPIndicators}}</span>
                    </div>
                </div>
                
                <!-- Performance Issues KPI -->
                <div class="kpi-card {{if gt .Stats.TCPRetransmissions 100}}warning{{else if gt .Stats.HighRTTFlows 10}}warning{{else}}info{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.TCPRetransmissions}}</div>
                    <div class="kpi-label">TCP Retransmissions</div>
                    <div class="kpi-trend">
                        <i class="fas fa-clock"></i>
                        <span>High RTT: {{.Stats.HighRTTFlows}} | HTTP Errors: {{.Stats.HTTPErrors}}</span>
                    </div>
                </div>
                
                <!-- Tunnels & Encapsulation KPI -->
                <div class="kpi-card {{if gt .Stats.TunnelsDetected 0}}info{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-network-wired"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.TunnelsDetected}}</div>
                    <div class="kpi-label">Tunnels Detected</div>
                    <div class="kpi-trend">
                        <i class="fas fa-info-circle"></i>
                        <span>VXLAN, GRE, IPsec, etc.</span>
                    </div>
                </div>
                
                <!-- SD-WAN Vendors KPI -->
                <div class="kpi-card {{if gt .Stats.SDWANVendors 0}}info{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-sitemap"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.SDWANVendors}}</div>
                    <div class="kpi-label">SD-WAN Vendors</div>
                    <div class="kpi-trend">
                        <i class="fas fa-fingerprint"></i>
                        <span>Detected vendor signatures</span>
                    </div>
                </div>
                
                <!-- VoIP Calls KPI -->
                <div class="kpi-card {{if gt .Stats.VoIPCalls 0}}info{{else}}success{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-phone-volume"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.VoIPCalls}}</div>
                    <div class="kpi-label">VoIP Calls</div>
                    <div class="kpi-trend">
                        <i class="fas fa-info-circle"></i>
                        <span>SIP/RTP sessions detected</span>
                    </div>
                </div>
                
                <!-- DNS Queries KPI -->
                <div class="kpi-card {{if gt .Stats.DNSAnomalies 0}}warning{{else}}info{{end}}">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.DNSQueries}}</div>
                    <div class="kpi-label">DNS Queries</div>
                    <div class="kpi-trend {{if gt .Stats.DNSAnomalies 0}}down{{end}}">
                        {{if gt .Stats.DNSAnomalies 0}}
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>{{.Stats.DNSAnomalies}} anomalies detected</span>
                        {{else}}
                        <i class="fas fa-check-circle"></i>
                        <span>No anomalies detected</span>
                        {{end}}
                    </div>
                </div>
                
                <!-- Devices Detected KPI -->
                <div class="kpi-card success">
                    <div class="kpi-header">
                        <div class="kpi-icon">
                            <i class="fas fa-laptop"></i>
                        </div>
                    </div>
                    <div class="kpi-value">{{.Stats.DevicesDetected}}</div>
                    <div class="kpi-label">Devices Identified</div>
                    <div class="kpi-trend">
                        <i class="fas fa-fingerprint"></i>
                        <span>ARP Conflicts: {{.Stats.ARPConflicts}}</span>
                    </div>
                </div>
            </div>
            
            <!-- ================================================================
                 EXECUTIVE SUMMARY CARD
                 ================================================================ -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-clipboard-list card-title-icon"></i>
                        Executive Summary
                    </h2>
                    <div class="card-actions">
                        <button class="card-action-button" onclick="toggleSection('executive-summary')">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body" id="executive-summary">
                    <div class="dashboard-grid" style="grid-template-columns: 2fr 1fr; gap: var(--space-xl);">
                        <!-- Summary Content -->
                        <div>
                            <h3 class="mb-md">Analysis Overview</h3>
                            <p class="text-muted mb-lg">
                                Analyzed <strong>{{.FileName}}</strong> containing <strong>{{.PacketCount}} packets</strong> 
                                on <strong>{{.GeneratedAt}}</strong>.
                            </p>
                            
                            {{if .ExecutiveSummaryExplanation}}
                            <div class="mb-lg">
                                {{.ExecutiveSummaryExplanation}}
                            </div>
                            {{end}}
                            
                            <!-- Key Findings -->
                            <h4 class="mb-md">Key Findings</h4>
                            <div class="d-grid gap-md mb-lg">
                                {{if gt .Stats.DDoSAttacks 0}}
                                <div class="status-badge critical">
                                    <span class="status-dot"></span>
                                    <span>{{.Stats.DDoSAttacks}} DDoS Attack(s) Detected</span>
                                </div>
                                {{end}}
                                
                                {{if gt .Stats.PortScans 0}}
                                <div class="status-badge warning">
                                    <span class="status-dot"></span>
                                    <span>{{.Stats.PortScans}} Port Scan(s) Detected</span>
                                </div>
                                {{end}}
                                
                                {{if gt .Stats.TCPRetransmissions 100}}
                                <div class="status-badge warning">
                                    <span class="status-dot"></span>
                                    <span>High TCP Retransmission Rate ({{.Stats.TCPRetransmissions}})</span>
                                </div>
                                {{end}}
                                
                                {{if gt .Stats.DNSAnomalies 0}}
                                <div class="status-badge warning">
                                    <span class="status-dot"></span>
                                    <span>{{.Stats.DNSAnomalies}} DNS Anomalies Found</span>
                                </div>
                                {{end}}
                                
                                {{if and (eq .Stats.DDoSAttacks 0) (eq .Stats.PortScans 0) (lt .Stats.TCPRetransmissions 100)}}
                                <div class="status-badge healthy">
                                    <span class="status-dot"></span>
                                    <span>No Critical Issues Detected</span>
                                </div>
                                {{end}}
                            </div>
                        </div>
                        
                        <!-- Risk Assessment -->
                        <div>
                            <div class="card" style="background: var(--color-surface); border: none;">
                                <div class="card-body">
                                    <h4 class="mb-md">Risk Assessment</h4>
                                    <div class="text-center mb-lg">
                                        <div class="kpi-value" style="font-size: var(--font-size-4xl); color: {{if eq .RiskLevel "low"}}var(--color-success){{else if eq .RiskLevel "medium"}}var(--color-warning){{else}}var(--color-critical){{end}};">
                                            {{.RiskScore}}
                                        </div>
                                        <div class="kpi-label">Risk Score</div>
                                        <span class="status-badge {{if eq .RiskLevel "low"}}healthy{{else if eq .RiskLevel "medium"}}warning{{else}}critical{{end}}">
                                            <span class="status-dot"></span>
                                            {{.RiskLevel | title}} Risk
                                        </span>
                                    </div>
                                    
                                    {{if .RecommendedActions}}
                                    <h5 class="mb-sm">Recommended Actions</h5>
                                    <ul style="padding-left: var(--space-lg); margin: 0; font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                        {{range .RecommendedActions}}
                                        <li style="margin-bottom: var(--space-sm);">{{.}}</li>
                                        {{end}}
                                    </ul>
                                    {{end}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <i class="fas fa-clock"></i> Last updated: {{.GeneratedAt}}
                </div>
            </div>
        </section>
        
        <!-- ====================================================================
             SECURITY ANALYSIS SECTION
             ==================================================================== -->
        <section id="security" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-shield-alt" style="color: var(--color-primary);"></i>
                Security Analysis
            </h2>
            
            <!-- Security Overview Widget Grid -->
            <div class="widget-grid mb-xl">
                <!-- DDoS Attacks Widget -->
                {{if gt .Stats.DDoSAttacks 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-bomb" style="color: var(--color-critical);"></i>
                            DDoS Attacks ({{.Stats.DDoSAttacks}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .DDoSFindings}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Source IP</th>
                                        <th>Target IP</th>
                                        <th>Packet Count</th>
                                        <th>Severity</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .DDoSFindings}}
                                    <tr>
                                        <td><code>{{.Type}}</code></td>
                                        <td><code>{{.SourceIP}}</code></td>
                                        <td><code>{{.TargetIP}}</code></td>
                                        <td>{{.PacketCount}}</td>
                                        <td>
                                            <span class="status-badge critical">
                                                <span class="status-dot"></span>
                                                High
                                            </span>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No DDoS attacks detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- Port Scans Widget -->
                {{if gt .Stats.PortScans 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-search" style="color: var(--color-warning);"></i>
                            Port Scans ({{.Stats.PortScans}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .PortScanFindings}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Source IP</th>
                                        <th>Target IP</th>
                                        <th>Ports Scanned</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .PortScanFindings}}
                                    <tr>
                                        <td><code>{{.Type}}</code></td>
                                        <td><code>{{.SourceIP}}</code></td>
                                        <td><code>{{.TargetIP}}</code></td>
                                        <td>{{.PortsScanned}}</td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No port scans detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- IOC Matches Widget -->
                {{if gt .Stats.IOCMatches 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-crosshairs" style="color: var(--color-critical);"></i>
                            IOC Matches ({{.Stats.IOCMatches}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .IOCFindings}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Matched Value</th>
                                        <th>Type</th>
                                        <th>Source IP</th>
                                        <th>Confidence</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .IOCFindings}}
                                    <tr>
                                        <td><code>{{.MatchedValue}}</code></td>
                                        <td>{{.IOCType}}</td>
                                        <td><code>{{.SourceIP}}</code></td>
                                        <td>
                                            <span class="status-badge {{if eq .Confidence "High"}}critical{{else}}warning{{end}}">
                                                <span class="status-dot"></span>
                                                {{.Confidence}}
                                            </span>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No IOC matches detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- BGP Indicators Widget -->
                {{if gt .Stats.BGPIndicators 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-route" style="color: var(--color-warning);"></i>
                            BGP Hijack Indicators ({{.Stats.BGPIndicators}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .BGPIndicators}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>IP Address</th>
                                        <th>Expected ASN</th>
                                        <th>Observed ASN</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .BGPIndicators}}
                                    <tr>
                                        <td><code>{{.IPAddress}}</code></td>
                                        <td>AS{{.ExpectedASN}} ({{.ExpectedASName}})</td>
                                        <td>AS{{.ObservedASN}} ({{.ObservedASName}})</td>
                                        <td>
                                            <span class="status-badge {{if .IsAnomaly}}critical{{else}}warning{{end}}">
                                                <span class="status-dot"></span>
                                                {{if .IsAnomaly}}Anomaly{{else}}Suspicious{{end}}
                                            </span>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No BGP indicators detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- TLS Security Issues Widget -->
                {{if gt .Stats.TLSWeaknesses 0}}
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-lock-open" style="color: var(--color-warning);"></i>
                            TLS Security Issues ({{.Stats.TLSWeaknesses}})
                        </h3>
                    </div>
                    <div class="widget-body">
                        {{if .TLSSecurityFindings}}
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Server IP</th>
                                        <th>Issue Type</th>
                                        <th>Details</th>
                                        <th>Severity</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{range .TLSSecurityFindings}}
                                    <tr>
                                        <td><code>{{.ServerIP}}</code></td>
                                        <td>{{.IssueType}}</td>
                                        <td>{{.Details}}</td>
                                        <td>
                                            <span class="status-badge {{if eq .Severity "High"}}critical{{else}}warning{{end}}">
                                                <span class="status-dot"></span>
                                                {{.Severity}}
                                            </span>
                                        </td>
                                    </tr>
                                    {{end}}
                                </tbody>
                            </table>
                        </div>
                        {{else}}
                        <p class="text-muted">No TLS security issues detected.</p>
                        {{end}}
                    </div>
                </div>
                {{end}}
            </div>
            
            <!-- DNS Anomalies Card -->
            {{if gt .Stats.DNSAnomalies 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-exclamation-triangle card-title-icon"></i>
                        DNS Anomalies ({{.Stats.DNSAnomalies}})
                    </h3>
                </div>
                <div class="card-body">
                    {{if .DNSAnomalies}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Query</th>
                                    <th>Answer IP</th>
                                    <th>Server IP</th>
                                    <th>Reason</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .DNSAnomalies}}
                                <tr>
                                    <td><code>{{.Query}}</code></td>
                                    <td><code>{{.AnswerIP}}</code></td>
                                    <td><code>{{.ServerIP}}</code></td>
                                    <td>{{.Reason}}</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No DNS anomalies detected.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            <!-- TLS Security Findings -->
            {{if gt .Stats.TLSWeaknesses 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-lock-open card-title-icon"></i>
                        TLS Security Issues ({{.Stats.TLSWeaknesses}})
                    </h3>
                </div>
                <div class="card-body">
                    {{if .TLSSecurityFindings}}
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Server IP</th>
                                    <th>Issue Type</th>
                                    <th>Details</th>
                                    <th>Severity</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .TLSSecurityFindings}}
                                <tr>
                                    <td><code>{{.ServerIP}}</code></td>
                                    <td>{{.IssueType}}</td>
                                    <td>{{.Details}}</td>
                                    <td>
                                        <span class="status-badge {{if eq .Severity "High"}}critical{{else}}warning{{end}}">
                                            <span class="status-dot"></span>
                                            {{.Severity}}
                                        </span>
                                    </td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">No TLS security issues detected.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             PERFORMANCE ANALYSIS SECTION
             ==================================================================== -->
        <section id="performance" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-chart-line" style="color: var(--color-primary);"></i>
                Performance Analysis
            </h2>
            
            <!-- TCP Handshake Analysis Card (CRITICAL) -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-handshake card-title-icon"></i>
                        TCP Connection Analysis - Per-Flow Breakdown
                    </h3>
                    <div class="card-actions">
                        <span class="status-badge {{if gt .TCPHandshakeStats.FailedCount 0}}critical{{else}}healthy{{end}}">
                            <span class="status-dot"></span>
                            {{.TCPHandshakeStats.SuccessfulCount}} Success / {{.TCPHandshakeStats.FailedCount}} Failed
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Summary Stats Row -->
                    <div class="dashboard-grid" style="grid-template-columns: repeat(4, 1fr); gap: var(--space-md); margin-bottom: var(--space-xl);">
                        <div style="text-align: center; padding: var(--space-md); background: var(--color-surface); border-radius: var(--radius-md); border-left: 4px solid var(--color-info);">
                            <div style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--color-info);">{{.TCPHandshakeStats.TotalSYN}}</div>
                            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Total SYN</div>
                        </div>
                        <div style="text-align: center; padding: var(--space-md); background: var(--color-surface); border-radius: var(--radius-md); border-left: 4px solid var(--color-success);">
                            <div style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--color-success);">{{.TCPHandshakeStats.TotalSYNACK}}</div>
                            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Total SYN-ACK</div>
                        </div>
                        <div style="text-align: center; padding: var(--space-md); background: var(--color-surface); border-radius: var(--radius-md); border-left: 4px solid var(--color-success);">
                            <div style="font-size: var(--font-size-2xl); font-weight: 700; color: var(--color-success);">{{.TCPHandshakeStats.SuccessfulCount}}</div>
                            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Successful</div>
                        </div>
                        <div style="text-align: center; padding: var(--space-md); background: {{if gt .TCPHandshakeStats.FailedCount 0}}rgba(225, 112, 85, 0.1){{else}}var(--color-surface){{end}}; border-radius: var(--radius-md); border-left: 4px solid {{if gt .TCPHandshakeStats.FailedCount 0}}var(--color-critical){{else}}var(--color-success){{end}};">
                            <div style="font-size: var(--font-size-2xl); font-weight: 700; color: {{if gt .TCPHandshakeStats.FailedCount 0}}var(--color-critical){{else}}var(--color-success){{end}};">{{.TCPHandshakeStats.FailedCount}}</div>
                            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Failed</div>
                        </div>
                    </div>
                    
                    {{if gt .TCPHandshakeStats.FailedCount 0}}
                    <div style="background: rgba(225, 112, 85, 0.1); border-left: 4px solid var(--color-critical); padding: var(--space-lg); border-radius: var(--radius-md); margin-top: var(--space-lg);">
                        <h4 style="margin: 0 0 var(--space-sm) 0; color: var(--color-critical);">
                            <i class="fas fa-exclamation-circle"></i> Failed Handshake Analysis
                        </h4>
                        <p style="margin: 0 0 var(--space-md) 0; color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            <strong>{{.TCPHandshakeStats.FailedCount}}</strong> connection attempts failed to complete the TCP handshake. 
                            This typically indicates:
                        </p>
                        <ul style="margin: 0; padding-left: var(--space-xl); color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            <li>Services are unreachable or down</li>
                            <li>Firewall blocking connections</li>
                            <li>Network routing issues</li>
                            <li>Server overload or resource exhaustion</li>
                        </ul>
                    </div>
                    
                    {{if .FailedHandshakes}}
                    <h4 class="mb-md">Failed Handshake Details (Top 10)</h4>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source IP:Port</th>
                                    <th>Destination IP:Port</th>
                                    <th>Timestamp</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range $index, $flow := .FailedHandshakes}}
                                {{if lt $index 10}}
                                <tr>
                                    <td><code>{{$flow.SrcIP}}:{{$flow.SrcPort}}</code></td>
                                    <td><code>{{$flow.DstIP}}:{{$flow.DstPort}}</code></td>
                                    <td>{{formatUnixTimeShort $flow.Timestamp}}</td>
                                    <td>
                                        <span class="status-badge critical">
                                            <span class="status-dot"></span>
                                            No Response
                                        </span>
                                    </td>
                                </tr>
                                {{end}}
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{end}}
                    {{else}}
                    <div style="background: rgba(0, 184, 148, 0.1); border-left: 4px solid var(--color-success); padding: var(--space-lg); border-radius: var(--radius-md);">
                        <h4 style="margin: 0 0 var(--space-sm) 0; color: var(--color-success);">
                            <i class="fas fa-check-circle"></i> All Connections Successful
                        </h4>
                        <p style="margin: 0; color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            All TCP connection attempts successfully completed the three-way handshake. No unreachable services detected.
                        </p>
                    </div>
                    {{end}}
                </div>
            </div>
            
            <!-- TCP Handshake Analysis - Complete Redesign with Inline Styles -->
            {{if .TCPHandshakeFlows}}
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-exchange-alt"></i>
                        TCP Handshake Analysis
                        <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{len .TCPHandshakeFlows}} flows</span>
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Three-way handshake analysis showing connection establishment between clients and servers</p>
                </div>
                
                <!-- Educational Introduction for Junior Engineers -->
                <div style="background: #f0f9ff; border-bottom: 1px solid #bae6fd; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #0ea5e9; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #0c4a6e; font-size: 1rem;">What is a TCP Handshake?</h4>
                            <p style="margin: 0 0 12px 0; color: #475569; font-size: 0.875rem; line-height: 1.6;">
                                Before two computers can exchange data over TCP, they must establish a connection using a <strong>three-way handshake</strong>. 
                                This ensures both sides are ready to communicate and agree on initial sequence numbers.
                            </p>
                            <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; font-size: 0.8125rem; color: #64748b;">
                                <span style="background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px;">Step 1: SYN</span>
                                <span>→</span>
                                <span style="background: #ffedd5; color: #c2410c; padding: 2px 8px; border-radius: 4px;">Step 2: SYN-ACK</span>
                                <span>→</span>
                                <span style="background: #d1fae5; color: #047857; padding: 2px 8px; border-radius: 4px;">Step 3: ACK</span>
                                <span>→</span>
                                <span style="background: #f0fdf4; color: #166534; padding: 2px 8px; border-radius: 4px; border: 1px solid #86efac;">Connection Ready!</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Color-Coded Legend -->
                <div style="background: #fafafa; border-bottom: 1px solid #e5e7eb; padding: 16px 24px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 24px; align-items: center;">
                        <span style="font-weight: 600; color: #374151; font-size: 0.875rem;">Legend:</span>
                        <!-- SYN - Blue -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-right" style="color: #3b82f6; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #1e40af; font-weight: 500;">SYN</span>
                            <span style="font-size: 0.75rem; color: #64748b;">Client initiates</span>
                        </div>
                        <!-- SYN-ACK - Orange -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #ffedd5; border: 3px solid #f97316; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-left" style="color: #f97316; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #c2410c; font-weight: 500;">SYN-ACK</span>
                            <span style="font-size: 0.75rem; color: #64748b;">Server responds</span>
                        </div>
                        <!-- Complete - Green -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #d1fae5; border: 3px solid #10b981; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="color: #10b981; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #047857; font-weight: 500;">Complete</span>
                            <span style="font-size: 0.75rem; color: #64748b;">Handshake successful</span>
                        </div>
                        <!-- Failed - Red -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #fee2e2; border: 3px solid #ef4444; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-times" style="color: #ef4444; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #b91c1c; font-weight: 500;">Failed</span>
                            <span style="font-size: 0.75rem; color: #64748b;">Handshake failed</span>
                        </div>
                    </div>
                </div>
                
                <!-- Flow List -->
                <div style="padding: 16px 24px;">
                    {{range $index, $flow := .TCPHandshakeFlows}}
                    {{if lt $index 50}}
                    <details style="margin-bottom: 12px; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; {{if eq $flow.StateColor "danger"}}border-color: #fca5a5; background: #fef2f2;{{else if eq $flow.StateColor "success"}}border-color: #86efac;{{end}}">
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; background: {{if eq $flow.StateColor "success"}}#f0fdf4{{else if eq $flow.StateColor "danger"}}#fef2f2{{else if eq $flow.StateColor "warning"}}#fffbeb{{else}}#f8fafc{{end}}; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-network-wired" style="color: {{if eq $flow.StateColor "success"}}#10b981{{else if eq $flow.StateColor "danger"}}#ef4444{{else if eq $flow.StateColor "warning"}}#f59e0b{{else}}#3b82f6{{end}};"></i>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$flow.SrcIP}}:{{$flow.SrcPort}}
                                </span>
                                <span style="color: #9ca3af; font-weight: bold;">→</span>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$flow.DstIP}}:{{$flow.DstPort}}
                                </span>
                                {{if $flow.IsIPv6}}<span style="background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px; font-size: 0.6875rem; font-weight: 600;">IPv6</span>{{end}}
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                {{if ne $flow.TotalHandshakeMs 0.0}}
                                <span style="color: #6b7280; font-size: 0.75rem;">{{printf "%.2f" $flow.TotalHandshakeMs}} ms</span>
                                {{end}}
                                {{if eq $flow.StateColor "success"}}
                                <span style="background: #d1fae5; color: #047857; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-check-circle"></i> Complete
                                </span>
                                {{else if eq $flow.StateColor "danger"}}
                                <span style="background: #fee2e2; color: #b91c1c; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-times-circle"></i> Failed
                                </span>
                                {{else if eq $flow.StateColor "warning"}}
                                <span style="background: #fef3c7; color: #b45309; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-clock"></i> Pending
                                </span>
                                {{else}}
                                <span style="background: #dbeafe; color: #1e40af; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-hourglass-half"></i> {{$flow.State}}
                                </span>
                                {{end}}
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- Visual Flow Timeline -->
                            <div style="margin-bottom: 20px;">
                                <h4 style="margin: 0 0 16px 0; font-size: 0.9375rem; color: #374151; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-stream" style="color: #6366f1;"></i>
                                    Handshake Timeline
                                </h4>
                                
                                {{if eq $flow.StateColor "success"}}
                                <!-- Successful Handshake - All 3 Steps -->
                                <div style="display: flex; flex-direction: column; gap: 0;">
                                    <!-- Step 1: SYN -->
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-right" style="color: #3b82f6;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: linear-gradient(to bottom, #3b82f6, #f97316); min-height: 20px;"></div>
                                        </div>
                                        <div style="flex: 1; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #1e40af; font-size: 0.875rem;">1. SYN</span>
                                                <span style="font-size: 0.75rem; color: #3b82f6; background: white; padding: 2px 8px; border-radius: 4px;">Client → Server</span>
                                            </div>
                                            <p style="margin: 0; color: #1e40af; font-size: 0.8125rem;">Client requests connection to server</p>
                                        </div>
                                    </div>
                                    <!-- Step 2: SYN-ACK -->
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #ffedd5; border: 3px solid #f97316; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-left" style="color: #f97316;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: linear-gradient(to bottom, #f97316, #10b981); min-height: 20px;"></div>
                                        </div>
                                        <div style="flex: 1; background: #ffedd5; border-left: 4px solid #f97316; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #c2410c; font-size: 0.875rem;">2. SYN-ACK</span>
                                                <span style="font-size: 0.75rem; color: #ea580c; background: white; padding: 2px 8px; border-radius: 4px;">Server → Client</span>
                                            </div>
                                            <p style="margin: 0; color: #c2410c; font-size: 0.8125rem;">Server acknowledges and accepts connection</p>
                                        </div>
                                    </div>
                                    <!-- Step 3: ACK (Complete) -->
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #d1fae5; border: 3px solid #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-check" style="color: #10b981;"></i>
                                            </div>
                                        </div>
                                        <div style="flex: 1; background: #d1fae5; border-left: 4px solid #10b981; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #047857; font-size: 0.875rem;">3. ACK (Complete)</span>
                                                <span style="font-size: 0.75rem; color: #059669; background: white; padding: 2px 8px; border-radius: 4px;">Client → Server</span>
                                            </div>
                                            <p style="margin: 0; color: #047857; font-size: 0.8125rem;">Client confirms. Connection established! {{if ne $flow.TotalHandshakeMs 0.0}}<strong>({{printf "%.2f" $flow.TotalHandshakeMs}} ms total)</strong>{{end}}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                {{else if eq $flow.StateColor "danger"}}
                                <!-- Failed Handshake -->
                                <div style="display: flex; flex-direction: column; gap: 0;">
                                    <!-- Step 1: SYN -->
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-right" style="color: #3b82f6;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: linear-gradient(to bottom, #3b82f6, #ef4444); min-height: 20px;"></div>
                                        </div>
                                        <div style="flex: 1; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #1e40af; font-size: 0.875rem;">1. SYN</span>
                                                <span style="font-size: 0.75rem; color: #3b82f6; background: white; padding: 2px 8px; border-radius: 4px;">Client → Server</span>
                                            </div>
                                            <p style="margin: 0; color: #1e40af; font-size: 0.8125rem;">Client attempted to connect</p>
                                        </div>
                                    </div>
                                    <!-- Failed Step -->
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #fee2e2; border: 3px solid #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-times" style="color: #ef4444;"></i>
                                            </div>
                                        </div>
                                        <div style="flex: 1; background: #fee2e2; border-left: 4px solid #ef4444; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #b91c1c; font-size: 0.875rem;">FAILED</span>
                                                <span style="font-size: 0.75rem; color: #dc2626; background: white; padding: 2px 8px; border-radius: 4px;">Connection Failed</span>
                                            </div>
                                            <p style="margin: 0; color: #b91c1c; font-size: 0.8125rem;">{{if $flow.FailureReason}}{{$flow.FailureReason}}{{else}}Handshake did not complete{{end}}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                {{else if eq $flow.StateColor "warning"}}
                                <!-- Pending (SYN-ACK received, waiting for ACK) -->
                                <div style="display: flex; flex-direction: column; gap: 0;">
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-right" style="color: #3b82f6;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: linear-gradient(to bottom, #3b82f6, #f97316); min-height: 20px;"></div>
                                        </div>
                                        <div style="flex: 1; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <span style="font-weight: 700; color: #1e40af; font-size: 0.875rem;">1. SYN</span>
                                            <p style="margin: 4px 0 0 0; color: #1e40af; font-size: 0.8125rem;">Client initiated connection</p>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #ffedd5; border: 3px solid #f97316; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-left" style="color: #f97316;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: #d1d5db; min-height: 20px; border-left: 2px dashed #9ca3af;"></div>
                                        </div>
                                        <div style="flex: 1; background: #ffedd5; border-left: 4px solid #f97316; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <span style="font-weight: 700; color: #c2410c; font-size: 0.875rem;">2. SYN-ACK</span>
                                            <p style="margin: 4px 0 0 0; color: #c2410c; font-size: 0.8125rem;">Server acknowledged</p>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #f3f4f6; border: 3px dashed #9ca3af; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-clock" style="color: #9ca3af;"></i>
                                            </div>
                                        </div>
                                        <div style="flex: 1; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                                            <span style="font-weight: 700; color: #b45309; font-size: 0.875rem;">3. ACK (Waiting...)</span>
                                            <p style="margin: 4px 0 0 0; color: #b45309; font-size: 0.8125rem;">Waiting for client to complete handshake</p>
                                        </div>
                                    </div>
                                </div>
                                
                                {{else}}
                                <!-- SYN Sent (waiting for SYN-ACK) -->
                                <div style="display: flex; flex-direction: column; gap: 0;">
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-right" style="color: #3b82f6;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: #d1d5db; min-height: 20px; border-left: 2px dashed #9ca3af;"></div>
                                        </div>
                                        <div style="flex: 1; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <span style="font-weight: 700; color: #1e40af; font-size: 0.875rem;">1. SYN</span>
                                            <p style="margin: 4px 0 0 0; color: #1e40af; font-size: 0.8125rem;">Client initiated connection</p>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #f3f4f6; border: 3px dashed #9ca3af; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-clock" style="color: #9ca3af;"></i>
                                            </div>
                                        </div>
                                        <div style="flex: 1; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                                            <span style="font-weight: 700; color: #b45309; font-size: 0.875rem;">2. SYN-ACK (Waiting...)</span>
                                            <p style="margin: 4px 0 0 0; color: #b45309; font-size: 0.8125rem;">Waiting for server response</p>
                                        </div>
                                    </div>
                                </div>
                                {{end}}
                            </div>
                            
                            <!-- Explanation Section -->
                            <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #475569; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-lightbulb" style="color: #eab308;"></i>
                                    What This Means
                                </h4>
                                {{if eq $flow.StateColor "success"}}
                                <p style="margin: 0 0 8px 0; font-size: 0.8125rem; color: #64748b; line-height: 1.6;">
                                    <strong style="color: #047857;">✓ Successful Connection:</strong> The client at <code style="background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem;">{{$flow.SrcIP}}</code> 
                                    successfully established a TCP connection to the server at <code style="background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem;">{{$flow.DstIP}}:{{$flow.DstPort}}</code>.
                                </p>
                                <p style="margin: 0; font-size: 0.8125rem; color: #64748b; line-height: 1.6;">
                                    The three-way handshake completed normally, and data transfer can now occur over this connection.
                                </p>
                                {{else if eq $flow.StateColor "danger"}}
                                <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 6px; padding: 12px; margin-bottom: 12px;">
                                    <p style="margin: 0; font-size: 0.8125rem; color: #b91c1c; font-weight: 500;">
                                        <i class="fas fa-exclamation-triangle"></i> <strong>Connection Failed:</strong> {{if $flow.FailureReason}}{{$flow.FailureReason}}{{else}}The handshake did not complete.{{end}}
                                    </p>
                                </div>
                                <p style="margin: 0 0 8px 0; font-size: 0.8125rem; color: #64748b; line-height: 1.6;">
                                    <strong>Troubleshooting Steps:</strong>
                                </p>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #64748b; line-height: 1.8;">
                                    <li>Verify the server at <code style="background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem;">{{$flow.DstIP}}</code> is reachable</li>
                                    <li>Check if port <code style="background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem;">{{$flow.DstPort}}</code> is open and the service is running</li>
                                    <li>Review firewall rules that may be blocking the connection</li>
                                    <li>Check for network connectivity issues between client and server</li>
                                </ul>
                                {{else}}
                                <p style="margin: 0; font-size: 0.8125rem; color: #64748b; line-height: 1.6;">
                                    <strong style="color: #b45309;">⏳ Incomplete Handshake:</strong> The connection attempt is still in progress or was captured mid-handshake. 
                                    This may indicate network latency or the capture ended before the handshake completed.
                                </p>
                                {{end}}
                            </div>
                            
                            <!-- Wireshark Filters -->
                            <div style="background: #faf5ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #7c3aed; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-filter"></i>
                                    Wireshark Filters
                                    <span style="font-size: 0.6875rem; color: #a78bfa; font-weight: 400;">(Copy & paste into Wireshark)</span>
                                </h4>
                                <div style="margin-bottom: 12px;">
                                    <label style="display: block; font-size: 0.6875rem; font-weight: 600; color: #8b5cf6; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">
                                        This Flow Only:
                                    </label>
                                    <code style="display: block; padding: 10px 12px; background: #ffffff; border: 1px solid #ddd6fe; border-radius: 6px; font-size: 0.75rem; word-break: break-all; font-family: 'Courier New', monospace; color: #5b21b6;">{{$flow.WiresharkFilter}}</code>
                                </div>
                                <div>
                                    <label style="display: block; font-size: 0.6875rem; font-weight: 600; color: #8b5cf6; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">
                                        Both Directions:
                                    </label>
                                    <code style="display: block; padding: 10px 12px; background: #ffffff; border: 1px solid #ddd6fe; border-radius: 6px; font-size: 0.75rem; word-break: break-all; font-family: 'Courier New', monospace; color: #5b21b6;">{{$flow.WiresharkFilterBidi}}</code>
                                </div>
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .TCPHandshakeFlows) 50}}
                    <div style="text-align: center; padding: 16px; color: #6b7280; font-size: 0.875rem; background: #f9fafb; border-radius: 8px; margin-top: 12px;">
                        <i class="fas fa-info-circle"></i> Showing first 50 of {{len .TCPHandshakeFlows}} TCP handshake flows.
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            
            
            <!-- Performance Metrics Grid -->
            <div class="widget-grid mb-xl">
                <!-- TCP Retransmissions Widget -->
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-redo" style="color: var(--color-warning);"></i>
                            TCP Retransmissions
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl); margin-bottom: var(--space-md);">
                            {{.Stats.TCPRetransmissions}}
                        </div>
                        <p class="text-muted mb-md">Total retransmission events detected</p>
                        {{if gt .Stats.TCPRetransmissions 100}}
                        <div class="status-badge warning">
                            <span class="status-dot"></span>
                            High retransmission rate - investigate network quality
                        </div>
                        {{else}}
                        <div class="status-badge healthy">
                            <span class="status-dot"></span>
                            Normal retransmission rate
                        </div>
                        {{end}}
                    </div>
                </div>
                
                <!-- High RTT Flows Widget -->
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-clock" style="color: var(--color-info);"></i>
                            High Latency Flows
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl); margin-bottom: var(--space-md);">
                            {{.Stats.HighRTTFlows}}
                        </div>
                        <p class="text-muted mb-md">Flows with elevated round-trip time</p>
                        {{if gt .Stats.HighRTTFlows 10}}
                        <div class="status-badge warning">
                            <span class="status-dot"></span>
                            Multiple high-latency connections detected
                        </div>
                        {{else}}
                        <div class="status-badge healthy">
                            <span class="status-dot"></span>
                            Latency within acceptable range
                        </div>
                        {{end}}
                    </div>
                </div>
            </div>
            
            <!-- TCP Retransmissions - Complete Redesign with Inline Styles -->
            {{if gt .Stats.TCPRetransmissions 0}}
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #dc2626 0%, #f97316 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-redo"></i>
                        TCP Retransmission Analysis
                        <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{.Stats.TCPRetransmissions}} events</span>
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Packets that had to be sent again due to network issues</p>
                </div>
                
                <!-- Educational Introduction -->
                <div style="background: #fef2f2; border-bottom: 1px solid #fecaca; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #ef4444; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #991b1b; font-size: 1rem;">What are TCP Retransmissions?</h4>
                            <p style="margin: 0 0 12px 0; color: #b91c1c; font-size: 0.875rem; line-height: 1.6;">
                                When a packet is lost or corrupted during transmission, TCP automatically resends it. 
                                <strong>High retransmission rates indicate network problems</strong> like congestion, packet loss, or faulty hardware.
                            </p>
                            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap; font-size: 0.8125rem;">
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></span>
                                    <span style="color: #166534;">0-1% = Normal</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%;"></span>
                                    <span style="color: #b45309;">1-5% = Moderate</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%;"></span>
                                    <span style="color: #b91c1c;">>5% = Critical</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Retransmission List -->
                <div style="padding: 16px 24px;">
                    {{if .TCPRetransmissions}}
                    {{range $index, $retrans := .TCPRetransmissions}}
                    {{if lt $index 20}}
                    <details style="margin-bottom: 12px; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; {{if gt $retrans.Count 50}}border-color: #fca5a5; background: #fef2f2;{{else if gt $retrans.Count 10}}border-color: #fcd34d; background: #fffbeb;{{else}}border-color: #86efac; background: #f0fdf4;{{end}}">
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; background: {{if gt $retrans.Count 50}}#fef2f2{{else if gt $retrans.Count 10}}#fffbeb{{else}}#f0fdf4{{end}}; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-redo" style="color: {{if gt $retrans.Count 50}}#ef4444{{else if gt $retrans.Count 10}}#f59e0b{{else}}#22c55e{{end}};"></i>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$retrans.SrcIP}}:{{$retrans.SrcPort}}
                                </span>
                                <span style="color: #9ca3af; font-weight: bold;">→</span>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$retrans.DstIP}}:{{$retrans.DstPort}}
                                </span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="background: {{if gt $retrans.Count 50}}#fee2e2{{else if gt $retrans.Count 10}}#fef3c7{{else}}#d1fae5{{end}}; color: {{if gt $retrans.Count 50}}#b91c1c{{else if gt $retrans.Count 10}}#b45309{{else}}#047857{{end}}; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    {{if gt $retrans.Count 50}}<i class="fas fa-exclamation-triangle"></i> Critical{{else if gt $retrans.Count 10}}<i class="fas fa-exclamation-circle"></i> Warning{{else}}<i class="fas fa-check-circle"></i> Low{{end}}
                                </span>
                                <span style="background: #f3f4f6; color: #374151; padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                                    {{$retrans.Count}} retransmissions
                                </span>
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- Severity Indicator -->
                            <div style="margin-bottom: 16px;">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                    <span style="font-weight: 600; color: #374151; font-size: 0.875rem;">Severity Level:</span>
                                    <div style="flex: 1; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                                        <div style="width: {{if gt $retrans.Count 100}}100{{else}}{{$retrans.Count}}{{end}}%; height: 100%; background: {{if gt $retrans.Count 50}}#ef4444{{else if gt $retrans.Count 10}}#f59e0b{{else}}#22c55e{{end}}; border-radius: 4px;"></div>
                                    </div>
                                    <span style="font-size: 0.75rem; color: #6b7280;">{{$retrans.Count}}/100</span>
                                </div>
                            </div>
                            
                            <!-- What This Means -->
                            <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #475569; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-lightbulb" style="color: #eab308;"></i>
                                    What This Means
                                </h4>
                                {{if gt $retrans.Count 50}}
                                <p style="margin: 0; font-size: 0.8125rem; color: #b91c1c; line-height: 1.6;">
                                    <strong>Critical Issue:</strong> This connection has severe packet loss. Users will experience slow loading, timeouts, and poor application performance. Immediate investigation required.
                                </p>
                                {{else if gt $retrans.Count 10}}
                                <p style="margin: 0; font-size: 0.8125rem; color: #b45309; line-height: 1.6;">
                                    <strong>Warning:</strong> Moderate retransmission rate detected. This may cause noticeable delays for users. Monitor this connection and investigate if it persists.
                                </p>
                                {{else}}
                                <p style="margin: 0; font-size: 0.8125rem; color: #047857; line-height: 1.6;">
                                    <strong>Low Impact:</strong> Minor retransmissions within normal range. No immediate action required, but continue monitoring.
                                </p>
                                {{end}}
                            </div>
                            
                            <!-- Next Actions -->
                            <div style="background: {{if gt $retrans.Count 50}}#fef2f2{{else if gt $retrans.Count 10}}#fffbeb{{else}}#f0fdf4{{end}}; border: 1px solid {{if gt $retrans.Count 50}}#fecaca{{else if gt $retrans.Count 10}}#fcd34d{{else}}#86efac{{end}}; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: {{if gt $retrans.Count 50}}#991b1b{{else if gt $retrans.Count 10}}#92400e{{else}}#166534{{end}}; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-tasks"></i>
                                    Next Actions
                                </h4>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #64748b; line-height: 1.8;">
                                    {{if gt $retrans.Count 50}}
                                    <li><strong>Check network congestion</strong> on the path between {{$retrans.SrcIP}} and {{$retrans.DstIP}}</li>
                                    <li><strong>Verify link quality</strong> - look for interface errors, CRC errors, or duplex mismatches</li>
                                    <li><strong>Review QoS settings</strong> - ensure traffic is properly prioritized</li>
                                    <li><strong>Check for bandwidth saturation</strong> on intermediate links</li>
                                    <li><strong>Contact ISP</strong> if destination is external and issue persists</li>
                                    {{else if gt $retrans.Count 10}}
                                    <li><strong>Monitor this flow</strong> over the next 24 hours for patterns</li>
                                    <li><strong>Check interface statistics</strong> on devices in the path</li>
                                    <li><strong>Review application behavior</strong> at {{$retrans.SrcIP}}</li>
                                    {{else}}
                                    <li><strong>No immediate action required</strong> - retransmissions within normal range</li>
                                    <li><strong>Continue monitoring</strong> for any increase in retransmissions</li>
                                    {{end}}
                                </ul>
                            </div>
                            
                            <!-- Wireshark Filter -->
                            <div style="background: #faf5ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #7c3aed; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-filter"></i>
                                    Wireshark Filter
                                </h4>
                                <code style="display: block; padding: 10px 12px; background: #ffffff; border: 1px solid #ddd6fe; border-radius: 6px; font-size: 0.75rem; word-break: break-all; font-family: 'Courier New', monospace; color: #5b21b6;">ip.addr=={{$retrans.SrcIP}} && ip.addr=={{$retrans.DstIP}} && tcp.analysis.retransmission</code>
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .TCPRetransmissions) 20}}
                    <div style="text-align: center; padding: 16px; color: #6b7280; font-size: 0.875rem; background: #f9fafb; border-radius: 8px; margin-top: 12px;">
                        <i class="fas fa-info-circle"></i> Showing top 20 of {{len .TCPRetransmissions}} retransmission flows (sorted by count).
                    </div>
                    {{end}}
                    {{else}}
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 12px; color: #22c55e;"></i>
                        <p style="margin: 0; font-size: 0.875rem;">No significant retransmission issues detected.</p>
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            <!-- High Latency Flow Details - Complete Redesign with Inline Styles -->
            {{if gt .Stats.HighRTTFlows 0}}
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-stopwatch"></i>
                        High Latency Flow Analysis
                        <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{.Stats.HighRTTFlows}} flows</span>
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Connections with elevated round-trip time affecting performance</p>
                </div>
                
                <!-- Educational Introduction -->
                <div style="background: #faf5ff; border-bottom: 1px solid #e9d5ff; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #8b5cf6; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #5b21b6; font-size: 1rem;">What is Network Latency (RTT)?</h4>
                            <p style="margin: 0 0 12px 0; color: #7c3aed; font-size: 0.875rem; line-height: 1.6;">
                                Round-Trip Time (RTT) measures how long it takes for a packet to travel to a destination and back. 
                                <strong>High latency causes slow response times</strong>, affecting user experience and application performance.
                            </p>
                            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap; font-size: 0.8125rem;">
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></span>
                                    <span style="color: #166534;">&lt;50ms = Excellent</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%;"></span>
                                    <span style="color: #b45309;">50-150ms = Moderate</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%;"></span>
                                    <span style="color: #b91c1c;">&gt;150ms = High</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- High Latency Flow List -->
                <div style="padding: 16px 24px;">
                    {{if .HighRTTFlows}}
                    {{range $index, $flow := .HighRTTFlows}}
                    {{if lt $index 20}}
                    <details style="margin-bottom: 12px; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; {{if gt $flow.AvgRTT 150.0}}border-color: #fca5a5; background: #fef2f2;{{else if gt $flow.AvgRTT 50.0}}border-color: #fcd34d; background: #fffbeb;{{else}}border-color: #86efac; background: #f0fdf4;{{end}}">
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; background: {{if gt $flow.AvgRTT 150.0}}#fef2f2{{else if gt $flow.AvgRTT 50.0}}#fffbeb{{else}}#f0fdf4{{end}}; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-clock" style="color: {{if gt $flow.AvgRTT 150.0}}#ef4444{{else if gt $flow.AvgRTT 50.0}}#f59e0b{{else}}#22c55e{{end}};"></i>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$flow.SrcIP}}:{{$flow.SrcPort}}
                                </span>
                                <span style="color: #9ca3af; font-weight: bold;">→</span>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$flow.DstIP}}:{{$flow.DstPort}}
                                </span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="background: {{if gt $flow.AvgRTT 150.0}}#fee2e2{{else if gt $flow.AvgRTT 50.0}}#fef3c7{{else}}#d1fae5{{end}}; color: {{if gt $flow.AvgRTT 150.0}}#b91c1c{{else if gt $flow.AvgRTT 50.0}}#b45309{{else}}#047857{{end}}; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    {{if gt $flow.AvgRTT 150.0}}<i class="fas fa-exclamation-triangle"></i> High{{else if gt $flow.AvgRTT 50.0}}<i class="fas fa-exclamation-circle"></i> Moderate{{else}}<i class="fas fa-check-circle"></i> OK{{end}}
                                </span>
                                <span style="background: #f3f4f6; color: #374151; padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                                    Avg: {{printf "%.1f" $flow.AvgRTT}}ms
                                </span>
                                <span style="background: #fef3c7; color: #b45309; padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                                    Max: {{printf "%.1f" $flow.MaxRTT}}ms
                                </span>
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- Latency Visualization -->
                            <div style="margin-bottom: 16px;">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                    <span style="font-weight: 600; color: #374151; font-size: 0.875rem;">Latency Level:</span>
                                    <div style="flex: 1; height: 8px; background: linear-gradient(to right, #22c55e 0%, #22c55e 33%, #f59e0b 33%, #f59e0b 66%, #ef4444 66%, #ef4444 100%); border-radius: 4px;"></div>
                                    <span style="font-size: 0.75rem; color: #6b7280; min-width: 60px;">{{printf "%.1f" $flow.AvgRTT}}ms</span>
                                </div>
                            </div>
                            
                            <!-- What This Means -->
                            <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #475569; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-lightbulb" style="color: #eab308;"></i>
                                    What This Means
                                </h4>
                                {{if gt $flow.AvgRTT 150.0}}
                                <p style="margin: 0; font-size: 0.8125rem; color: #b91c1c; line-height: 1.6;">
                                    <strong>High Latency:</strong> Users will experience noticeable delays. Real-time applications (VoIP, video) will be severely impacted. Interactive applications will feel sluggish.
                                </p>
                                {{else if gt $flow.AvgRTT 50.0}}
                                <p style="margin: 0; font-size: 0.8125rem; color: #b45309; line-height: 1.6;">
                                    <strong>Moderate Latency:</strong> Some delay may be noticeable for interactive applications. Acceptable for most business applications but may affect real-time communications.
                                </p>
                                {{else}}
                                <p style="margin: 0; font-size: 0.8125rem; color: #047857; line-height: 1.6;">
                                    <strong>Acceptable Latency:</strong> This latency level is within normal range for most applications. Users should not experience significant delays.
                                </p>
                                {{end}}
                            </div>
                            
                            <!-- Common Causes -->
                            <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #0369a1; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-question-circle"></i>
                                    Common Causes of High Latency
                                </h4>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #64748b; line-height: 1.8;">
                                    <li><strong>Geographic distance</strong> - Data traveling long distances (e.g., cross-continent)</li>
                                    <li><strong>Network congestion</strong> - Too much traffic on the network path</li>
                                    <li><strong>Routing inefficiency</strong> - Packets taking suboptimal paths</li>
                                    <li><strong>Hardware bottlenecks</strong> - Overloaded routers or switches</li>
                                    <li><strong>ISP issues</strong> - Problems with internet service provider</li>
                                </ul>
                            </div>
                            
                            <!-- Next Actions -->
                            <div style="background: {{if gt $flow.AvgRTT 150.0}}#fef2f2{{else if gt $flow.AvgRTT 50.0}}#fffbeb{{else}}#f0fdf4{{end}}; border: 1px solid {{if gt $flow.AvgRTT 150.0}}#fecaca{{else if gt $flow.AvgRTT 50.0}}#fcd34d{{else}}#86efac{{end}}; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: {{if gt $flow.AvgRTT 150.0}}#991b1b{{else if gt $flow.AvgRTT 50.0}}#92400e{{else}}#166534{{end}}; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-tasks"></i>
                                    Troubleshooting Steps
                                </h4>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #64748b; line-height: 1.8;">
                                    {{if gt $flow.AvgRTT 150.0}}
                                    <li><strong>Run traceroute</strong> to {{$flow.DstIP}} to identify where delay occurs</li>
                                    <li><strong>Check for network congestion</strong> on intermediate links</li>
                                    <li><strong>Verify routing tables</strong> for optimal path selection</li>
                                    <li><strong>Review QoS policies</strong> to prioritize latency-sensitive traffic</li>
                                    <li><strong>Contact ISP</strong> if destination is external and latency is on their network</li>
                                    {{else if gt $flow.AvgRTT 50.0}}
                                    <li><strong>Monitor this flow</strong> for latency spikes during peak hours</li>
                                    <li><strong>Check interface utilization</strong> on devices in the path</li>
                                    <li><strong>Consider SD-WAN optimization</strong> for this traffic type</li>
                                    {{else}}
                                    <li><strong>No immediate action required</strong> - latency is acceptable</li>
                                    <li><strong>Continue monitoring</strong> for any degradation</li>
                                    {{end}}
                                </ul>
                            </div>
                            
                            <!-- Wireshark Filter -->
                            <div style="background: #faf5ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #7c3aed; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-filter"></i>
                                    Wireshark Filter
                                </h4>
                                <code style="display: block; padding: 10px 12px; background: #ffffff; border: 1px solid #ddd6fe; border-radius: 6px; font-size: 0.75rem; word-break: break-all; font-family: 'Courier New', monospace; color: #5b21b6;">ip.addr=={{$flow.SrcIP}} && ip.addr=={{$flow.DstIP}} && tcp.port=={{$flow.DstPort}}</code>
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .HighRTTFlows) 20}}
                    <div style="text-align: center; padding: 16px; color: #6b7280; font-size: 0.875rem; background: #f9fafb; border-radius: 8px; margin-top: 12px;">
                        <i class="fas fa-info-circle"></i> Showing top 20 of {{len .HighRTTFlows}} high latency flows (sorted by RTT).
                    </div>
                    {{end}}
                    {{else}}
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 12px; color: #22c55e;"></i>
                        <p style="margin: 0; font-size: 0.875rem;">No high latency flows detected.</p>
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             TRAFFIC ANALYSIS SECTION
             ==================================================================== -->
        <section id="traffic" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-exchange-alt" style="color: var(--color-primary);"></i>
                Traffic Analysis
            </h2>
            
            <!-- Top Traffic Flows - Complete Redesign with Inline Styles -->
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #f97316 0%, #fb923c 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-chart-bar"></i>
                        Top Traffic Flow Analysis
                        {{if .TopFlows}}<span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{len .TopFlows}} flows</span>{{end}}
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Identify bandwidth consumers and traffic patterns</p>
                </div>
                
                <!-- Educational Introduction -->
                <div style="background: #fff7ed; border-bottom: 1px solid #fed7aa; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #ea580c; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #c2410c; font-size: 1rem;">Understanding Traffic Flows</h4>
                            <p style="margin: 0 0 12px 0; color: #ea580c; font-size: 0.875rem; line-height: 1.6;">
                                Traffic flows show which connections consume the most bandwidth. High-volume flows may indicate 
                                <strong>large file transfers</strong>, <strong>video streaming</strong>, <strong>backups</strong>, or potentially 
                                <strong>unauthorized data exfiltration</strong>. Monitoring top consumers helps optimize network performance.
                            </p>
                            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap; font-size: 0.8125rem;">
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></span>
                                    <span style="color: #166534;">0-5% = Normal usage</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%;"></span>
                                    <span style="color: #92400e;">5-15% = High usage</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%;"></span>
                                    <span style="color: #dc2626;">&gt;15% = Bandwidth hog</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Traffic Flow List -->
                <div style="padding: 16px 24px;">
                    {{if .TopFlows}}
                    {{range $index, $flow := .TopFlows}}
                    {{if lt $index 15}}
                    <details style="margin-bottom: 12px; border: 1px solid {{if gt $flow.Percentage 15.0}}#fecaca{{else if gt $flow.Percentage 5.0}}#fde68a{{else}}#bbf7d0{{end}}; border-radius: 8px; overflow: hidden; background: {{if gt $flow.Percentage 15.0}}#fef2f2{{else if gt $flow.Percentage 5.0}}#fefce8{{else}}#f0fdf4{{end}};">
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-exchange-alt" style="color: {{if gt $flow.Percentage 15.0}}#ef4444{{else if gt $flow.Percentage 5.0}}#f59e0b{{else}}#22c55e{{end}};"></i>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$flow.SrcIP}}:{{$flow.SrcPort}}
                                </span>
                                <span style="color: #9ca3af; font-weight: bold;">→</span>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$flow.DstIP}}:{{$flow.DstPort}}
                                </span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="background: {{if gt $flow.Percentage 15.0}}#fecaca{{else if gt $flow.Percentage 5.0}}#fde68a{{else}}#d1fae5{{end}}; color: {{if gt $flow.Percentage 15.0}}#dc2626{{else if gt $flow.Percentage 5.0}}#92400e{{else}}#047857{{end}}; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">
                                    {{printf "%.1f" $flow.Percentage}}%
                                </span>
                                <span style="background: #e0e7ff; color: #3730a3; padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                                    {{$flow.Protocol}}
                                </span>
                                <span style="color: #6b7280; font-size: 0.8125rem; font-weight: 500;">
                                    {{$flow.BytesFormatted}}
                                </span>
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- Traffic Volume Visualization -->
                            <div style="margin-bottom: 16px;">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                    <span style="font-weight: 600; color: #374151; font-size: 0.875rem;">Bandwidth Usage:</span>
                                    <div style="flex: 1; height: 12px; background: #e5e7eb; border-radius: 6px; overflow: hidden;">
                                        <div style="width: {{printf "%.1f" $flow.Percentage}}%; height: 100%; background: {{if gt $flow.Percentage 15.0}}#ef4444{{else if gt $flow.Percentage 5.0}}#f59e0b{{else}}#22c55e{{end}}; border-radius: 6px;"></div>
                                    </div>
                                    <span style="font-size: 0.875rem; color: #374151; font-weight: 600; min-width: 60px;">{{printf "%.1f" $flow.Percentage}}%</span>
                                </div>
                            </div>
                            
                            <!-- Connection Details -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 16px;">
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Source</div>
                                    <code style="font-size: 0.875rem; color: #0f172a;">{{$flow.SrcIP}}:{{$flow.SrcPort}}</code>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Destination</div>
                                    <code style="font-size: 0.875rem; color: #0f172a;">{{$flow.DstIP}}:{{$flow.DstPort}}</code>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Protocol</div>
                                    <span style="font-size: 0.875rem; color: #0f172a; font-weight: 600;">{{$flow.Protocol}}</span>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Data Transferred</div>
                                    <span style="font-size: 0.875rem; color: #0f172a; font-weight: 600;">{{$flow.BytesFormatted}}</span>
                                </div>
                            </div>
                            
                            <!-- What This Means -->
                            <div style="background: {{if gt $flow.Percentage 15.0}}#fef2f2{{else if gt $flow.Percentage 5.0}}#fefce8{{else}}#f0fdf4{{end}}; border: 1px solid {{if gt $flow.Percentage 15.0}}#fecaca{{else if gt $flow.Percentage 5.0}}#fde68a{{else}}#bbf7d0{{end}}; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: {{if gt $flow.Percentage 15.0}}#dc2626{{else if gt $flow.Percentage 5.0}}#92400e{{else}}#166534{{end}}; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas {{if gt $flow.Percentage 15.0}}fa-exclamation-circle{{else if gt $flow.Percentage 5.0}}fa-exclamation-triangle{{else}}fa-check-circle{{end}}"></i>
                                    {{if gt $flow.Percentage 15.0}}High Bandwidth Consumer{{else if gt $flow.Percentage 5.0}}Elevated Traffic{{else}}Normal Traffic{{end}}
                                </h4>
                                <p style="margin: 0; font-size: 0.8125rem; color: {{if gt $flow.Percentage 15.0}}#991b1b{{else if gt $flow.Percentage 5.0}}#78350f{{else}}#047857{{end}}; line-height: 1.6;">
                                    {{if gt $flow.Percentage 15.0}}This flow is consuming a significant portion of available bandwidth. This could indicate large file transfers, video streaming, backup operations, or potentially unauthorized data movement. Immediate investigation recommended.
                                    {{else if gt $flow.Percentage 5.0}}This flow shows elevated traffic levels. While not critical, it's worth monitoring to ensure it's legitimate business traffic and not impacting other users.
                                    {{else}}This flow shows normal traffic patterns. No immediate action required, but continue monitoring for changes.{{end}}
                                </p>
                            </div>
                            
                            <!-- Next Actions -->
                            <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #1e40af; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-tasks"></i>
                                    Next Actions
                                </h4>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #1e3a8a; line-height: 1.8;">
                                    {{if gt $flow.Percentage 15.0}}
                                    <li><strong>Identify Application:</strong> Determine what application is generating this traffic</li>
                                    <li><strong>Verify Legitimacy:</strong> Confirm this is authorized business traffic</li>
                                    <li><strong>Check QoS:</strong> Review QoS policies for this traffic class</li>
                                    <li><strong>Contact User:</strong> If source is a workstation, verify user activity</li>
                                    {{else if gt $flow.Percentage 5.0}}
                                    <li><strong>Monitor Trend:</strong> Watch if this flow continues to grow</li>
                                    <li><strong>Identify Application:</strong> Determine the application type</li>
                                    <li><strong>Review Policies:</strong> Ensure traffic aligns with acceptable use policy</li>
                                    {{else}}
                                    <li><strong>Continue Monitoring:</strong> No immediate action needed</li>
                                    <li><strong>Baseline:</strong> Use this as reference for normal traffic patterns</li>
                                    {{end}}
                                </ul>
                            </div>
                            
                            <!-- Wireshark Filter -->
                            <div style="background: #faf5ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #7c3aed; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-filter"></i>
                                    Wireshark Filter
                                </h4>
                                <code style="display: block; padding: 10px 12px; background: #ffffff; border: 1px solid #ddd6fe; border-radius: 6px; font-size: 0.75rem; word-break: break-all; font-family: 'Courier New', monospace; color: #5b21b6;">ip.addr=={{$flow.SrcIP}} && ip.addr=={{$flow.DstIP}}</code>
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .TopFlows) 15}}
                    <div style="text-align: center; padding: 16px; color: #6b7280; font-size: 0.875rem; background: #f9fafb; border-radius: 8px; margin-top: 12px;">
                        <i class="fas fa-info-circle"></i> Showing top 15 of {{len .TopFlows}} traffic flows.
                    </div>
                    {{end}}
                    {{else}}
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 12px; color: #9ca3af;"></i>
                        <p style="margin: 0; font-size: 0.875rem;">No traffic flow data available.</p>
                    </div>
                    {{end}}
                </div>
                
                <!-- Traffic Management Tips -->
                <div style="background: #f0fdf4; border-top: 1px solid #bbf7d0; padding: 20px 24px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 0.9375rem; color: #166534; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-lightbulb"></i>
                        Traffic Management Tips
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
                        <div style="background: #ffffff; border: 1px solid #bbf7d0; border-radius: 8px; padding: 14px;">
                            <div style="font-weight: 600; color: #166534; font-size: 0.875rem; margin-bottom: 8px;">
                                <i class="fas fa-tachometer-alt" style="color: #22c55e;"></i> QoS Prioritization
                            </div>
                            <p style="margin: 0; font-size: 0.8125rem; color: #047857;">Implement QoS policies to prioritize critical business traffic over bulk transfers.</p>
                        </div>
                        <div style="background: #ffffff; border: 1px solid #bbf7d0; border-radius: 8px; padding: 14px;">
                            <div style="font-weight: 600; color: #166534; font-size: 0.875rem; margin-bottom: 8px;">
                                <i class="fas fa-clock" style="color: #22c55e;"></i> Schedule Large Transfers
                            </div>
                            <p style="margin: 0; font-size: 0.8125rem; color: #047857;">Schedule backups and large file transfers during off-peak hours.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Protocol Distribution - Complete Redesign with Inline Styles -->
            {{if .ProtocolStats}}
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #6366f1 0%, #818cf8 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-layer-group"></i>
                        Protocol Distribution Analysis
                        <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{len .ProtocolStats}} protocols</span>
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Understand network protocol usage and identify anomalies</p>
                </div>
                
                <!-- Educational Introduction -->
                <div style="background: #eef2ff; border-bottom: 1px solid #c7d2fe; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #4f46e5; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #3730a3; font-size: 1rem;">Understanding Protocol Distribution</h4>
                            <p style="margin: 0 0 12px 0; color: #4338ca; font-size: 0.875rem; line-height: 1.6;">
                                Protocol distribution shows how network bandwidth is divided among different protocols. 
                                <strong>TCP</strong> typically dominates (web, email, apps), while <strong>UDP</strong> handles real-time traffic (VoIP, video). 
                                Unusual protocols may indicate <strong>security concerns</strong> or <strong>misconfigured applications</strong>.
                            </p>
                            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap; font-size: 0.8125rem;">
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></span>
                                    <span style="color: #166534;">Expected protocols</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%;"></span>
                                    <span style="color: #92400e;">Monitor closely</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%;"></span>
                                    <span style="color: #dc2626;">Investigate</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Protocol List -->
                <div style="padding: 16px 24px;">
                    {{range $index, $proto := .ProtocolStats}}
                    {{if lt $index 10}}
                    <details style="margin-bottom: 12px; border: 1px solid #c7d2fe; border-radius: 8px; overflow: hidden; background: #f5f3ff;">
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-network-wired" style="color: #6366f1;"></i>
                                <span style="font-weight: 600; color: #1f2937; font-size: 1rem;">
                                    {{$proto.Protocol}}
                                </span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="width: 120px; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                                    <div style="width: {{printf "%.0f" $proto.Percent}}%; height: 100%; background: #6366f1; border-radius: 4px;"></div>
                                </div>
                                <span style="background: #e0e7ff; color: #3730a3; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; min-width: 60px; text-align: center;">
                                    {{printf "%.1f" $proto.Percent}}%
                                </span>
                                <span style="color: #6b7280; font-size: 0.8125rem; font-weight: 500; min-width: 80px; text-align: right;">
                                    {{$proto.Bytes}}
                                </span>
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- Protocol Details -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 16px;">
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Protocol Name</div>
                                    <span style="font-size: 1rem; color: #0f172a; font-weight: 700;">{{$proto.Protocol}}</span>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Total Data</div>
                                    <span style="font-size: 1rem; color: #0f172a; font-weight: 600;">{{$proto.Bytes}}</span>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Share of Traffic</div>
                                    <span style="font-size: 1rem; color: #0f172a; font-weight: 600;">{{printf "%.1f" $proto.Percent}}%</span>
                                </div>
                            </div>
                            
                            <!-- Protocol Information -->
                            <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #166534; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-info-circle"></i>
                                    About This Protocol
                                </h4>
                                <p style="margin: 0; font-size: 0.8125rem; color: #047857; line-height: 1.6;">
                                    {{if eq $proto.Protocol "TCP"}}TCP (Transmission Control Protocol) is the most common transport protocol. It provides reliable, ordered delivery of data and is used by web browsing, email, file transfers, and most applications.
                                    {{else if eq $proto.Protocol "UDP"}}UDP (User Datagram Protocol) is used for real-time applications where speed is more important than reliability. Common uses include VoIP, video streaming, DNS queries, and online gaming.
                                    {{else if eq $proto.Protocol "ICMP"}}ICMP (Internet Control Message Protocol) is used for network diagnostics like ping and traceroute. High ICMP traffic may indicate network scanning or troubleshooting activity.
                                    {{else if eq $proto.Protocol "DNS"}}DNS (Domain Name System) traffic resolves domain names to IP addresses. Unusual DNS patterns may indicate tunneling or data exfiltration attempts.
                                    {{else if eq $proto.Protocol "HTTP"}}HTTP (Hypertext Transfer Protocol) is used for unencrypted web traffic. Consider migrating to HTTPS for security.
                                    {{else if eq $proto.Protocol "HTTPS"}}HTTPS is encrypted web traffic using TLS. This is the expected protocol for secure web browsing and API communications.
                                    {{else if eq $proto.Protocol "TLS"}}TLS (Transport Layer Security) provides encryption for various protocols. This indicates secure communications.
                                    {{else}}This protocol is part of your network traffic mix. Review if this protocol is expected for your environment.{{end}}
                                </p>
                            </div>
                            
                            <!-- Security Considerations -->
                            <div style="background: #fefce8; border: 1px solid #fef08a; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #854d0e; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-shield-alt"></i>
                                    Security Considerations
                                </h4>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #78350f; line-height: 1.8;">
                                    {{if eq $proto.Protocol "TCP"}}
                                    <li>Monitor for unusual port usage or connections to suspicious destinations</li>
                                    <li>Check for excessive SYN packets which may indicate scanning</li>
                                    {{else if eq $proto.Protocol "UDP"}}
                                    <li>Watch for UDP floods which could indicate DDoS attacks</li>
                                    <li>Verify UDP traffic is from expected applications</li>
                                    {{else if eq $proto.Protocol "ICMP"}}
                                    <li>High ICMP may indicate network reconnaissance</li>
                                    <li>Consider rate-limiting ICMP at network boundaries</li>
                                    {{else if eq $proto.Protocol "DNS"}}
                                    <li>Monitor for DNS tunneling attempts</li>
                                    <li>Check for queries to suspicious domains</li>
                                    {{else}}
                                    <li>Verify this protocol is expected in your environment</li>
                                    <li>Review firewall rules for this protocol</li>
                                    {{end}}
                                </ul>
                            </div>
                            
                            <!-- Wireshark Filter -->
                            <div style="background: #faf5ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #7c3aed; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-filter"></i>
                                    Wireshark Filter
                                </h4>
                                <code style="display: block; padding: 10px 12px; background: #ffffff; border: 1px solid #ddd6fe; border-radius: 6px; font-size: 0.75rem; word-break: break-all; font-family: 'Courier New', monospace; color: #5b21b6;">{{if eq $proto.Protocol "TCP"}}tcp{{else if eq $proto.Protocol "UDP"}}udp{{else if eq $proto.Protocol "ICMP"}}icmp{{else if eq $proto.Protocol "DNS"}}dns{{else if eq $proto.Protocol "HTTP"}}http{{else if eq $proto.Protocol "HTTPS"}}tls{{else if eq $proto.Protocol "TLS"}}tls{{else}}ip.proto{{end}}</code>
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .ProtocolStats) 10}}
                    <div style="text-align: center; padding: 16px; color: #6b7280; font-size: 0.875rem; background: #f9fafb; border-radius: 8px; margin-top: 12px;">
                        <i class="fas fa-info-circle"></i> Showing top 10 of {{len .ProtocolStats}} protocols.
                    </div>
                    {{end}}
                </div>
                
                <!-- Protocol Best Practices -->
                <div style="background: #eef2ff; border-top: 1px solid #c7d2fe; padding: 20px 24px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 0.9375rem; color: #3730a3; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-clipboard-check"></i>
                        Protocol Best Practices
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
                        <div style="background: #ffffff; border: 1px solid #c7d2fe; border-radius: 8px; padding: 14px;">
                            <div style="font-weight: 600; color: #3730a3; font-size: 0.875rem; margin-bottom: 8px;">
                                <i class="fas fa-lock" style="color: #6366f1;"></i> Encrypt Traffic
                            </div>
                            <p style="margin: 0; font-size: 0.8125rem; color: #4338ca;">Ensure sensitive data uses encrypted protocols (HTTPS, TLS, SSH).</p>
                        </div>
                        <div style="background: #ffffff; border: 1px solid #c7d2fe; border-radius: 8px; padding: 14px;">
                            <div style="font-weight: 600; color: #3730a3; font-size: 0.875rem; margin-bottom: 8px;">
                                <i class="fas fa-ban" style="color: #6366f1;"></i> Block Unnecessary
                            </div>
                            <p style="margin: 0; font-size: 0.8125rem; color: #4338ca;">Disable protocols not required for business operations.</p>
                        </div>
                    </div>
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             PROTOCOLS SECTION
             ==================================================================== -->
        <section id="protocols" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-layer-group" style="color: var(--color-primary);"></i>
                Protocol Analysis
            </h2>
            
            <!-- Protocol Overview Widgets -->
            <div class="widget-grid mb-xl">
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-globe"></i>
                            DNS Queries
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl);">{{.Stats.DNSQueries}}</div>
                        <p class="text-muted">Total DNS queries processed</p>
                    </div>
                </div>
                
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-bolt"></i>
                            HTTP/2 Flows
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl);">{{.Stats.HTTP2Flows}}</div>
                        <p class="text-muted">Modern HTTP/2 connections</p>
                    </div>
                </div>
                
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-rocket"></i>
                            QUIC Flows
                        </h3>
                    </div>
                    <div class="widget-body">
                        <div class="kpi-value" style="font-size: var(--font-size-3xl);">{{.Stats.QUICFlows}}</div>
                        <p class="text-muted">QUIC protocol connections</p>
                    </div>
                </div>
            </div>
            
            <!-- DNS Request/Response Analysis - Complete Redesign with Inline Styles -->
            {{if .DNSDetails}}
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-globe"></i>
                        DNS Request/Response Analysis
                        <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{len .DNSDetails}} queries</span>
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Domain Name System queries and responses with timing analysis</p>
                </div>
                
                <!-- Educational Introduction -->
                <div style="background: #ecfdf5; border-bottom: 1px solid #a7f3d0; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #10b981; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #065f46; font-size: 1rem;">What is DNS?</h4>
                            <p style="margin: 0 0 12px 0; color: #047857; font-size: 0.875rem; line-height: 1.6;">
                                DNS (Domain Name System) translates human-readable domain names (like <code style="background: #d1fae5; padding: 2px 6px; border-radius: 4px;">google.com</code>) 
                                into IP addresses that computers use to communicate. Every website visit starts with a DNS query.
                            </p>
                            <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; font-size: 0.8125rem; color: #064e3b;">
                                <span style="background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px;">Query</span>
                                <span>→</span>
                                <span style="background: #d1fae5; color: #047857; padding: 2px 8px; border-radius: 4px;">Response</span>
                                <span>→</span>
                                <span style="background: #f0fdf4; color: #166534; padding: 2px 8px; border-radius: 4px; border: 1px solid #86efac;">IP Address Resolved!</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Color-Coded Legend -->
                <div style="background: #fafafa; border-bottom: 1px solid #e5e7eb; padding: 16px 24px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 24px; align-items: center;">
                        <span style="font-weight: 600; color: #374151; font-size: 0.875rem;">Legend:</span>
                        <!-- Query - Blue -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-right" style="color: #3b82f6; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #1e40af; font-weight: 500;">Query</span>
                            <span style="font-size: 0.75rem; color: #64748b;">Client request</span>
                        </div>
                        <!-- Response - Green -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #d1fae5; border: 3px solid #10b981; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-left" style="color: #10b981; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #047857; font-weight: 500;">Response</span>
                            <span style="font-size: 0.75rem; color: #64748b;">Server answer</span>
                        </div>
                        <!-- Error - Red -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #fee2e2; border: 3px solid #ef4444; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-times" style="color: #ef4444; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 0.8125rem; color: #b91c1c; font-weight: 500;">Error/Timeout</span>
                            <span style="font-size: 0.75rem; color: #64748b;">No response</span>
                        </div>
                    </div>
                </div>
                
                <!-- DNS Query List -->
                <div style="padding: 16px 24px;">
                    {{range $index, $dns := .DNSDetails}}
                    {{if lt $index 50}}
                    <details style="margin-bottom: 12px; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; {{if $dns.IsAnomalous}}border-color: #fca5a5; background: #fef2f2;{{else if $dns.HasResponse}}border-color: #86efac;{{else}}border-color: #fca5a5;{{end}}">
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; background: {{if $dns.IsAnomalous}}#fef2f2{{else if $dns.HasResponse}}#f0fdf4{{else}}#fef2f2{{end}}; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-globe" style="color: {{if $dns.HasResponse}}#10b981{{else}}#ef4444{{end}};"></i>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$dns.QueryName}}
                                </span>
                                <span style="background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px; font-size: 0.6875rem; font-weight: 600;">{{$dns.QueryType}}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                {{if $dns.HasResponse}}
                                <span style="color: #6b7280; font-size: 0.75rem;">{{$dns.ResponseTimeMs}}</span>
                                <span style="background: #d1fae5; color: #047857; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-check-circle"></i> {{$dns.ResponseCodeName}}
                                </span>
                                {{else}}
                                <span style="background: #fee2e2; color: #b91c1c; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-times-circle"></i> No Response
                                </span>
                                {{end}}
                                {{if $dns.IsAnomalous}}
                                <span style="background: #fef3c7; color: #b45309; padding: 4px 8px; border-radius: 4px; font-size: 0.6875rem; font-weight: 600;">
                                    <i class="fas fa-exclamation-triangle"></i> Anomaly
                                </span>
                                {{end}}
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- DNS Flow Timeline -->
                            <div style="margin-bottom: 20px;">
                                <h4 style="margin: 0 0 16px 0; font-size: 0.9375rem; color: #374151; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-stream" style="color: #10b981;"></i>
                                    DNS Resolution Timeline
                                </h4>
                                
                                <div style="display: flex; flex-direction: column; gap: 0;">
                                    <!-- Query Step -->
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #dbeafe; border: 3px solid #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-right" style="color: #3b82f6;"></i>
                                            </div>
                                            <div style="width: 3px; flex: 1; background: linear-gradient(to bottom, #3b82f6, {{if $dns.HasResponse}}#10b981{{else}}#ef4444{{end}}); min-height: 20px;"></div>
                                        </div>
                                        <div style="flex: 1; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 0 8px 8px 0; padding: 12px 16px; margin-bottom: 8px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #1e40af; font-size: 0.875rem;">DNS QUERY</span>
                                                <span style="font-size: 0.75rem; color: #3b82f6; background: white; padding: 2px 8px; border-radius: 4px;">Client → DNS Server</span>
                                            </div>
                                            <p style="margin: 0; color: #1e40af; font-size: 0.8125rem;">
                                                <code style="background: white; padding: 2px 6px; border-radius: 4px;">{{$dns.SourceIP}}</code> queries for 
                                                <code style="background: white; padding: 2px 6px; border-radius: 4px;">{{$dns.QueryName}}</code> (Type: {{$dns.QueryType}})
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <!-- Response Step -->
                                    {{if $dns.HasResponse}}
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #d1fae5; border: 3px solid #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-arrow-left" style="color: #10b981;"></i>
                                            </div>
                                        </div>
                                        <div style="flex: 1; background: #d1fae5; border-left: 4px solid #10b981; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #047857; font-size: 0.875rem;">DNS RESPONSE</span>
                                                <span style="font-size: 0.75rem; color: #059669; background: white; padding: 2px 8px; border-radius: 4px;">DNS Server → Client</span>
                                            </div>
                                            <p style="margin: 0; color: #047857; font-size: 0.8125rem;">
                                                Response Code: <strong>{{$dns.ResponseCode}} ({{$dns.ResponseCodeName}})</strong> 
                                                {{if $dns.AnswerIPs}}- Resolved to: <code style="background: white; padding: 2px 6px; border-radius: 4px;">{{$dns.AnswerIPs}}</code>{{end}}
                                                <strong>({{$dns.ResponseTimeMs}})</strong>
                                            </p>
                                        </div>
                                    </div>
                                    {{else}}
                                    <div style="display: flex; align-items: stretch; gap: 16px;">
                                        <div style="display: flex; flex-direction: column; align-items: center; width: 40px;">
                                            <div style="width: 40px; height: 40px; background: #fee2e2; border: 3px solid #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1;">
                                                <i class="fas fa-times" style="color: #ef4444;"></i>
                                            </div>
                                        </div>
                                        <div style="flex: 1; background: #fee2e2; border-left: 4px solid #ef4444; border-radius: 0 8px 8px 0; padding: 12px 16px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                                <span style="font-weight: 700; color: #b91c1c; font-size: 0.875rem;">NO RESPONSE</span>
                                                <span style="font-size: 0.75rem; color: #dc2626; background: white; padding: 2px 8px; border-radius: 4px;">Timeout</span>
                                            </div>
                                            <p style="margin: 0; color: #b91c1c; font-size: 0.8125rem;">DNS query did not receive a response from the server</p>
                                        </div>
                                    </div>
                                    {{end}}
                                </div>
                            </div>
                            
                            <!-- Explanation Section -->
                            <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #475569; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-lightbulb" style="color: #eab308;"></i>
                                    What This Means
                                </h4>
                                <p style="margin: 0 0 8px 0; font-size: 0.8125rem; color: #64748b; line-height: 1.6;">
                                    <strong>Query Type:</strong> {{$dns.QueryType}} - 
                                    {{if eq $dns.QueryType "A"}}Looking up the IPv4 address for this domain{{else if eq $dns.QueryType "AAAA"}}Looking up the IPv6 address for this domain{{else if eq $dns.QueryType "CNAME"}}Looking up the canonical (real) name for this alias{{else if eq $dns.QueryType "MX"}}Looking up the mail server for this domain{{else if eq $dns.QueryType "TXT"}}Looking up text records (often used for verification){{else if eq $dns.QueryType "PTR"}}Reverse lookup - finding the domain name for an IP{{else}}Looking up DNS records for this domain{{end}}
                                </p>
                                {{if $dns.HasResponse}}
                                <p style="margin: 0; font-size: 0.8125rem; color: #64748b; line-height: 1.6;">
                                    <strong style="color: #047857;">✓ Resolution Successful:</strong> The DNS server responded in {{$dns.ResponseTimeMs}}.
                                    {{if $dns.AnswerIPs}}The domain resolves to IP address(es): <code style="background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem;">{{$dns.AnswerIPs}}</code>{{end}}
                                </p>
                                {{else}}
                                <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 6px; padding: 12px; margin-top: 8px;">
                                    <p style="margin: 0; font-size: 0.8125rem; color: #b91c1c; font-weight: 500;">
                                        <i class="fas fa-exclamation-triangle"></i> <strong>Resolution Failed:</strong> No response received from DNS server.
                                    </p>
                                    <p style="margin: 8px 0 0 0; font-size: 0.8125rem; color: #64748b;">
                                        Possible causes: DNS server unreachable, network issues, or the domain doesn't exist.
                                    </p>
                                </div>
                                {{end}}
                                {{if $dns.IsAnomalous}}
                                <div style="background: #fef3c7; border: 1px solid #fcd34d; border-radius: 6px; padding: 12px; margin-top: 12px;">
                                    <p style="margin: 0; font-size: 0.8125rem; color: #b45309; font-weight: 500;">
                                        <i class="fas fa-exclamation-triangle"></i> <strong>Anomaly Detected:</strong> This DNS query shows unusual behavior.
                                    </p>
                                    <p style="margin: 8px 0 0 0; font-size: 0.8125rem; color: #92400e;">
                                        This may indicate DNS tunneling, data exfiltration, or misconfiguration. Investigate further.
                                    </p>
                                </div>
                                {{end}}
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .DNSDetails) 50}}
                    <div style="text-align: center; padding: 16px; color: #6b7280; font-size: 0.875rem; background: #f9fafb; border-radius: 8px; margin-top: 12px;">
                        <i class="fas fa-info-circle"></i> Showing first 50 of {{len .DNSDetails}} DNS queries.
                    </div>
                    {{end}}
                </div>
            </div>
            {{else}}
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden;">
                <div style="text-align: center; padding: 40px; color: #6b7280;">
                    <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 12px; color: #9ca3af;"></i>
                    <p style="margin: 0; font-size: 0.875rem;">No DNS queries recorded in this capture.</p>
                </div>
            </div>
            {{end}}
            
            <!-- HTTP/2 Flow Details - Complete Redesign with Inline Styles -->
            {{if .HTTP2Flows}}
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-bolt"></i>
                        HTTP/2 Flow Analysis
                        <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{len .HTTP2Flows}} flows</span>
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Modern multiplexed HTTP connections for faster web performance</p>
                </div>
                
                <!-- Educational Introduction -->
                <div style="background: #ecfeff; border-bottom: 1px solid #a5f3fc; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #0891b2; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #0e7490; font-size: 1rem;">What is HTTP/2?</h4>
                            <p style="margin: 0 0 12px 0; color: #0891b2; font-size: 0.875rem; line-height: 1.6;">
                                HTTP/2 is a major revision of HTTP that enables <strong>multiplexing</strong> (multiple requests over one connection), 
                                <strong>header compression</strong>, and <strong>server push</strong>. It significantly improves web performance compared to HTTP/1.1.
                            </p>
                            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap; font-size: 0.8125rem;">
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></span>
                                    <span style="color: #166534;">Active = Healthy connection</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #3b82f6; border-radius: 50%;"></span>
                                    <span style="color: #1d4ed8;">ALPN = h2 (TLS negotiated)</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Key Benefits Box -->
                <div style="padding: 16px 24px; background: #f0fdfa; border-bottom: 1px solid #99f6e4;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-layer-group" style="color: #0d9488; font-size: 1.25rem;"></i>
                            <div>
                                <div style="font-weight: 600; color: #134e4a; font-size: 0.875rem;">Multiplexing</div>
                                <div style="font-size: 0.75rem; color: #5eead4;">Multiple streams per connection</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-compress-alt" style="color: #0d9488; font-size: 1.25rem;"></i>
                            <div>
                                <div style="font-weight: 600; color: #134e4a; font-size: 0.875rem;">Header Compression</div>
                                <div style="font-size: 0.75rem; color: #5eead4;">HPACK reduces overhead</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-lock" style="color: #0d9488; font-size: 1.25rem;"></i>
                            <div>
                                <div style="font-weight: 600; color: #134e4a; font-size: 0.875rem;">TLS Required</div>
                                <div style="font-size: 0.75rem; color: #5eead4;">Encrypted by default (h2)</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- HTTP/2 Flow List -->
                <div style="padding: 16px 24px;">
                    {{range $index, $flow := .HTTP2Flows}}
                    {{if lt $index 20}}
                    <details style="margin-bottom: 12px; border: 1px solid #86efac; border-radius: 8px; overflow: hidden; background: #f0fdf4;">
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; background: #f0fdf4; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-bolt" style="color: #22c55e;"></i>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$flow.SrcIP}}:{{$flow.SrcPort}}
                                </span>
                                <span style="color: #9ca3af; font-weight: bold;">→</span>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$flow.DstIP}}:{{$flow.DstPort}}
                                </span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="background: #d1fae5; color: #047857; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-check-circle"></i> Active
                                </span>
                                <span style="background: #dbeafe; color: #1d4ed8; padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                                    HTTP/2
                                </span>
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- Connection Details -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 16px;">
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Source</div>
                                    <code style="font-size: 0.875rem; color: #0f172a;">{{$flow.SrcIP}}:{{$flow.SrcPort}}</code>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Destination</div>
                                    <code style="font-size: 0.875rem; color: #0f172a;">{{$flow.DstIP}}:{{$flow.DstPort}}</code>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Protocol</div>
                                    <span style="font-size: 0.875rem; color: #0f172a; font-weight: 600;">HTTP/2 (h2)</span>
                                </div>
                            </div>
                            
                            <!-- What This Means -->
                            <div style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #166534; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-check-circle"></i>
                                    Connection Status: Healthy
                                </h4>
                                <p style="margin: 0; font-size: 0.8125rem; color: #047857; line-height: 1.6;">
                                    This HTTP/2 connection is functioning normally. The client and server successfully negotiated HTTP/2 via ALPN (Application-Layer Protocol Negotiation) during the TLS handshake.
                                </p>
                            </div>
                            
                            <!-- HTTP/2 Specific Info -->
                            <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #1e40af; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-info-circle"></i>
                                    HTTP/2 Features in Use
                                </h4>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #64748b; line-height: 1.8;">
                                    <li><strong>Stream Multiplexing:</strong> Multiple requests/responses share this single TCP connection</li>
                                    <li><strong>Header Compression:</strong> HPACK algorithm reduces header overhead</li>
                                    <li><strong>Binary Protocol:</strong> More efficient than HTTP/1.1 text format</li>
                                    <li><strong>Flow Control:</strong> Per-stream and connection-level flow control</li>
                                </ul>
                            </div>
                            
                            <!-- Wireshark Filter -->
                            <div style="background: #faf5ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #7c3aed; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-filter"></i>
                                    Wireshark Filter
                                </h4>
                                <code style="display: block; padding: 10px 12px; background: #ffffff; border: 1px solid #ddd6fe; border-radius: 6px; font-size: 0.75rem; word-break: break-all; font-family: 'Courier New', monospace; color: #5b21b6;">ip.addr=={{$flow.SrcIP}} && ip.addr=={{$flow.DstIP}} && http2</code>
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .HTTP2Flows) 20}}
                    <div style="text-align: center; padding: 16px; color: #6b7280; font-size: 0.875rem; background: #f9fafb; border-radius: 8px; margin-top: 12px;">
                        <i class="fas fa-info-circle"></i> Showing top 20 of {{len .HTTP2Flows}} HTTP/2 flows.
                    </div>
                    {{end}}
                </div>
                
                <!-- Troubleshooting Guide -->
                <div style="background: #fefce8; border-top: 1px solid #fef08a; padding: 20px 24px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 0.9375rem; color: #854d0e; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-wrench"></i>
                        HTTP/2 Troubleshooting Guide
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
                        <div style="background: #ffffff; border: 1px solid #fde68a; border-radius: 8px; padding: 14px;">
                            <div style="font-weight: 600; color: #92400e; font-size: 0.875rem; margin-bottom: 8px;">
                                <i class="fas fa-exclamation-triangle" style="color: #f59e0b;"></i> RST_STREAM Errors
                            </div>
                            <p style="margin: 0 0 8px 0; font-size: 0.8125rem; color: #78716c;">Stream was reset - check application logs for errors.</p>
                            <code style="font-size: 0.75rem; color: #7c3aed; background: #faf5ff; padding: 4px 8px; border-radius: 4px;">http2.type == 3</code>
                        </div>
                        <div style="background: #ffffff; border: 1px solid #fde68a; border-radius: 8px; padding: 14px;">
                            <div style="font-weight: 600; color: #92400e; font-size: 0.875rem; margin-bottom: 8px;">
                                <i class="fas fa-times-circle" style="color: #ef4444;"></i> GOAWAY Frames
                            </div>
                            <p style="margin: 0 0 8px 0; font-size: 0.8125rem; color: #78716c;">Server is shutting down connection gracefully.</p>
                            <code style="font-size: 0.75rem; color: #7c3aed; background: #faf5ff; padding: 4px 8px; border-radius: 4px;">http2.type == 7</code>
                        </div>
                    </div>
                </div>
            </div>
            {{end}}
            
            <!-- QUIC Flow Details - Complete Redesign with Inline Styles -->
            {{if .QUICFlows}}
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-rocket"></i>
                        QUIC Flow Analysis
                        <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{len .QUICFlows}} flows</span>
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Next-generation transport protocol powering HTTP/3</p>
                </div>
                
                <!-- Educational Introduction -->
                <div style="background: #faf5ff; border-bottom: 1px solid #e9d5ff; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #8b5cf6; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #5b21b6; font-size: 1rem;">What is QUIC?</h4>
                            <p style="margin: 0 0 12px 0; color: #7c3aed; font-size: 0.875rem; line-height: 1.6;">
                                QUIC is a modern transport protocol that runs over <strong>UDP</strong> instead of TCP. It provides 
                                <strong>built-in encryption</strong>, <strong>faster connection establishment</strong> (0-RTT), and 
                                <strong>improved performance</strong> on lossy networks. QUIC is the foundation for HTTP/3.
                            </p>
                            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap; font-size: 0.8125rem;">
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></span>
                                    <span style="color: #166534;">Connected = Active session</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #8b5cf6; border-radius: 50%;"></span>
                                    <span style="color: #5b21b6;">UDP Port 443 = Standard</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Key Benefits Box -->
                <div style="padding: 16px 24px; background: #fdf4ff; border-bottom: 1px solid #f5d0fe;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-bolt" style="color: #a855f7; font-size: 1.25rem;"></i>
                            <div>
                                <div style="font-weight: 600; color: #581c87; font-size: 0.875rem;">0-RTT Handshake</div>
                                <div style="font-size: 0.75rem; color: #c084fc;">Instant reconnection</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-shield-alt" style="color: #a855f7; font-size: 1.25rem;"></i>
                            <div>
                                <div style="font-weight: 600; color: #581c87; font-size: 0.875rem;">Built-in TLS 1.3</div>
                                <div style="font-size: 0.75rem; color: #c084fc;">Always encrypted</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-exchange-alt" style="color: #a855f7; font-size: 1.25rem;"></i>
                            <div>
                                <div style="font-weight: 600; color: #581c87; font-size: 0.875rem;">Connection Migration</div>
                                <div style="font-size: 0.75rem; color: #c084fc;">Survives IP changes</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- QUIC Flow List -->
                <div style="padding: 16px 24px;">
                    {{range $index, $flow := .QUICFlows}}
                    {{if lt $index 20}}
                    <details style="margin-bottom: 12px; border: 1px solid #c4b5fd; border-radius: 8px; overflow: hidden; background: #faf5ff;">
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; background: #faf5ff; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-rocket" style="color: #8b5cf6;"></i>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$flow.SrcIP}}:{{$flow.SrcPort}}
                                </span>
                                <span style="color: #9ca3af; font-weight: bold;">→</span>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$flow.DstIP}}:{{$flow.DstPort}}
                                </span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                {{if $flow.ServerName}}
                                <span style="background: #dbeafe; color: #1d4ed8; padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 500; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    {{$flow.ServerName}}
                                </span>
                                {{end}}
                                <span style="background: #ede9fe; color: #5b21b6; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <i class="fas fa-check-circle"></i> Active
                                </span>
                                <span style="background: #f3e8ff; color: #7c3aed; padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                                    QUIC
                                </span>
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- Connection Details -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 16px;">
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Source</div>
                                    <code style="font-size: 0.875rem; color: #0f172a;">{{$flow.SrcIP}}:{{$flow.SrcPort}}</code>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Destination</div>
                                    <code style="font-size: 0.875rem; color: #0f172a;">{{$flow.DstIP}}:{{$flow.DstPort}}</code>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Server Name (SNI)</div>
                                    <span style="font-size: 0.875rem; color: #0f172a; font-weight: 500;">{{if $flow.ServerName}}{{$flow.ServerName}}{{else}}<span style="color: #9ca3af;">Not available</span>{{end}}</span>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Transport</div>
                                    <span style="font-size: 0.875rem; color: #0f172a; font-weight: 600;">UDP (QUIC)</span>
                                </div>
                            </div>
                            
                            <!-- What This Means -->
                            <div style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #166534; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-check-circle"></i>
                                    Connection Status: Active
                                </h4>
                                <p style="margin: 0; font-size: 0.8125rem; color: #047857; line-height: 1.6;">
                                    This QUIC connection is functioning normally. The client is using HTTP/3 to communicate with the server, 
                                    benefiting from faster connection establishment and improved performance on mobile networks.
                                </p>
                            </div>
                            
                            <!-- QUIC Specific Info -->
                            <div style="background: #faf5ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #7c3aed; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-info-circle"></i>
                                    QUIC Protocol Features
                                </h4>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #64748b; line-height: 1.8;">
                                    <li><strong>UDP-Based:</strong> Runs over UDP port 443, not TCP</li>
                                    <li><strong>Built-in Encryption:</strong> TLS 1.3 integrated into the protocol</li>
                                    <li><strong>Connection ID:</strong> Survives network changes (WiFi to cellular)</li>
                                    <li><strong>Stream Multiplexing:</strong> No head-of-line blocking between streams</li>
                                </ul>
                            </div>
                            
                            <!-- Wireshark Filter -->
                            <div style="background: #ecfeff; border: 1px solid #a5f3fc; border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #0891b2; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-filter"></i>
                                    Wireshark Filter
                                </h4>
                                <code style="display: block; padding: 10px 12px; background: #ffffff; border: 1px solid #67e8f9; border-radius: 6px; font-size: 0.75rem; word-break: break-all; font-family: 'Courier New', monospace; color: #0e7490;">ip.addr=={{$flow.SrcIP}} && ip.addr=={{$flow.DstIP}} && quic</code>
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .QUICFlows) 20}}
                    <div style="text-align: center; padding: 16px; color: #6b7280; font-size: 0.875rem; background: #f9fafb; border-radius: 8px; margin-top: 12px;">
                        <i class="fas fa-info-circle"></i> Showing top 20 of {{len .QUICFlows}} QUIC flows.
                    </div>
                    {{end}}
                </div>
                
                <!-- Troubleshooting Guide -->
                <div style="background: #fef2f2; border-top: 1px solid #fecaca; padding: 20px 24px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 0.9375rem; color: #991b1b; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-wrench"></i>
                        QUIC Troubleshooting Guide
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
                        <div style="background: #ffffff; border: 1px solid #fecaca; border-radius: 8px; padding: 14px;">
                            <div style="font-weight: 600; color: #991b1b; font-size: 0.875rem; margin-bottom: 8px;">
                                <i class="fas fa-ban" style="color: #ef4444;"></i> QUIC Blocked
                            </div>
                            <p style="margin: 0 0 8px 0; font-size: 0.8125rem; color: #78716c;">Firewall may be blocking UDP 443. Check firewall rules.</p>
                            <p style="margin: 0; font-size: 0.75rem; color: #64748b;"><strong>Action:</strong> Allow UDP port 443 outbound</p>
                        </div>
                        <div style="background: #ffffff; border: 1px solid #fecaca; border-radius: 8px; padding: 14px;">
                            <div style="font-weight: 600; color: #991b1b; font-size: 0.875rem; margin-bottom: 8px;">
                                <i class="fas fa-exclamation-triangle" style="color: #f59e0b;"></i> Version Mismatch
                            </div>
                            <p style="margin: 0 0 8px 0; font-size: 0.8125rem; color: #78716c;">Client and server may not support same QUIC version.</p>
                            <p style="margin: 0; font-size: 0.75rem; color: #64748b;"><strong>Action:</strong> Update browser/application</p>
                        </div>
                        <div style="background: #ffffff; border: 1px solid #fecaca; border-radius: 8px; padding: 14px;">
                            <div style="font-weight: 600; color: #991b1b; font-size: 0.875rem; margin-bottom: 8px;">
                                <i class="fas fa-network-wired" style="color: #f59e0b;"></i> NAT Issues
                            </div>
                            <p style="margin: 0 0 8px 0; font-size: 0.8125rem; color: #78716c;">Some NAT devices don't handle QUIC well.</p>
                            <p style="margin: 0; font-size: 0.75rem; color: #64748b;"><strong>Action:</strong> Check NAT timeout settings</p>
                        </div>
                    </div>
                </div>
            </div>
            {{end}}
            
            {{if .ProtocolGuide}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-book card-title-icon"></i>
                        Protocol Reference Guide
                    </h3>
                </div>
                <div class="card-body">
                    {{.ProtocolGuide}}
                </div>
            </div>
            {{end}}
        </section>
        
        <!-- ====================================================================
             TUNNELS & SD-WAN SECTION
             ==================================================================== -->
        <section id="tunnels" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-network-wired" style="color: var(--color-primary);"></i>
                Tunnels & SD-WAN Analysis
            </h2>
            
            <!-- Tunnel Detection - Complete Redesign with Inline Styles -->
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-network-wired"></i>
                        Tunnel Analysis
                        <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{.Stats.TunnelsDetected}} detected</span>
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Encapsulation protocols for secure and optimized traffic delivery</p>
                </div>
                
                <!-- Educational Introduction -->
                <div style="background: #ecfeff; border-bottom: 1px solid #a5f3fc; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #0891b2; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #0e7490; font-size: 1rem;">What are Network Tunnels?</h4>
                            <p style="margin: 0 0 12px 0; color: #0891b2; font-size: 0.875rem; line-height: 1.6;">
                                Tunnels encapsulate traffic inside other protocols for <strong>security</strong>, <strong>privacy</strong>, or <strong>network optimization</strong>. 
                                Common types include <strong>IPsec</strong> (VPN encryption), <strong>GRE</strong> (routing flexibility), <strong>VXLAN</strong> (data center overlay), 
                                and <strong>MPLS</strong> (carrier networks).
                            </p>
                            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap; font-size: 0.8125rem;">
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></span>
                                    <span style="color: #166534;">Healthy tunnel</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%;"></span>
                                    <span style="color: #92400e;">Performance issue</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%;"></span>
                                    <span style="color: #dc2626;">Tunnel failure</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tunnel List -->
                <div style="padding: 16px 24px;">
                    {{if gt .Stats.TunnelsDetected 0}}
                    {{if .TunnelFindings}}
                    {{range $index, $tunnel := .TunnelFindings}}
                    {{if lt $index 15}}
                    <details style="margin-bottom: 12px; border: 1px solid #a5f3fc; border-radius: 8px; overflow: hidden; background: #ecfeff;">
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-shield-alt" style="color: #0891b2;"></i>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$tunnel.SrcIP}}
                                </span>
                                <span style="color: #9ca3af; font-weight: bold;">→</span>
                                <span style="font-family: 'Courier New', monospace; font-weight: 500; color: #1f2937;">
                                    {{$tunnel.DstIP}}
                                </span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="background: #cffafe; color: #0e7490; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">
                                    {{$tunnel.Type}}
                                </span>
                                <span style="background: #d1fae5; color: #047857; padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                                    {{$tunnel.PacketCount}} pkts
                                </span>
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- Tunnel Details -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 16px;">
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Tunnel Type</div>
                                    <span style="font-size: 1rem; color: #0f172a; font-weight: 700;">{{$tunnel.Type}}</span>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Outer Source</div>
                                    <code style="font-size: 0.875rem; color: #0f172a;">{{$tunnel.SrcIP}}</code>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Outer Destination</div>
                                    <code style="font-size: 0.875rem; color: #0f172a;">{{$tunnel.DstIP}}</code>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Inner Protocol</div>
                                    <span style="font-size: 0.875rem; color: #0f172a; font-weight: 600;">{{$tunnel.InnerProto}}</span>
                                </div>
                            </div>
                            
                            <!-- Tunnel Type Explanation -->
                            <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #166534; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-info-circle"></i>
                                    About {{$tunnel.Type}} Tunnels
                                </h4>
                                <p style="margin: 0; font-size: 0.8125rem; color: #047857; line-height: 1.6;">
                                    {{if eq $tunnel.Type "IPsec"}}IPsec provides encrypted VPN connectivity between sites. It's commonly used for secure site-to-site connections and remote access VPNs. Check for IKE negotiation issues if tunnel fails.
                                    {{else if eq $tunnel.Type "GRE"}}GRE (Generic Routing Encapsulation) creates point-to-point tunnels for routing protocols. Often combined with IPsec for encryption. Watch for MTU issues causing fragmentation.
                                    {{else if eq $tunnel.Type "VXLAN"}}VXLAN extends Layer 2 networks over Layer 3 infrastructure. Common in data centers and cloud environments. Check VTEP connectivity if issues occur.
                                    {{else if eq $tunnel.Type "MPLS"}}MPLS provides carrier-grade traffic engineering and VPN services. Issues typically require coordination with your service provider.
                                    {{else if eq $tunnel.Type "GTP"}}GTP (GPRS Tunneling Protocol) is used in mobile networks for user plane traffic. Common in 4G/5G infrastructure.
                                    {{else if eq $tunnel.Type "L2TP"}}L2TP (Layer 2 Tunneling Protocol) is used for VPN connections, often combined with IPsec for encryption.
                                    {{else if eq $tunnel.Type "OpenVPN"}}OpenVPN is an open-source VPN solution using SSL/TLS for encryption. Check certificate validity if connection fails.
                                    {{else if eq $tunnel.Type "WireGuard"}}WireGuard is a modern, lightweight VPN protocol with excellent performance. Check peer configurations if issues occur.
                                    {{else}}This tunnel type encapsulates traffic for network optimization or security purposes.{{end}}
                                </p>
                            </div>
                            
                            <!-- Next Actions -->
                            <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #1e40af; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-tasks"></i>
                                    Next Actions
                                </h4>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #1e3a8a; line-height: 1.8;">
                                    <li><strong>Verify tunnel endpoints:</strong> Confirm both {{$tunnel.SrcIP}} and {{$tunnel.DstIP}} are expected</li>
                                    <li><strong>Check MTU settings:</strong> Ensure tunnel overhead doesn't cause fragmentation</li>
                                    <li><strong>Monitor packet counts:</strong> {{$tunnel.PacketCount}} packets observed - verify this is expected volume</li>
                                    <li><strong>Review inner protocol:</strong> Confirm {{$tunnel.InnerProto}} traffic should traverse this tunnel</li>
                                </ul>
                            </div>
                            
                            <!-- Wireshark Filter -->
                            <div style="background: #faf5ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #7c3aed; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-filter"></i>
                                    Wireshark Filter
                                </h4>
                                <code style="display: block; padding: 10px 12px; background: #ffffff; border: 1px solid #ddd6fe; border-radius: 6px; font-size: 0.75rem; word-break: break-all; font-family: 'Courier New', monospace; color: #5b21b6;">ip.addr=={{$tunnel.SrcIP}} && ip.addr=={{$tunnel.DstIP}}</code>
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    {{else}}
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 12px; color: #22c55e;"></i>
                        <p style="margin: 0; font-size: 0.875rem;">Tunnels detected but no detailed findings available.</p>
                    </div>
                    {{end}}
                    {{else}}
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 12px; color: #22c55e;"></i>
                        <p style="margin: 0 0 8px 0; font-size: 0.875rem; font-weight: 600;">No Tunnels Detected</p>
                        <p style="margin: 0; font-size: 0.8125rem; color: #9ca3af;">This capture contains no encapsulated tunnel traffic (IPsec, GRE, VXLAN, etc.)</p>
                    </div>
                    {{end}}
                </div>
                
                <!-- Tunnel Types Reference -->
                <div style="background: #f0fdfa; border-top: 1px solid #99f6e4; padding: 20px 24px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 0.9375rem; color: #0f766e; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-book"></i>
                        Common Tunnel Types Reference
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        <div style="background: #ffffff; border: 1px solid #99f6e4; border-radius: 8px; padding: 12px;">
                            <div style="font-weight: 600; color: #0f766e; font-size: 0.875rem;"><i class="fas fa-lock" style="color: #14b8a6;"></i> IPsec</div>
                            <p style="margin: 4px 0 0 0; font-size: 0.75rem; color: #0d9488;">Encrypted VPN tunnels</p>
                        </div>
                        <div style="background: #ffffff; border: 1px solid #99f6e4; border-radius: 8px; padding: 12px;">
                            <div style="font-weight: 600; color: #0f766e; font-size: 0.875rem;"><i class="fas fa-route" style="color: #14b8a6;"></i> GRE</div>
                            <p style="margin: 4px 0 0 0; font-size: 0.75rem; color: #0d9488;">Routing protocol tunnels</p>
                        </div>
                        <div style="background: #ffffff; border: 1px solid #99f6e4; border-radius: 8px; padding: 12px;">
                            <div style="font-weight: 600; color: #0f766e; font-size: 0.875rem;"><i class="fas fa-cloud" style="color: #14b8a6;"></i> VXLAN</div>
                            <p style="margin: 4px 0 0 0; font-size: 0.75rem; color: #0d9488;">Data center overlay</p>
                        </div>
                        <div style="background: #ffffff; border: 1px solid #99f6e4; border-radius: 8px; padding: 12px;">
                            <div style="font-weight: 600; color: #0f766e; font-size: 0.875rem;"><i class="fas fa-broadcast-tower" style="color: #14b8a6;"></i> MPLS</div>
                            <p style="margin: 4px 0 0 0; font-size: 0.75rem; color: #0d9488;">Carrier network labels</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SD-WAN Vendors - Complete Redesign with Inline Styles -->
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-sitemap"></i>
                        SD-WAN Vendor Detection
                        <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{.Stats.SDWANVendors}} detected</span>
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Identify SD-WAN solutions and vendor-specific traffic patterns</p>
                </div>
                
                <!-- Educational Introduction -->
                <div style="background: #f5f3ff; border-bottom: 1px solid #ddd6fe; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #7c3aed; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #5b21b6; font-size: 1rem;">Understanding SD-WAN Vendor Detection</h4>
                            <p style="margin: 0 0 12px 0; color: #7c3aed; font-size: 0.875rem; line-height: 1.6;">
                                SD-WAN vendors use unique signatures, ports, and protocols that can be detected in network traffic. 
                                Identifying vendors helps understand <strong>network architecture</strong>, <strong>troubleshoot vendor-specific issues</strong>, 
                                and ensure <strong>expected vendors are present</strong> in the environment.
                            </p>
                            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap; font-size: 0.8125rem;">
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></span>
                                    <span style="color: #166534;">Expected vendor</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%;"></span>
                                    <span style="color: #92400e;">Unknown vendor</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #3b82f6; border-radius: 50%;"></span>
                                    <span style="color: #1d4ed8;">High confidence</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Vendor List -->
                <div style="padding: 16px 24px;">
                    {{if gt .Stats.SDWANVendors 0}}
                    {{if .SDWANVendors}}
                    {{range $index, $vendor := .SDWANVendors}}
                    <details style="margin-bottom: 12px; border: 1px solid #ddd6fe; border-radius: 8px; overflow: hidden; background: #faf5ff;" open>
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-building" style="color: #7c3aed;"></i>
                                <span style="font-weight: 700; color: #1f2937; font-size: 1.1rem;">
                                    {{$vendor.Name}}
                                </span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="background: {{if eq $vendor.Confidence "High"}}#dbeafe{{else}}#fef3c7{{end}}; color: {{if eq $vendor.Confidence "High"}}#1e40af{{else}}#92400e{{end}}; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">
                                    {{$vendor.Confidence}} Confidence
                                </span>
                                <span style="background: #e0e7ff; color: #3730a3; padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                                    {{$vendor.PacketCount}} pkts
                                </span>
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- Vendor Details -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 16px;">
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Vendor Name</div>
                                    <span style="font-size: 1rem; color: #0f172a; font-weight: 700;">{{$vendor.Name}}</span>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Detection Method</div>
                                    <span style="font-size: 0.875rem; color: #0f172a; font-weight: 600;">{{$vendor.DetectedBy}}</span>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Packet Count</div>
                                    <span style="font-size: 1rem; color: #0f172a; font-weight: 600;">{{$vendor.PacketCount}}</span>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Confidence Level</div>
                                    <span style="font-size: 1rem; color: {{if eq $vendor.Confidence "High"}}#059669{{else}}#d97706{{end}}; font-weight: 700;">{{$vendor.Confidence}}</span>
                                </div>
                            </div>
                            
                            <!-- Vendor Information -->
                            <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #166534; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-info-circle"></i>
                                    About {{$vendor.Name}}
                                </h4>
                                <p style="margin: 0; font-size: 0.8125rem; color: #047857; line-height: 1.6;">
                                    {{if eq $vendor.Name "Cisco"}}Cisco SD-WAN (formerly Viptela) uses proprietary protocols and DTLS/TLS for control plane. Look for vManage, vSmart, and vEdge communications.
                                    {{else if eq $vendor.Name "VMware"}}VMware SD-WAN (VeloCloud) uses UDP-based overlay with dynamic path selection. Check for Edge-to-Gateway communications.
                                    {{else if eq $vendor.Name "Fortinet"}}Fortinet SD-WAN integrates with FortiGate firewalls. Uses proprietary protocols for orchestration and IPsec for data plane.
                                    {{else if eq $vendor.Name "Palo Alto"}}Palo Alto Prisma SD-WAN uses cloud-based orchestration. Check for communications to Prisma Access cloud gateways.
                                    {{else if eq $vendor.Name "Silver Peak"}}Silver Peak (now HPE Aruba) uses Unity EdgeConnect appliances. Look for BOOST optimization and tunnel traffic.
                                    {{else if eq $vendor.Name "Versa"}}Versa Networks uses FlexVNF architecture. Check for Director and Analytics communications.
                                    {{else}}This SD-WAN vendor was detected based on traffic signatures. Verify this matches your expected network architecture.{{end}}
                                </p>
                            </div>
                            
                            <!-- Next Actions -->
                            <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #1e40af; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-tasks"></i>
                                    Next Actions
                                </h4>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #1e3a8a; line-height: 1.8;">
                                    <li><strong>Verify expected vendor:</strong> Confirm {{$vendor.Name}} is the expected SD-WAN solution</li>
                                    <li><strong>Check controller connectivity:</strong> Ensure management plane communications are healthy</li>
                                    <li><strong>Review overlay status:</strong> Verify data plane tunnels are established correctly</li>
                                    <li><strong>Monitor packet volume:</strong> {{$vendor.PacketCount}} packets detected - verify expected traffic levels</li>
                                </ul>
                            </div>
                            
                            <!-- Vendor-Specific Tips -->
                            <div style="background: #fefce8; border: 1px solid #fef08a; border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #854d0e; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-lightbulb"></i>
                                    Troubleshooting Tips
                                </h4>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #78350f; line-height: 1.8;">
                                    <li>Check vendor-specific management console for alerts</li>
                                    <li>Verify licensing and subscription status</li>
                                    <li>Review overlay tunnel health and failover status</li>
                                    <li>Check for firmware/software version compatibility</li>
                                </ul>
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{else}}
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 12px; color: #9ca3af;"></i>
                        <p style="margin: 0; font-size: 0.875rem;">SD-WAN vendors detected but no detailed information available.</p>
                    </div>
                    {{end}}
                    {{else}}
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 12px; color: #9ca3af;"></i>
                        <p style="margin: 0 0 8px 0; font-size: 0.875rem; font-weight: 600;">No SD-WAN Vendors Detected</p>
                        <p style="margin: 0; font-size: 0.8125rem; color: #9ca3af;">No vendor-specific signatures found in this capture. This may indicate traditional WAN or unrecognized SD-WAN solution.</p>
                    </div>
                    {{end}}
                </div>
                
                <!-- Supported Vendors Reference -->
                <div style="background: #faf5ff; border-top: 1px solid #e9d5ff; padding: 20px 24px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 0.9375rem; color: #6b21a8; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-fingerprint"></i>
                        Detectable SD-WAN Vendors
                    </h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <span style="background: #ffffff; border: 1px solid #e9d5ff; border-radius: 20px; padding: 6px 14px; font-size: 0.8125rem; color: #7c3aed;">Cisco</span>
                        <span style="background: #ffffff; border: 1px solid #e9d5ff; border-radius: 20px; padding: 6px 14px; font-size: 0.8125rem; color: #7c3aed;">VMware</span>
                        <span style="background: #ffffff; border: 1px solid #e9d5ff; border-radius: 20px; padding: 6px 14px; font-size: 0.8125rem; color: #7c3aed;">Fortinet</span>
                        <span style="background: #ffffff; border: 1px solid #e9d5ff; border-radius: 20px; padding: 6px 14px; font-size: 0.8125rem; color: #7c3aed;">Palo Alto</span>
                        <span style="background: #ffffff; border: 1px solid #e9d5ff; border-radius: 20px; padding: 6px 14px; font-size: 0.8125rem; color: #7c3aed;">Silver Peak</span>
                        <span style="background: #ffffff; border: 1px solid #e9d5ff; border-radius: 20px; padding: 6px 14px; font-size: 0.8125rem; color: #7c3aed;">Versa</span>
                        <span style="background: #ffffff; border: 1px solid #e9d5ff; border-radius: 20px; padding: 6px 14px; font-size: 0.8125rem; color: #7c3aed;">Citrix</span>
                        <span style="background: #ffffff; border: 1px solid #e9d5ff; border-radius: 20px; padding: 6px 14px; font-size: 0.8125rem; color: #7c3aed;">Aryaka</span>
                    </div>
                </div>
            </div>
            
            <!-- VoIP Analysis Card -->
            {{if gt .Stats.VoIPCalls 0}}
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-phone-volume card-title-icon"></i>
                        VoIP Call Analysis ({{.Stats.VoIPCalls}} Calls)
                    </h3>
                </div>
                <div class="card-body">
                    {{if .VoIPAnalysis}}
                    <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-lg); margin-bottom: var(--space-xl);">
                        <div style="text-align: center; padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-lg);">
                            <div style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--color-info); margin-bottom: var(--space-sm);">
                                {{.VoIPAnalysis.TotalCalls}}
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                Total SIP Calls
                            </div>
                        </div>
                        
                        <div style="text-align: center; padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-lg);">
                            <div style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--color-warning); margin-bottom: var(--space-sm);">
                                {{printf "%.2f" .VoIPAnalysis.AvgJitter}} ms
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                Average Jitter
                            </div>
                        </div>
                        
                        <div style="text-align: center; padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-lg);">
                            <div style="font-size: var(--font-size-3xl); font-weight: 700; color: {{if gt .VoIPAnalysis.PacketLoss 5.0}}var(--color-critical){{else}}var(--color-success){{end}}; margin-bottom: var(--space-sm);">
                                {{printf "%.2f" .VoIPAnalysis.PacketLoss}}%
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                Packet Loss
                            </div>
                        </div>
                        
                        <div style="text-align: center; padding: var(--space-lg); background: var(--color-surface); border-radius: var(--radius-lg);">
                            <div style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--color-info); margin-bottom: var(--space-sm);">
                                {{.VoIPAnalysis.CodecsUsed}}
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                                Codecs Detected
                            </div>
                        </div>
                    </div>
                    
                    {{if gt .VoIPAnalysis.PacketLoss 5.0}}
                    <div style="background: rgba(225, 112, 85, 0.1); border-left: 4px solid var(--color-critical); padding: var(--space-lg); border-radius: var(--radius-md);">
                        <h4 style="margin: 0 0 var(--space-sm) 0; color: var(--color-critical);">
                            <i class="fas fa-exclamation-triangle"></i> High Packet Loss Detected
                        </h4>
                        <p style="margin: 0; color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            VoIP packet loss of {{printf "%.2f" .VoIPAnalysis.PacketLoss}}% exceeds acceptable threshold (5%). This may cause poor call quality.
                        </p>
                    </div>
                    {{end}}
                    {{else}}
                    <p class="text-muted">No VoIP analysis details available.</p>
                    {{end}}
                </div>
            </div>
            {{end}}
            
            <!-- Geographic Distribution - Complete Redesign with Inline Styles -->
            <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 24px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 20px 24px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-globe-americas"></i>
                        Geographic Distribution
                        {{if .GeoLocations}}<span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">{{len .GeoLocations}} countries</span>{{end}}
                    </h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.875rem;">Analyze traffic origins and destinations by geographic location</p>
                </div>
                
                <!-- Educational Introduction -->
                <div style="background: #ecfdf5; border-bottom: 1px solid #a7f3d0; padding: 20px 24px;">
                    <div style="display: flex; align-items: flex-start; gap: 16px;">
                        <div style="background: #059669; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 8px 0; color: #047857; font-size: 1rem;">Understanding Geographic Distribution</h4>
                            <p style="margin: 0 0 12px 0; color: #059669; font-size: 0.875rem; line-height: 1.6;">
                                Geographic analysis reveals where network traffic originates and terminates. This helps identify 
                                <strong>expected business traffic</strong>, <strong>potential security threats</strong>, and 
                                <strong>compliance concerns</strong> related to data sovereignty.
                            </p>
                            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap; font-size: 0.8125rem;">
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></span>
                                    <span style="color: #166534;">Expected region</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%;"></span>
                                    <span style="color: #92400e;">Review recommended</span>
                                </span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%;"></span>
                                    <span style="color: #dc2626;">Security concern</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Geographic List -->
                <div style="padding: 16px 24px;">
                    {{if .GeoLocations}}
                    {{range $index, $geo := .GeoLocations}}
                    {{if lt $index 15}}
                    <details style="margin-bottom: 12px; border: 1px solid #a7f3d0; border-radius: 8px; overflow: hidden; background: #f0fdf4;">
                        <summary style="display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; cursor: pointer; list-style: none; font-size: 0.875rem;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="fas fa-map-marker-alt" style="color: #059669;"></i>
                                <span style="font-weight: 700; color: #1f2937; font-size: 1rem;">
                                    {{$geo.Country}}
                                </span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="background: #d1fae5; color: #047857; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">
                                    {{$geo.Count}} IPs
                                </span>
                            </div>
                        </summary>
                        
                        <div style="padding: 20px; background: #ffffff; border-top: 1px solid #e5e7eb;">
                            <!-- Location Details -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 16px;">
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Country/Region</div>
                                    <span style="font-size: 1rem; color: #0f172a; font-weight: 700;">{{$geo.Country}}</span>
                                </div>
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px;">
                                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Unique IP Addresses</div>
                                    <span style="font-size: 1rem; color: #0f172a; font-weight: 600;">{{$geo.Count}}</span>
                                </div>
                            </div>
                            
                            <!-- What This Means -->
                            <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #166534; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-info-circle"></i>
                                    What This Means
                                </h4>
                                <p style="margin: 0; font-size: 0.8125rem; color: #047857; line-height: 1.6;">
                                    Traffic detected from/to {{$geo.Country}}. Verify this aligns with your expected business operations and geographic footprint. 
                                    Consider data sovereignty requirements and compliance regulations that may apply to traffic crossing international boundaries.
                                </p>
                            </div>
                            
                            <!-- Next Actions -->
                            <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #1e40af; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-tasks"></i>
                                    Next Actions
                                </h4>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #1e3a8a; line-height: 1.8;">
                                    <li><strong>Verify business need:</strong> Confirm traffic to/from {{$geo.Country}} is expected</li>
                                    <li><strong>Check applications:</strong> Identify which applications communicate with this region</li>
                                    <li><strong>Review compliance:</strong> Ensure data handling meets regulatory requirements</li>
                                    <li><strong>Monitor volume:</strong> {{$geo.Count}} unique IPs detected - verify this is normal</li>
                                </ul>
                            </div>
                            
                            <!-- Security Considerations -->
                            <div style="background: #fefce8; border: 1px solid #fef08a; border-radius: 8px; padding: 16px;">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.875rem; color: #854d0e; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-shield-alt"></i>
                                    Security Considerations
                                </h4>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.8125rem; color: #78350f; line-height: 1.8;">
                                    <li>Verify traffic is from legitimate business partners or services</li>
                                    <li>Check for unexpected data transfers to unfamiliar regions</li>
                                    <li>Review firewall logs for any blocked attempts from this region</li>
                                    <li>Consider geo-blocking if traffic is unauthorized</li>
                                </ul>
                            </div>
                        </div>
                    </details>
                    {{end}}
                    {{end}}
                    
                    {{if gt (len .GeoLocations) 15}}
                    <div style="text-align: center; padding: 16px; color: #6b7280; font-size: 0.875rem; background: #f9fafb; border-radius: 8px; margin-top: 12px;">
                        <i class="fas fa-info-circle"></i> Showing top 15 of {{len .GeoLocations}} geographic locations.
                    </div>
                    {{end}}
                    {{else}}
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <i class="fas fa-globe" style="font-size: 2rem; margin-bottom: 12px; color: #9ca3af;"></i>
                        <p style="margin: 0 0 8px 0; font-size: 0.875rem; font-weight: 600;">No Geographic Data Available</p>
                        <p style="margin: 0; font-size: 0.8125rem; color: #9ca3af;">GeoIP lookup did not return location data for IPs in this capture.</p>
                    </div>
                    {{end}}
                </div>
                
                <!-- Geographic Best Practices -->
                <div style="background: #ecfdf5; border-top: 1px solid #a7f3d0; padding: 20px 24px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 0.9375rem; color: #047857; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-shield-alt"></i>
                        Geographic Security Best Practices
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
                        <div style="background: #ffffff; border: 1px solid #a7f3d0; border-radius: 8px; padding: 14px;">
                            <div style="font-weight: 600; color: #047857; font-size: 0.875rem; margin-bottom: 8px;">
                                <i class="fas fa-ban" style="color: #10b981;"></i> Geo-Blocking
                            </div>
                            <p style="margin: 0; font-size: 0.8125rem; color: #059669;">Block traffic from regions with no business need to reduce attack surface.</p>
                        </div>
                        <div style="background: #ffffff; border: 1px solid #a7f3d0; border-radius: 8px; padding: 14px;">
                            <div style="font-weight: 600; color: #047857; font-size: 0.875rem; margin-bottom: 8px;">
                                <i class="fas fa-eye" style="color: #10b981;"></i> Monitor Anomalies
                            </div>
                            <p style="margin: 0; font-size: 0.8125rem; color: #059669;">Alert on traffic to new or unexpected geographic regions.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- ====================================================================
             VISUALIZATIONS SECTION
             ==================================================================== -->
        <section id="visualizations" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-project-diagram" style="color: var(--color-primary);"></i>
                Network Visualizations
            </h2>
            
            <!-- Network Topology -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-network-wired card-title-icon"></i>
                        Network Topology
                    </h3>
                    <div class="card-actions">
                        <button class="card-action-button" onclick="resetTopology()">
                            <i class="fas fa-sync-alt"></i> Reset
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="network-diagram" class="chart-container" style="min-height: 600px; background: #ffffff; border: 1px solid var(--color-border); border-radius: var(--radius-md); position: relative;"></div>
                </div>
            </div>
            
            <!-- Timeline Visualization -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-timeline card-title-icon"></i>
                        Event Timeline
                    </h3>
                </div>
                <div class="card-body">
                    <div id="timeline" class="chart-container"></div>
                </div>
            </div>
            
            <!-- Sankey Diagram -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-stream card-title-icon"></i>
                        Traffic Flow Diagram
                    </h3>
                </div>
                <div class="card-body">
                    <div id="sankey-diagram" class="chart-container"></div>
                </div>
            </div>
            
            <!-- RTT Histogram -->
            <div class="card mb-xl">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-bar card-title-icon"></i>
                        RTT Distribution
                    </h3>
                </div>
                <div class="card-body">
                    <div id="rtt-histogram" class="chart-container"></div>
                </div>
            </div>
        </section>
        
        <!-- ====================================================================
             DEVICES SECTION
             ==================================================================== -->
        <section id="devices" class="dashboard-section" style="display: none;">
            <h2 class="mb-xl">
                <i class="fas fa-laptop" style="color: var(--color-primary);"></i>
                Device Fingerprinting
            </h2>
            
            {{if .DeviceFingerprints}}
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-fingerprint card-title-icon"></i>
                        Detected Devices ({{.Stats.DevicesDetected}})
                    </h3>
                </div>
                <div class="card-body">
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>IP Address</th>
                                    <th>OS Type</th>
                                    <th>Operating System</th>
                                    <th>Confidence</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .DeviceFingerprints}}
                                <tr>
                                    <td><code>{{.IP}}</code></td>
                                    <td>{{.OSType}}</td>
                                    <td>{{.OSName}}</td>
                                    <td>
                                        <span class="status-badge {{if eq .Confidence "High"}}healthy{{else if eq .Confidence "Medium"}}warning{{else}}unknown{{end}}">
                                            <span class="status-dot"></span>
                                            {{.Confidence}}
                                        </span>
                                    </td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {{else}}
            <div class="card">
                <div class="card-body">
                    <p class="text-muted text-center">No devices fingerprinted.</p>
                </div>
            </div>
            {{end}}
        </section>
        
    </main>
    
    <!-- ========================================================================
         JAVASCRIPT & VISUALIZATIONS
         ======================================================================== -->
    <script>
        // Visualization Data
        const networkData = {{.NetworkDataJSON}};
        const timelineData = {{.TimelineDataJSON}};
        const sankeyData = {{.SankeyDataJSON}};
        const rttHistogramData = {{.RTTHistogramJSON}};
        
        // Navigation handling
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // Show corresponding section
                const section = this.dataset.section;
                document.querySelectorAll('.dashboard-section').forEach(s => s.style.display = 'none');
                document.getElementById(section).style.display = 'block';
                
                // Update breadcrumb
                document.getElementById('currentSection').textContent = this.textContent.trim();
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
        
        // Global search functionality
        document.getElementById('globalSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            // Search through all tables
            document.querySelectorAll('.data-table tbody tr').forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
        
        // Toggle section visibility
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const button = event.target.closest('button');
            const icon = button.querySelector('i');
            
            if (section.style.display === 'none') {
                section.style.display = 'block';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                section.style.display = 'none';
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }
        
        // Export table to CSV
        function exportTableToCSV(tableId, filename) {
            const table = document.getElementById(tableId);
            let csv = [];
            
            // Get headers
            const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent);
            csv.push(headers.join(','));
            
            // Get rows
            table.querySelectorAll('tbody tr').forEach(row => {
                const cells = Array.from(row.querySelectorAll('td')).map(td => {
                    let text = td.textContent.trim();
                    // Escape commas and quotes
                    if (text.includes(',') || text.includes('"')) {
                        text = '"' + text.replace(/"/g, '""') + '"';
                    }
                    return text;
                });
                csv.push(cells.join(','));
            });
            
            // Download
            const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        // Reset topology visualization
        function resetTopology() {
            // This will be implemented with the visualization code
            if (typeof createNetworkDiagram === 'function') {
                const container = document.getElementById('network-diagram');
                container.innerHTML = '';
                createNetworkDiagram(container, networkData);
            }
        }
        
        // TCP Flow Table - Filter by IP address
        function filterTCPFlows(searchText) {
            const table = document.getElementById('tcp-flow-table');
            if (!table) return;
            
            const rows = table.querySelectorAll('tbody tr.tcp-flow-row');
            const search = searchText.toLowerCase().trim();
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }
        
        // TCP Flow Table - Sort by column
        let tcpSortDirection = {};
        function sortTCPTable(columnIndex) {
            const table = document.getElementById('tcp-flow-table');
            if (!table) return;
            
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr.tcp-flow-row'));
            
            // Toggle sort direction
            tcpSortDirection[columnIndex] = !tcpSortDirection[columnIndex];
            const ascending = tcpSortDirection[columnIndex];
            
            rows.sort((a, b) => {
                let aVal = a.cells[columnIndex].textContent.trim();
                let bVal = b.cells[columnIndex].textContent.trim();
                
                // Numeric sort for SYN/SYN-ACK columns
                if (columnIndex === 3 || columnIndex === 4) {
                    aVal = parseInt(aVal) || 0;
                    bVal = parseInt(bVal) || 0;
                    return ascending ? aVal - bVal : bVal - aVal;
                }
                
                // String sort for other columns
                return ascending ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
            });
            
            // Re-append sorted rows
            rows.forEach(row => tbody.appendChild(row));
            
            // Update sort indicators
            const headers = table.querySelectorAll('thead th');
            headers.forEach((th, i) => {
                const icon = th.querySelector('i.fa-sort, i.fa-sort-up, i.fa-sort-down');
                if (icon) {
                    if (i === columnIndex) {
                        icon.className = ascending ? 'fas fa-sort-up' : 'fas fa-sort-down';
                    } else {
                        icon.className = 'fas fa-sort';
                    }
                }
            });
        }
        
        // Copy to clipboard with visual feedback
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const icon = button.querySelector('i');
                const originalClass = icon.className;
                icon.className = 'fas fa-check';
                button.style.background = '#00B894';
                button.style.color = 'white';
                button.style.borderColor = '#00B894';
                
                setTimeout(() => {
                    icon.className = originalClass;
                    button.style.background = '';
                    button.style.color = '';
                    button.style.borderColor = '';
                }, 1500);
            }).catch(err => {
                console.error('Failed to copy:', err);
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            });
        }
        
        // Initialize visualizations when section is shown
        function initializeVisualizations() {
            try {
                if (networkData && networkData.nodes && networkData.nodes.length > 0) {
                    createNetworkDiagram(document.getElementById('network-diagram'), networkData);
                }
                
                if (timelineData && timelineData.length > 0) {
                    createTimeline(document.getElementById('timeline'), timelineData);
                }
                
                if (sankeyData && sankeyData.nodes && sankeyData.nodes.length > 0) {
                    createSankeyDiagram(document.getElementById('sankey-diagram'), sankeyData);
                }
                
                if (rttHistogramData && rttHistogramData.length > 0) {
                    createRTTHistogram(document.getElementById('rtt-histogram'), rttHistogramData);
                }
            } catch (error) {
                console.error('Error initializing visualizations:', error);
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize visualizations after a short delay to ensure DOM is ready
            setTimeout(initializeVisualizations, 100);
        });
    </script>
    
    <!-- Visualization Functions -->
    <script>{{.JS}}</script>
</body>
</html>
